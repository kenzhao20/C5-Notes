\part{Geophysical Fluid Dynamics}\label{Geophysical Fluid Dynamics}

\section*{Introduction}

This section of the course was lectured by \href{https://www.physics.ox.ac.uk/our-people/woollings}{Tim Woollings}, covering Basic and Advanced Geophysical Fluid Dynamics (GFD). Basic GFD is covered in HT, while Advanced GFD is covered in Trinity term.\vspace{5 mm}

\noindent This section consists of six chapters. Basic GFD covers the first four chapters, and Advanced GFD covers the last two:\vspace{5 mm}

\begin{enumerate}
    \item \hyperref[Prelim GFD]{Preliminaries}: 
        
        \begin{quote}
            This chapter covers some preliminaries worth knowing prior to jumping into GFD. This includes a reminder on Vector Calculus \hyperref[VC box]{Definitions} and \hyperref[VC Interp]{Interpretations}, \hyperref[Fluid Mechanics Box]{Fluid Mechanics}, and brief discussions on \hyperref[Differential Heating]{Differential Heating} and the effects of \hyperref[GFD Special]{stratification and rotation}.
        \end{quote} 

    \item \hyperref[EoM GFD]{The Equations of Motion}: 
    
        \begin{quote}
            To be perfectly honest, if you were in a rush, you could skip almost all of this section except for the final coloured box. 
            
            Here we introduce the \hyperref[EoM GFD]{primitive equations} of motion governing the fluids that make up the atmospheres and oceans. The aim of this chapter is to \hyperref[s Transforming EoM]{transform} these equations (through coordinate substitutions, \hyperref[Scale Analysis]{scale analysis}, etc.) into the final simplified (often called `primitive') set of equations we'll use.
        \end{quote}
    
    \item \hyperref[Dia Relations]{The Fundamental Diagnostic Relations}:
        
        \begin{quote}
            We introduce some fundamental diagnostic (time-independent) relations, including \hyperref[Hydrostatic GFD Box]{hydrostatic balance} and \hyperref[Geostrophic Box]{geostrophic balance}, then discuss the implications on \hyperref[Cyclones]{(anti-)cyclones} and \hyperref[s Thermal Wind]{Thermal Wind Balance}. We use hydrostatic balance to transform explicitly into \hyperref[Pressure Coords]{pressure coordinates}, and express the prior relations in terms of pressure coordinates.
            
            Even though such relations are diagnostic (i.e., they feature no time-derivatives), these relations might still hold even if the system is changing: in this case, the relations may hold in a quasi-steady manner (a concept introduced in Part \ref{Climate Dynamics}).
        \end{quote}
    
    \item \hyperref[Shallow Water System]{The Shallow Water System}:
        
        \begin{quote}
            We finally analyse a simple time-dependent system and derive the \hyperref[shallow box]{Shallow Water} and \hyperref[s Reduced Gravity]{Reduced Gravity} Equations. In doing so, we sacrifice the vertical dimension (i.e., dispense of the vertical coordinate \(z\)) and work solely with a 2D system. We use this simplified sytem to introduce \hyperref[s SW energy]{energy} in GFD, including KE (Kinetic Energy) and APE (Available Potential energy), as well as \hyperref[PV]{Potential Vorticity}. 
            
            Finally, we analyse the propagation of anomalies in the (\hyperref[L SW Eqn]{linearised}) Shallow Water Systems by considering \hyperref[s Primer Waves]{wave-like solutions}. These anomalies ultimately redistribute energy in the Atmosphere and Oceans. These include \hyperref[2D Poincare]{Poincaré/Inertia-Gravity}, \hyperref[s Rossby SW]{Rossby}, and \hyperref[s Kelvin]{Kelvin} Waves.
        \end{quote}
    
    \item \hyperref[3D Systems]{3D Systems}:
        
        \begin{quote}
            We reintroduce the vertical coordinate \(z\) and analyse 3D time-dependent responses in GFD. After a briefly disussing 3D Gravity Waves (the analogue to the Shallow Water Poincaré waves), we derive and interpret Quasi-Geostrophic Theory.
            
            We then analyse Rossby Waves through this framework, then give a very cursory introduction to Instability and Geostrophic Turbulence.
        \end{quote}

    \item \hyperref[Oceans]{Ocean Circulation}:
        
        \begin{quote}
            The final section in GFD focuses exclusively on the Oceans, although some concepts may be applicable to the atmosphere. 
            
            We first introduce Ekman Transport, and analyse analyse its implications, which include up/downwelling of fluid and Sverdrup Balance, the implication of both Ekman up/downwelling and conservation of potential vorticity.
            
            Finally, we briefly discuss the Meridional Overturning Circulation, and introduce two simple models which aim to capture the dynamics: the Stommel and Gnanadesikan Box Models.
        \end{quote}
\end{enumerate}

\chapter{Preliminaries}\label{Prelim GFD}

\section{A Quick Reminder on Vector Calculus}

Before we jump into \textbf{Geophysical Fluid Dynamics} (\textbf{GFD}) proper, we start with a quick reminder of some vector calculus concepts. I'll mainly focus on the interpretation of these concepts, as this will be important for the interpretation of physical results later on.

You should be familiar with all the information in the box below:

\begin{fact}{Vector Calculus Definitions}{VC box}\label{VC box}
    Let \(\vec{r}=(x,y,z)^T\) denote the position vector and \(t\) denote the time.\vspace{3mm}

    \begin{minipage}{0.49\linewidth}
        We write the \textbf{partial derivative} with respect to coordinate \(x\) as follows (the subscripts indicate which variables are held constant while differentiating; in this case, coordinates \(y, \, z,\, t\) are held constant while differentiating with respect to \(x\)):
        \begin{align}\label{partial}
            \partial_{x}=\frac{\partial}{\partial x}=\left( \frac{\partial}{\partial x} \right)_{y,\,z,\,t}
        \end{align}
        Often we will omit the large brackets and leave implicit which coordinates are being held constant. Analogous for \(y\), \(z\), \(t\).
    \end{minipage}
    \hfill
    \begin{minipage}{0.49\linewidth}
        We define the \textbf{nabla} operator \(\vec{\nabla}\) as follows (in Cartesian coordinates):
        \begin{align}
            \vec{\nabla}&=\left( \begin{array}{c}
                \frac{\partial}{\partial x}\\[6pt]
                \frac{\partial}{\partial y}\\[6pt]
                \frac{\partial}{\partial z}
            \end{array} \right)
            \\
            &=\left( \frac{\partial}{\partial x}, \frac{\partial}{\partial y}, \frac{\partial}{\partial z} \right)^T \nonumber
        \end{align}
    \end{minipage}

    \vspace{3mm}Let \(p(\vec{r},t)\) be an arbitrary scalar field and \(\vec{u}(\vec{r},t)=(u_x,u_y,u_z)^T\) be an arbitrary vector field.

    We define the \textbf{Gradient}, \textbf{Curl}, and \textbf{Divergence} as follows\footnote{In a cartesian coordinate system!}:

    \begin{minipage}{.44\linewidth}
        \begin{align}
            \BOX{\text{Grad}\,\, p \equiv \vec{\nabla}p=\left( \begin{array}{c}
                \frac{\partial p}{\partial x}\\[6pt]
                \frac{\partial p}{\partial y}\\[6pt]
                \frac{\partial p}{\partial z}\\
            \end{array} \right)}
        \end{align}
    \end{minipage}
    \hfill
    \begin{minipage}{.54\linewidth}
        \begin{align}
            \BOX{\text{Curl}\,\, \vec{u} \equiv \vec{\nabla}\times \vec{u}=\left( \begin{array}{c}
                \frac{\partial u_z}{\partial y}-\frac{\partial u_y}{\partial z}\\[6pt]
                \frac{\partial u_x}{\partial z}-\frac{\partial u_z}{\partial x}\\[6pt]
                \frac{\partial u_y}{\partial x}-\frac{\partial u_x}{\partial y}\\
            \end{array} \right)}
        \end{align}
    \end{minipage}

    \begin{align}
            \BOX{\text{Div}\,\, \vec{u} \equiv \vec{\nabla}\cdot \vec{u}= \frac{\partial u_x}{\partial x} + \frac{\partial u_y}{\partial y} + \frac{\partial u_z}{\partial z}}
    \end{align}


\end{fact}

In this box we mentioned a \textbf{scalar field} and a \textbf{vector field}. A field is just anything that has a value at each point in space and time. A \textbf{scalar field} is a field that takes a scalar value at each point. For example, the pressure field \(p=p(\vec{r},t)\) is a scalar field, which denotes the pressure at each point in space and time. Meanwhile, a \textbf{vector field} is a field that takes a vector value at each point. The velocity field \(\vec{u}=\vec{u}(\vec{r},t)\) is a vector field, which denotes the velocity at each point in space and time. 

I should also note that, while we often think of (in three dimensions) three numbers encoding the value of a vector, a more rigourous formulation is to make the basis vectors explicit. For example, strictly, \(\vec{r}=(x,y,z)^T\) is a shorthand for \(\vec{r}=x\vec{e}_x+y\vec{e}_y+z\vec{e}_z\).\endnote{
    Or, in index notation (and using Einstein Summation Convention):
    \begin{align*}
        \vec{r}=r^j e_j
    \end{align*}
    In this case, this might allow us to define the gradient, curl, and divergence in a coordinate invariant fashion:
    \begin{gather*}
        \left( \text{Grad}\,\, p \right)^i = g^{ij}\partial_j p
        \\
        \left( \text{Curl}\,\, \vec{u} \right)^i = \frac{1}{\sqrt{|\det g_{ij}|}} \epsilon^{ijk}\partial_j u_k
        \\
        \text{Div}\,\, \vec{u} = \frac{1}{\sqrt{|\det g_{ij}|}}\partial_j\left( |\det g_{ij}| u^j \right)
    \end{gather*}
    where \(g_{ij}=\) the metric tensor and \(\epsilon^{ijk}\) is the Levi Civita (pseudo-)tensor.
} This makes explicit the fact that the basis vectors \(\vec{e}_i\) are a choice and can vary depending on time and space (which they will!).

Now we will interpret the \textbf{Gradient}, the \textbf{Curl}, and the \textbf{Divergence}.

\subsection{The Gradient}

We can only take the gradient of a \textbf{scalar field}, and the gradient is always a \textbf{vector field}.

The gradient encodes the local change properties of the \textbf{scalar field} with respect to space. More specifically, at each point in space and time, the value of the gradient is a vector with the following properties: the direction (in 3D space) of the vector is in the direction of steepest ascent, and the magnitude of the vector denotes how much the scalar field ascends at that point.

You should be familiar with the one-dimensional Taylor expansions. Consider some function \(f: \mathbb{R} \to \mathbb{R}\)\footnote{This is fancy speak for the function \(f(x)\) takes real numbers as an input and outputs real numbers.}. The following is the Taylor expansion of \(f\), which holds for small \(\delta x\):
\begin{align*}
    f(x+\delta x)=f(x)+\frac{df}{dx}\delta x
\end{align*}
An analogous version holds in three dimensions as well:
\begin{align*}
    p(\vec{r}+\delta\vec{r},t)&=p(\vec{r},t)+\left( \vec{\nabla}p(\vec{r},t) \right)\cdot \delta\vec{r}\\
    &=p(\vec{r},t)+\left( \text{Grad }p(\vec{r},t) \right)\cdot \delta\vec{r}
\end{align*}

Consider the case where \(\delta \vec{r}\) is perpendicular to \(\vec{\nabla}p\) (i.e., \(\vec{\nabla}p\cdot \delta \vec{r}=0\)). In this direction, there is no local change in \(p\), therefore \(p(\vec{r}+\delta\vec{r},t)=p(\vec{r},t)\) for all \(\delta\vec{r}\perp \vec{\nabla}p\). This implies that contours of constant \(p\) are \textbf{always} perpendicular to the gradient of \(p\). 

\subsection{The Curl}

We can only take the curl of a \textbf{vector field}, and the curl is always a \textbf{vector field}.

Broadly, the curl measures the local rotation of the \textbf{vector field}. More specifically, at each point in space and time, the value of the curl is a vector with the following properties: the direction (in 3D space) of the vector is in the direction perpendicular to the plain of rotation (following the right-hand rule)\footnote{
    This is just a convention. The right hand rule means that if you form a thumbs up with your right hand, your thumb is parallel with the curl if and only if the rotation is in the direction from your knuckles to the end of your fingers (following your fingers). 
    
    Another way to look at it is follows: if the curl points out of the page towards you, the rotation is anti-clockwise.
}, and the magnitude of the vector denotes how much local rotation there is at this point.

Note crucially that this only measures the \textbf{local} rotation, not the global rotation. The example often given to explain this distinction is a paddleboard: consider a very small paddleboard suspended in a fluid with a velocity field \(\vec{u}(\vec{r})\). The paddleboard is pushed around by the flow. The curl of \(\vec{u}\) encodes whether the paddleboard itself will turn, not whether it will follow a circular path.

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \begin{scope}
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1);
                \draw[->,mydarkblue,thick,dotted] (0,1) arc[start angle=140, end angle=40, radius=3cm];
            \end{scope}
            \begin{scope}[xshift=1cm, yshift = 0.6cm, rotate=-22.5]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
            \begin{scope}[xshift=2cm, yshift = 1.2cm, rotate=-45]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
                \draw[->,myorange,ultra thick] (0.15,0.1) arc[start angle=250, end angle=-70, radius=0.25cm];
            \end{scope}
            \begin{scope}[xshift=3cm, yshift = 0.7cm, rotate=-67.5]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
            \begin{scope}[xshift=4cm, yshift=0.4cm, rotate=-90]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
        \end{tikzpicture}
        \caption{Paddleboard rotates (\textcolor{myorange}{orange arrow \rule{0.2cm}{0.2cm}}) \(\longleftrightarrow\) Curl is non-zero, i.e., \(\vec{\nabla}\times\vec{u}\neq 0\)}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \begin{scope}
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1);
                \draw[->,mydarkblue,thick,dotted] (-0.1,1) arc[start angle=140, end angle=40, radius=3cm];
            \end{scope}
            \begin{scope}[xshift=1cm, yshift = 0.7cm]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
            \begin{scope}[xshift=2cm, yshift = 1cm]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
            \begin{scope}[xshift=3cm, yshift = 0.7cm]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
            \begin{scope}[xshift=4cm]
                \fill[mymagenta] (0,0) -- (0.5,0) -- (0.25,1) -- (0,0);
            \end{scope}
        \end{tikzpicture}
        \caption{Despite following a circular path, the paddleboard does \textit{not} rotate \(\longleftrightarrow\) Curl is zero, i.e., \(\vec{\nabla}\times\vec{u}= 0\)}
    \end{subfigure}
    \caption{Paddleboard (\textcolor{mymagenta}{magenta triangle \rule{0.2cm}{0.2cm}}) demonstration of curl. The \textcolor{mydarkblue}{Dotted Blue Arrow \rule{0.2cm}{0.2cm}} indicates the direction of time evolution (the paddleboard is being advected by the velocity field \(\vec{u}(\vec{r})\)).}
\end{figure}

\subsection{The Divergence}

We can only take the divergence of a \textbf{vector field}, and the divergence is always a \textbf{scalar field}.

Broadly, the divergence measures the local `spreading out' properties of a \textbf{vector field}. More specifically, at each point in space and time, the value of the divergence is a scalar that is larger the more 

I find the divergence theorem explains divergence the easiest:
\begin{align}
    \label{Div Thm}
    \iiint_v \vec{\nabla}\cdot \vec{u} \,dV \equiv \iint_s \vec{u}\cdot d\vec{S}
\end{align}
where \(v\) and \(s\) denote that we integrate over the volume and surface, respectively, of some closed 3D blob (closed means there are no holes on the blob). 

Suppose that \(\vec{u}\) is some flux per unit area. If, for example, \(\vec{u}\) is the velocity, then \(\vec{u}\) would be the volume flux per unit area. The divergence theorem says that the \textit{total flux} out of some blob (equal to the integral of \(\vec{u}\) over the surface of the blob, i.e., the right-hand side of \ref{Div Thm}) is equal to the \textit{total divergence} of the blob (equal to the integral of \(\vec{\nabla}\cdot\vec{u}\) over the volume of the blob, i.e., the left-hand side of \ref{Div Thm}). 

The divergence can therefore be thought of as the outwards flux of \(\vec{u}\) at some point, i.e., as encoding how many vectors point towards or away from a point. If the divergence is positive/negative, more/less arrows point outward than inward at that point (respectively). If the divergence is \(0\), then exactly the same `amount' of arrows point inwards as outwards. 

As a summary:
\begin{fact}{Vector Calculus Interpretation}{VC Interp}\label{VC Interp}
    \begin{minipage}{.39\linewidth}
    \begin{tcolorbox}[colback=myyellow!50!white,colframe=mymagenta]
        \begin{align*}
            \vec{\nabla}p
        \end{align*}

        The \textbf{Gradient} \(\vec{\nabla}p\) is a vector field which encodes how the scalar field \(p\) varies with space.

        \(\vec{\nabla}p\) always points towards the direction of steepest ascent in \(p\), and is perpendicular to contours of constant \(p\).
    \end{tcolorbox}
    \end{minipage}
    \begin{minipage}{.34\linewidth}
    \begin{tcolorbox}[colback=myyellow!50!white,colframe=mymagenta]
        \begin{align*}
            \vec{\nabla}\times \vec{u}
        \end{align*}

        The \textbf{Curl} \(\vec{\nabla}\times \vec{u}\) is a vector field which encodes the local rotation properties of the vector field \(\vec{u}\).

        The curl does \textit{not} encode the large-scale rotation properties of \(\vec{u}\).
    \end{tcolorbox}
    \end{minipage}
    \begin{minipage}{.25\linewidth}
    \begin{tcolorbox}[colback=myyellow!50!white,colframe=mymagenta]
        \begin{align*}
            \vec{\nabla}\cdot\vec{u}
        \end{align*}

        The \textbf{Divergence} \(\vec{\nabla}\cdot\vec{u}\) is a scalar field which encodes the local `spreading out' properties of the vector field \(\vec{u}\).
    \end{tcolorbox}
    \end{minipage}
\end{fact}

\section{A Quick Reminder of Fluid Mechanics}\label{s Fluid Mechanics}

Again, we'll quickly review some concepts in fluid mechanics. Again, I'll mainly focus on the interpretation of these concepts. Tim should have a more comprehensive review on canvas should you need it.

First we introduce the concept of a \textbf{fluid element}. This is an infinitesimal blob of fluid, whose properties may change as it is advected around with the flow. Crucially, though, the mass of the fluid parcel remains fixed as it moves around -- this is how we define a \textbf{fluid element}.\footnote{
    For a \textbf{fluid element} then, the following relation holds (by definition):
    \begin{align*}
        \int_V \rho \, dV = const
    \end{align*}
    where \(V\) indicates the region following the fluid parcel. This can also be written in terms of the \hyperref[Material Derivative]{Material Derivative}:
    \begin{align*}
        \frac{D}{Dt}\int_V \rho \, dV=0
    \end{align*}
} The blob may deform, stretch, and squish, but it has the same particles in it! For example, in deriving the \hyperref[Dry Adiabat]{Dry Adiabat}, we were considering a \textbf{fluid element} of air -- except we called it an `air parcel' then, and we found that the density and temperature of the air parcel decreased as it rose.

Second, we introduce the \hyperref[Material Derivative]{Material Derivative}\footnote{
    The Material Derivative can also be thought of as a total derivative. Our fields depend on the time \(t\) and the position \(\vec{r}\). The material (and total) derivative is then:
    \begin{align*}
        \frac{D}{Dt} = \frac{d}{dt} 
        = 
        \frac{\partial}{\partial t}
        +
        \frac{\partial \vec{r}}{\partial t}
        \cdot
        \vec{\nabla}
    \end{align*}
    where the second equality sign is just an identity from vector calculus regarding partial derivatives. We then identify \(\frac{\partial \vec{r}}{\partial t}=\vec{u}\) where \(\vec{u}=\) the velocity of the fluid parcel.
}:
\begin{align}
    \textcolor{myorange}{\frac{D}{Dt}}
    =
    \underbrace{
        \textcolor{mydarkblue}{\frac{\partial}{\partial t}}
        }_{\textcolor{mydarkblue}{\text{Time Derivative at a Fixed Point}}}+
        \underbrace{
            \textcolor{mymagenta}{\vec{u}\cdot\vec{\nabla}}}_{\textcolor{mymagenta}{\text{Advection}}}
    \label{Material Derivative}
\end{align}
The \hyperref[Material Derivative]{Material Derivative} of a quantity is the time-derivative of a quantity \textit{following a fluid element}.\footnote{
    More specifically, this quantity \(A\) \textit{must} be a `per unit mass' quantity. This is because the following relation holds:
    \begin{align*}
        \frac{D}{Dt}\int_V \rho\,A \, dV = \int_V \rho \,\frac{DA}{Dt} \, dV
    \end{align*}
    In other words suppose that \(A=u=\) energy per unit mass. Then the change in the total energy of a fluid parcel is equal to the material derivative of the energy per unit mass (integrated over the fluid parcel).

    If \(A=\vec{u}\), then the change in total momentum of a fluid parcel is equal to the material derivative of \(\vec{u}\) (integrated over the fluid parcel) -- the force!
} This is useful because it is much easier to consider what effects might change a quantity of a fluid element. For example, the forces per unit mass \(\vec{F}\) affect a fluid parcel as follows: \(\frac{D\vec{u}}{Dt}=\vec{F}\) (this is just Newton's second law).

However, in GFD, we will mostly be interested in how a quantity changes at a \textbf{fixed point in space} \(\left(\text{indicated by the } \frac{\partial}{\partial t} \text{ term}\right)\), \textit{not following a fluid element}. If we rearrange the Equation \ref{Material Derivative} for \( \frac{\partial}{\partial t} \), we find that the quantity at some point is modified by both whatever affects the fluid element \( \frac{D}{D t} \), for example the force \(\vec{F}\), and the properties of fluid elements which are advected into that location \(-\vec{u}\cdot\vec{\nabla}\):
\begin{align}\label{MatDerivTerms}
    \underbrace{
        \textcolor{mydarkblue}{\frac{\partial A}{\partial t}}
        }_{
            \textcolor{mydarkblue}{\text{Local change in }A}
        }
        =
    \underbrace{\textcolor{myorange}{
        \frac{DA}{Dt}}
        }_{{\textcolor{myorange}{\text{Change in }A \text{
             following a fluid element}}}
             }
        -
    \underbrace{\textcolor{mymagenta}{
        \vec{u}\cdot\vec{\nabla}A}
        }_{
            \textcolor{mymagenta}{\text{Advection of fluid elements with different }A}
            }
\end{align}

Hopefully you can see why this physically makes sense. The local change in \(A\) is the is comprised of the the change in \(A\) following a fluid element, i.e., comprised of what happens exactly at that point, \textbf{and} advection, i.e., the effect of fluid elements that flow onto that point. Advection is represented by the negative of \(\vec{u}\) dotted with the gradient of \(A\). Hopefully this makes sense too: the gradient points in the direction of increasing \(A\). If \(A\) is increasing in the same direction as \(\vec{u}\), then \(\vec{u}\) is `blowing' areas of lower \(A\) into areas of higher \(A\), so this should be a negative contribution to the local change in \(A\).

Third, we introduce the idea of \hyperref[Material Conservation]{Material Conservation}. You might have heard about what it means for a quantity to be \textbf{conserved}. For example, if you've solved a mechanics problem, you might recall that the total energy was conserved, meaning that \(\frac{dE}{dt}=0\) where \(E=\) the total energy.

\hyperref[Material Conservation]{Material Conservation} is a closely related idea, where certain quantities are conserved following a fluid parcel. Mathematically, a quantity \(\int_V \rho\,A\,dV\) is materially conserved if and only if it obeys the following relation:
\begin{align}\label{Material Conservation}
    \frac{D A}{Dt }=0
\end{align}
If Equation \ref{Material Conservation} obtains for some quantity \(A\), this is equivalent to demanding that, if one follows a fluid parcel, the quantity \(\frac{D}{Dt}\int_V \rho\,A \, dV\) does not change. However, as a whole, \(A\) or \(\rho\,A\) need not be globally conserved. If one considers Equation \ref{MatDerivTerms} and sets \(\frac{D A}{Dt }=0\), then you can see that the only local change in \(A\) is from fluid parcels with different \(A\) being advected into that location.\footnote{Exercise: refer forwards to Equation \ref{Energy Equation}. Note that, even if we assume \(Q=0\), \(\frac{DT}{Dt}\neq 0\). In other words, temperature is not materially conserved (so long as \(\beta\neq0\)). This is why we introduced the idea of \hyperref[eq Potential Temperature]{Potential Temperature}, as it is the case that \(\frac{D\theta}{Dt}=0\) (excercise: take \ref{Energy Equation}, solve for \(\beta\) using the ideal gas law, set \(Q=0\), and show that \(\frac{D\theta}{Dt}=0\) using the product rule. Solution found in the \hyperref[Appendix]{Appendix}).}

Finally, we define the vorticity \(\vec{\omega}\) as the curl of the velocity:
\begin{align}
    \label{eq Vorticity}
    \vec{\omega}=\vec{\nabla}\times\vec{u}
\end{align}
If you refer back to the box on \hyperref[VC Interp]{Vector Calculus Interpretation}, this should remind you that the curl of the velocity is the \textbf{local} rotation of the velocity field, not the \textbf{global} rotation. We will usually be considering the vertical component of the vorticity \([\vec{\omega}]_z\), which we will often write just as \(\xi\).

As a summary:
\begin{fact}{Fluid Mechanics Concepts}{Fluid Mechanics Box}\label{Fluid Mechanics Box}
    A \textbf{fluid element} is defined as an infintessimally small parcel of water with a fixed mass.

    We define the \textbf{Material Derivative} \(\frac{D}{Dt}\) as follows:
    \begin{align*}
        \frac{D}{Dt}=\frac{\partial}{\partial t}+\vec{u}\cdot\vec{\nabla}
    \end{align*}
    which encodes, roughly, the of a quantity of a fluid parcel (with respect to time).

    A quantity \(A\) is \textbf{materially conserved} if the following relation holds:
    \begin{align*}
        \frac{DA}{Dt}=0
    \end{align*}
\end{fact}

\section{Differential Heating: Why There Is Motion in the First Place}\label{Differential Heating}

It's important to consider why there is motion in Atmospheres and Ocean in the first place.

Regarding the first point, if you are familiar with the \hyperref[Navier Stokes]{Navier Stokes Equations} governing fluid flow, then you will know that \(\vec{u}=\vec{\nabla}p=0\) is a solution, and is a solution a system will tend towards if there is friction and no forcing\footnote{This forcing can be encoded in the boundary conditions, for example.}, and planets certainly have friction. We therefore need a non-uniform energy source. In this case, it is the Sun, and it drives motion because it provides energy to the Earth unevenly. On small scales, this may be because of variations in absorptivity and reflectivity (albedo), but on large scales this is mostly due to the spherical geometry of the Earth: more solar radiation is absorbed at the equator than at the poles (think: \textbf{zenith angle} from \hyperref[Radiative Transfer]{Radiative Transfer}, which goes as \(\cos\zeta\)).

This differential heating causes horizontal temperature gradients, which in turn cause horizontal density and pressure gradients, which drive motion. Another way to think of it is as follows: in equilibrium, the Earth absorbs more solar radiation in the equator than in the poles (see Figure \ref{Diff Heating}). As such, there must be an energy transport mechanism from the equator to the poles, and this is what drives fluid motion.\footnote{
    I'm personally somewhat ambivalent about this explanation, but I'm not very confident so be sceptical of what I'm about to say. Here's why: I cannot see why it must be the case that the variation in OLR cannot be identical to the variation in absorbed solar radiation. To put it another way, I cannot see why the dotted curve cannot be identical to the solid curve in Figure \ref{Diff Heating}, since surely the fluid dynamics itself also affects the OLR into space. Furthermore, even if this were the case, I don't see why the atmosphere/oceans should care about this global energy balance and conspire to move energy polewards.

    I therefore see the former explanation as a kind of `logical deduction'-style explanation -- an argument for why we expect there to be poleward energy transport -- rather than a `mechanistic causal'-style explanation -- an argument for what causes atmospheric/oceanic motion.

    For the latter type of explanation, I prefer the following. Assume that differential heating did not obtain, and that the poles and equator were in perfect equilibrium such that the absorbed solar at each point exactly balanced the OLR. Because the absorbed solar is more at the equator than the poles, that means the OLR must be more at the equator than the poles. Loosely following the properties of emission (recall \hyperref[Emission Box]{this information on emission}), this suggests that the poles must be colder than the equator. 

    This implies that there must be horizontal temperature gradients, and where there are temperature gradients there are density gradients. These horizontal density gradients generate instability, because a system with the minimum amount of gravitational potential energy will only have \textit{vertical} density gradients: hence motion.
}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\linewidth]{Figures/GFD/Diff Heating.jpg}
    \caption{Figure from Ray's book \cite{Ray} showing differential heating. The equator absorbs more solar radiation than it emits while the poles emit more radiation than it absorbs. As such, to close the energy balance there must be a poleward energy transport by the atmospheres and oceans.}
    \label{Diff Heating}
\end{figure}

\section{Stratification and Rotation: The Main Effects in `Geophysical' Fluid Mechanics}\label{GFD Special}

It is also important to consider what sets \textbf{Geophysical Fluid Dynamics} apart from most other Fluid Dynamics. There are two important properties that \textbf{Geophysical Fluid Dynamics} aim to investigate: \textbf{stratification} and \textbf{rotation}. The effects of these will pop up again and again throughout this course in \hyperref[Geophysical Fluid Dynamics]{GFD}.

This bit is technically off syllabus, but `Hadley's' model probably isn't, so don't skip that part if you're in a hurry. I include this section just because I think it provides quite a lot of unity to the GFD course, as these ideas will pop up again and again. You can ask yourself going forward regarding the models: which part of this model encodes the rotation, adn which bit encodes the stratification. How would the behaviour of the system differ if the system weren't rotating/weren't stratification (or, more accurately, if the rotation or stratification were weak in comparison to other dynamical effects).

\textbf{Rotation} is important because, generally, planets rotate, and this places constraints on the way that fluid parcels move. In the absensce of any torque, a fluid parcel will retain its angular momentum. On a non-rotating planet, this corresponds to moving in a straight line. On a \textit{rotating} planet, this will \textit{not} correspond to moving in a straight line (relative to the surface of the Earth).\footnote{
    The situation is considerably complicated by the spherical (or more accurately oblate spheroid) nature of the Earth. For more details, see \cite{Andy_Coriolis_Optical_Illusion}.
}

Roughly, rotation also acts to remove vertical variation of fluid properties. In other words, it makes the flow look more two-dimensional, and this is shown by the Taylor-Proudman Effect (briefly explained in this \href{https://www.physics.ox.ac.uk/research/group/geophysical-and-astrophysical-fluid-dynamics/tutorials/0}{link}), where a fluid of constant density will have no velocity variation in the vertical if is rotating sufficiently fast enough.

\textbf{Stratification} is important because the fluids in the atmospheres and oceans are a) subject to gravity and b) can vary in density (due to pressure, temperature, or salinity). This leads to (this is not an airtight argument) a fluid where the main variation in density is in the vertical. Among other effects, this acts to work against the Taylor-Proudman Effect (as density is no longer constant), 

\subsection{Rotation Pt. 2: `Hadley's' Model of the Trade Winds}

I've included this section because it is explicitly mentioned in the lecture slides, so I assume it's on-syllabus.

In the previous section, we discussed how differential heating implies that there must be some motion. This motion is required to close the energy budget. Becuase there is both net radiative heating at the equator and net radiative cooling at the poles, and the equator and poles are not heating and cooling over time, there must be some mechanism transfering energy from the equator to the poles. This is achieved by the atmospheres and oceans.

Let us then consider a extremely simple model of this: \textbf{Hadley's Model}\footnote{
    I should note that this is not \textit{exactly} Hadley's model. Hadley assumed that an air parcel's \textbf{linear momentum} is conserved, but we will assume that (a component of) the air parcel's \textbf{angular momentum} is conserved. See \cite{Hadley_Model} (and remember that the letters that look like f's are s's).
} of convection as a zonally (zonally means east-west) symmetric equator-to-pole convection cell:
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \draw (0,0) -- (5,0) arc[start angle=0, end angle=90, radius=5cm] -- cycle;
        %\draw (5,0) -- (0,0) -- (0,5);
        \draw (0,0) -- (3,0) arc[start angle=0, end angle=90, radius=3cm] -- cycle;
        %\draw (3,0) -- (0,0) -- (0,3);
    \end{tikzpicture}
    \caption{Convection Cell: [FIGURE UNDER CONSTRUCTION]}
\end{figure}

Let us consider a fluid parcel in this convection cell. We assume that this fluid parcel starts out at the equator at rest (relative to the surface of the Earth) and moves north. We also assume that there are no zonal forces (i.e., no east-west forces) acting on the fluid parcel (this is a highly unrealistic assumption)! We further assume that the radius of the Earth \(a\) is much larger than the height of the fluid parcel above the Earth.

Let \(L(\phi,u)\) represent the component of the angular momentum in the direction aligned with the angular velocity of the Earth. Equivalently, this is the component of the angular momentum parallel to the vector pointing directly upwards from the ground at the north pole. We know that this is approximately equal to the following:
\begin{align*}
    L(\phi,u) = \underbrace{a\cos\phi}_{\vec{r}} \underbrace{\left( \Omega a \cos \phi + u \right)}_{\vec{u}}
\end{align*}
where \(a=\) the radius of the Earth, \(\phi=\) the latitude, \(\Omega=\) the angular velocity of the Earth, and \(u=\) the zonal velocity of the fluid parcel relative to the surface of the Earth. The angular momentum is equal to \(\vec{r}\times\vec{u}\), the radius \(\vec{r}\) times the velocity \(\vec{u}\). The radius is equal to \(a\cos\phi\) (as it is the radius from the axis of rotation), and the velocity is equal to \(\Omega a \cos \phi + u\), the sum of the velocity from the rotation of the Earth and the velocity relative to the Earth.

Since there are no zonal forces, we can conclude that the angular momentum of the air parcel (in this direction) is conserved. Setting \(L(\phi,u)=const\) imposes the constraint \(u=u(\phi)\). We use our assumption that, at \(\phi=0\) (the equator), the \(u=0\) (fluid parcel is at rest). Therefore, some simple algebra gives us the following relation:
\begin{align*}
    \boxed{u=a\Omega \left( \frac{1}{\cos\phi}-\cos\phi
    \right)}
\end{align*}

As the air parcel moves north (as \(\phi\) increases), the zonal velocity \(u\) also increases. Conservation of angular velocity imposes that the air parcel is deflected westward as it moves northwards, so fluid parcel motion cannot always be as straightforward on a rotating planet as on a non-rotating planet.

Of course, this model is highly unrealistic. Firstly, it predicts that \(u\to\infty\) at \(\cos\phi\to\pi/2\), which is clearly unphysical. Secondly, from observations, we pretty much never observe \(u\geq\qty{150}{\metre\per\second}\), so the model fails much earlier than \(u\to\infty\). In reality, our assumption that there were no zonal forces was a very inaccurate assumption: as horizontal velocities become arbitrarily large, these induce large shears (a shear is when a layer of stuff (e.g., air) is sliding over another layer of stuff (e.g., air)), which in turn induce large forces either from viscous or turbulent eddy stresses.\footnote{For a cursory look at the effect of vertical stresses, refer to this section on \hyperref[Ekman Transport]{Ekman Transport}!}

That being said, I'm not sure this is the key reason why the model fails. The main issue (I think) is the fact that the air parcel moving East will generate forces (see Equation \ref{Horizontal Approximate}) that will act to deflect the parcel back equatorward. To keep the balance, the force that moves the parcel northward will need to become unrealistically large to keep the parcel moving northward.

Regardless of whether this is the best example, the general moral of the story is: there are conservation laws that constrain motion on rotating planets which are not present on non-rotating planets.

Looking back, this should be seen as as cursory, highly unrealistic taste of the effect that rotation might have on dynamics. It won't be much of an exaggeration to say that we'll spend most of GFD discussing the effects of rotation.

\chapter{The Equations of Motion}\label{EoM GFD}

\section{The Primitive Equations of Motion}

For simplicity we ignore state variables like salinity, humidity, etc., and restrict our attention to a system fully characterised by 3-state variables: the velocity \(\vec{u}=(u,v,w)\) (a vector), pressure \(p\), density \(\rho\), and temperature \(T\). These are governed by four equations: one momentum budget equation (\ref{Navier Stokes}), one mass budget equation (\ref{Mass Conservation}), one energy budget equation (\ref{Energy Equation})\footnote{
    I should mention that this energy equation applies only to an ideal gas. A more general energy equation (that might apply to, for example, seawater) is found in the \hyperref[Appendix]{Appendix}.
}, and an equation of state (\ref{EoS}). Each term is labelled below:
\begin{gather}
    \boxed{\underbrace{\frac{D\vec{u}}{Dt}}_{\text{Acceleration and Advection}}
    =
    \overbrace{-\frac{1}{\rho}\vec{\nabla}p}^\text{Pressure Gradients}-
    \underbrace{\vec{F}_g}_\text{Gravity}+
    \overbrace{\nu\vec{\nabla}^2\vec{u}}^\text{Viscous Dissipation}
    \underbrace{+\frac{\nu}{3}\vec{\nabla}(\vec{\nabla}\cdot\vec{u})}_\text{}+\overbrace{\vec{F}}^\text{Other Forces}}
    \label{Navier Stokes}
    \\
    \boxed{\underbrace{\frac{D\rho}{Dt}}_\text{Change in Mass of Fluid Parcel}
    +
    \overbrace{\rho\vec{\nabla}\cdot\vec{u}}^\text{Convergence/Divergence of Mass}=0}
    \label{Mass Conservation Intro}
    \\
    \boxed{\underbrace{c_p\frac{DT}{Dt}}_\text{Energy of Air Parcel}-\overbrace{\frac{\beta T}{\rho}\frac{Dp}{Dt}}^\text{Heating by Compression}=\underbrace{Q}_\text{Diabatic Heating (e.g., by radiation)}}
    \label{Energy Equation}
    \\
    \boxed{\rho=\underbrace{\rho(T,p,\ldots)}_{\text{Equation of State}}}
    \label{EoS}
\end{gather}
where \(\frac{D}{Dt}=\frac{\partial}{\partial t}+\vec{u}\cdot\vec{\nabla}\) is the \hyperref[Material Derivative]{material derivative}; \(\vec{F}_g=\) acceleration due to gravity; \(\nu=\) kinematic viscocity; \(\vec{F}=\) other forces per unit mass (e.g., friction); \(c_p=\) heat capacity per unit mass; \(\beta=-\frac{1}{\rho}\frac{\partial \rho}{\partial T}\) thermal expansion coefficient; and \(Q=\) heating per unit mass.

However, the equations are currently not fit for purpose. First, these equations are written for a coordinate system that is \textit{inertial} (non-accelerating) and \textit{cartesian}. However, the surface of the Earth is curved and the Earth is rotating\footnote{or so NASA and the lizard overlords would have you think!}, and we wish to describe what is going on \textit{here} with us. Furthermore, it would be quite demanding (computationally and conceptually) to adopt an inertial non-curved coordinate system, as then you'd have to, for example, keep track of the fact that the mountains keep moving. 

Second, these equations are currently too complicated to be analytically tractable. We will make various approximations later to simplify the equations of motion, however we should note that many of the terms we neglect cannot be neglected in a weather forecast or climate model.

\section{Transforming the Equations of Motion}\label{s Transforming EoM}

\subsection{Time-Dependent Coordinate Systems: Rotating Coordinate Systems}\label{ss Rotating}

As already mentioned, the momentum budget equation applies for an \textit{inertial coordinate system}, i.e., a coordinate system which is not accelerating. We now wish to write the momentum budget equation in a \textit{rotating} coordinate system which rotates with the Earth (or planet).

We consider two coordinate systems: an \textit{inertial} coordinate system and a \textit{rotating} coordinate system. The \textit{inertial} coordinate system is defined by cartesian basis vectors \(\vec{e}_1, \vec{e}_2, \vec{e}_3\) and coordinates \(x_1,x_2,x_3\). The \textit{rotating} coordinate system is defined by (time-dependent) cartesian basis vectors \(\vec{e}_1', \vec{e}_2', \vec{e}_3'\) and coordinates \(x_1',x_2',x_3'\). 

Both systems share an origin, but the \textit{rotating} coordinate system rotates with a constant angular velocity \(\vec{\Omega}\), where \(|\vec{\Omega}|\) is the angular speed (in \qty{}{\radian\per\second}) and \(\vec{\Omega}\) points along the axis of rotation. We also define two \textit{different} time derivative operators: the \textit{inertial} time derivative operator \(\left(\frac{d}{d t}\right)_{I}\) and the \textit{rotating} time derivative operator \(\left(\frac{d}{d t}\right)_{R}\).

We expect these operators to be different, given that \(\left(\frac{d}{d t}\right)_{I}\) holds the inertial coordinates \(x_i\) fixed while \(\left(\frac{d}{d t}\right)_{R}\) holds the rotating coordinates \(x_i'\) fixed. More intuitively, a vector that looks fixed in the \textit{inertial} coordinate system will look like it's rotating in the \textit{rotating} coordinate system, and vice versa.

Having said all this, we now specify that the basis vectors \(\vec{e}_1', \vec{e}_2', \vec{e}_3'\) are functions of time that obey the following relation:
\begin{gather}
    \label{eq Rotating Basis Vector}
    \left( \frac{d \vec{e}_i'}{d t} \right)_{I}=\vec{\Omega}\times\vec{e}_i'
    \\
    \left( \frac{d \vec{e}_i'}{d t} \right)_{R}=0
    \nonumber
\end{gather}

Our goal now is to relate the two operators \(\left(\frac{d}{d t}\right)_{I}\) and \(\left(\frac{d}{d t}\right)_{R}\) by finding the relation between \(\left(\frac{d\vec{A}}{d t}\right)_{I}\) and \(\left(\frac{d\vec{A}}{d t}\right)_{R}\), where \(\vec{A}\) is some arbitrary vector that depends only on time. We write out \(\vec{A}\) explicitly:

\vspace{-4mm}
\begin{minipage}{.5\linewidth}
\begin{align*}
    \vec{A}&=\sum_{i=1}^{3}A_i'\vec{e}_i'
    \\
    &=
    A_1'\vec{e}_1'
    +A_2'\vec{e}_2'
    +A_3'\vec{e}_3'
\end{align*}
\end{minipage}
\begin{minipage}{.5\linewidth}
\begin{gather*}
    \vec{e}_i'=\vec{e}_i'(t)
    \\
    A_i'=A_i'(t)
\end{gather*}
\end{minipage}

\vspace{2mm}
We now write \(\left(\frac{d\vec{A}}{d t}\right)_{I}\) using the product rule:
\begin{align*}
    \left(\frac{d\vec{A}}{d t}\right)_{I}
    &=
    \left(\frac{d}{d t}\right)_{I}
    \left( \sum_{j=1}^{3} A_j'\vec{e}_j' \right)
    % \left( A_1'\vec{e}_1'
    % +A_2'\vec{e}_2'
    % +A_3'\vec{e}_3' \right)
    \\
    &=
    \left( \sum_{j=1}^{3} \left(\frac{d A_j'}{d t}\right)_{I} \vec{e}_j' \right)
    % \underbrace{\left( \left(\frac{\partial A_1'}{\partial t}\right)_{x_i}\vec{e}_1'
    % +
    % \left(\frac{\partial A_2'}{\partial t}\right)_{x_i}\vec{e}_2'
    % +
    % \left(\frac{\partial A_3'}{\partial t}\right)_{x_i}\vec{e}_3' \right)}_{\left( \frac{\partial A}{\partial t} \right)_{x_i'}}
    +
    \left( \sum_{j=1}^{3} \left(\frac{d \vec{e}_j'}{d t}\right)_{I} A_j' \right)
    &\,\text{;}\,
    &\text{Product Rule}
    % \left( A_1'\left(\frac{\partial \vec{e}_1'}{\partial t}\right)_{x_i}
    % +
    % A_2'\left(\frac{\partial \vec{e}_2'}{\partial t}\right)_{x_i}
    % +
    % \left(\frac{\partial \vec{e}_3'}{\partial t}\right)_{x_i} \right)
    \\
    &=
    \left( \frac{d \vec{A}}{d t} \right)_{R} 
    +
    \left( \sum_{j=1}^{3} \vec{\Omega}\times\vec{e}_j' A_j' \right)
    &\,\text{;}\,
    &\text{\ref{eq Rotating Basis Vector} and }\left( \frac{d A_j'}{d t} \right)_I = \left( \frac{d A_j'}{d t} \right)_R
\end{align*}
where we note that \(\left( \frac{d A_j'}{d t} \right)_I = \left( \frac{d A_j'}{d t} \right)_R\) obtains because \(A_j'\) are scalars.

Therefore, the time derivative in the inertial coordinate system \(\left(\frac{d\vec{A}}{d t}\right)_I\) is related to the time derivative in the rotating coordinate system \(\left(\frac{d\vec{A}}{d t}\right)_R\) as follows (see Figure \ref{Inertial to Rotating} for a geometric explanation):
\begin{align}
    \left(\frac{d\vec{A}}{d t}\right)_I=\left(\frac{d\vec{A}}{d t}\right)_R+\vec{\Omega}\times\vec{A}
    \label{Rotating Relation}
\end{align}

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[->] (0,0) -- (3.5,0) node[anchor=west] {\(x_R\)};
            \draw[->] (0,0) -- (0,3.5) node[anchor=south] {\(y_R\)};
            \draw[thick,->] (0,0) -- (3,2) node[anchor= north] {\(\vec{A}(t)\)};
            \draw[thick,->] (0,0) -- (2,3) node[anchor=south] {\(\vec{A}(t+\delta t)\)};
            \draw[ultra thick,->] (3,2) -- (2,3) {};
            \node[] at (3.5,2.75) {\(\delta t \left( \frac{\partial \vec{A}}{\partial t} \right)_R\)};
        \end{tikzpicture}
        \caption{Change in \(\vec{A}\) in the Rotating Coordinate System}
        \label{Rotating}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[->] (0,0) -- (3.5,0) node[anchor=west] {\(x_I\)};
            \draw[->] (0,0) -- (0,3.5) node[anchor=east] {\(y_I\)};
            \draw[thick,->] (0,0) -- (3,2) node[anchor=west] {\(\vec{A}(t)\)};
            %\draw[dotted,->] (0,0) -- (2,3) node[anchor=south] {};
            \draw[thick,->] (0,0) -- (0.853,3.503) node[anchor=south east] {\(\vec{A}(t+\delta t)\)};
            \draw[ultra thick,->,dashed] (3,2) -- (2,3) {};
            \node[] at (3.5,2.75) {\(\delta t \, \left( \frac{\partial \vec{A}}{\partial t} \right)_R\)};
            \draw[ultra thick,->,dashed] (2,3) -- (0.853,3.503) {};
            \node[] at (2,3.75) {\(\delta t \vec{\Omega}\times\vec{A}\)};
            \draw[->,dashed] (0,0) -- (3.289,1.197) node[anchor=west] {\(x_R\)};
            \draw[->,dashed] (0,0) -- (-1.197,3.289) node[anchor=east] {\(y_R\)};
            \draw[ultra thick,->] (3,2) -- (0.853,3.503);
            \node[] at (1.5,2) {\(\delta t \left( \frac{\partial \vec{A}}{\partial t} \right)_I\)};
        \end{tikzpicture}
        \caption{Change in \(\vec{A}\) in the Inertial Coordinate System}
        \label{Inertial}
    \end{subfigure}
    \caption{The change in \(\vec{A}\) in a rotating (\ref{Rotating}) and inertial (\ref{Inertial}) coordinate system. As seen in \ref{Inertial}, the change in the inertial coordinate system \(\delta t \left( \frac{d \vec{A}}{d t} \right)_I\) (thick arrow) is equal to sum of the change in the rotating coordinate system \(\left( \delta t \left( \frac{d \vec{A}}{d t} \right)_R \right)\) \textit{and} the rotation of the rotating coordinate system \(\left(\delta t\,\vec{\Omega}\times\vec{A} \right)\) (thick dashed arrows).}
    \label{Inertial to Rotating}
\end{figure}

If we let \(\vec{A}=\vec{r}\), where \(\vec{r}\) is the position of our fluid parcel, we can apply Equation \ref{Rotating Relation} twice to obtain an expression for the acceleration of a fluid parcel in a rotating coordinate system.\endnote{
    I should write a bit more here to avoid a small confusion.
    
    Equation \ref{Rotating Relation} assumed that \(\vec{A}=\vec{A}(t)\) was a vector that had only temporal dependence. However, in our derivation we then go onto apply this to the velocity, which was supposedly a velocity field \(\vec{u}=\vec{u}(\vec{r},t)\). So shouldn't our derivation be invalid?

    Our derivation is actually valid, but the reason why relies on a subtle distinction. We are distinguishing between \(\vec{u}\), the velocity \textit{field}, and \(\vec{u}_I\), the velocity of \textit{some specific fluid parcel}. We only ever apply Equation \ref{Rotating Relation} on \(\vec{r}\) and \(\vec{u}_I\), which are the position and velocity of a specific fluid parcel, so these vectors are only functions of time. Analogously, the mass of a rocketship might also be a function only of time, even though the rocketship is moving about in space.

    We now make two subtle switches. First, we replace the total derivatives with material derivatives:
    \begin{align*}
        \left( \frac{d}{dt} \right)_I\to\frac{D}{Dt}
    \end{align*}
    which is fully justified by the definition of the material derivative \(\frac{D}{Dt}\). 
    
    We then note that \(\vec{u}_I=\vec{u}(\vec{r}(t),t)\) where \(\vec{r}(t)\) is the trajectory of the fluid parcel. Since the argument did not feature \textit{which} fluid parcel (i.e., the precise details of \(\vec{r}(t)\) are arbitrary), then the argument applies to every fluid parcel in the system, so we can replace \(\vec{u}_I\) with the velocity field \(\vec{u}\).
}
\begin{align*}
    \vec{u}_I &= \left( \frac{d\vec{r}}{dt} \right)_I\\
    &= \left( \frac{d\vec{r}}{dt} \right)_R+\vec{\Omega}\times \vec{r}\\
    \vec{u}_I & = \vec{u}_R+\vec{\Omega}\times \vec{r}\\
    \therefore \vec{a}_I & =
    \left( \frac{d\vec{u}_I}{dt} \right)_I\\
    &= \left( \frac{d\vec{u}_I}{dt} \right)_R+\vec{\Omega}\times \vec{u}_I\\
    &= \left( \frac{d\vec{u}_R}{dt} \right)_R
    +\vec{\Omega}\times\left( \frac{d\vec{r}}{dt} \right)_R
    +\vec{\Omega}\times\left( 
        \vec{u}_R+\vec{\Omega}\times \vec{r}
     \right)\\
    &=\vec{a}_R+2\vec{\Omega}\times\vec{u}_R+\vec{\Omega}\times\vec{\Omega}\times\vec{r}
\end{align*}

Therefore, the acceleration in the rotating frame of reference \(\vec{a}_R\) is equal to the acceleration in a inertial coordinate system \textit{along with two additional} fictitious\href{https://xkcd.com/123/}{\(^*\)}  forces: the \textbf{centrifugal force} and the \textbf{coriolis force}.
\begin{align}
   \boxed{\vec{a}_R=\vec{a}_I+\underbrace{2\vec{\Omega}\times\vec{u}_R}_\text{Coriolis}
   +\underbrace{\vec{\Omega}\times\vec{\Omega}\times\vec{r}}_\text{Centrifugal}}
\end{align}

The \textbf{centrifugal force} is the force that pushes objects away from the axis of rotation. This is the force that makes your arms fling out if you spin. The \textbf{coriolis force} is the force that diverts moving objects which move away or towards the axis of rotation. 

We can now rewrite Equation \ref{Navier Stokes} to apply to a rotating coordinate system (and we now write \(\vec{u}_R\) as just \(\vec{u}\)):
\begin{align}
    \frac{D\vec{u}}{Dt}+2\vec{\Omega}\times\vec{u}+\frac{1}{\rho}\vec{\nabla}p-\vec{F}_g=-\vec{\Omega}\times\vec{\Omega}\times\vec{r}+\nu\vec{\nabla}^2\vec{u}+\frac{\nu}{3}\vec{\nabla}(\vec{\nabla}\cdot\vec{u})+\vec{F}\label{Navier Stokes Rotating}
\end{align}

Finally, I should note that Equations \ref{Mass Conservation Intro} - \ref{EoS} remain unchanged in a rotating coordinate system (although the individual terms may look different, the differences all cancel out in the end).

\subsection{Space-Dependent Coordinate Systems: A Spherical Coordinate System}\label{s Local Cartesian Coordinates}

We have just seen that the momentum budget equation (Equation \ref{Navier Stokes Rotating}) looks substantially different if we use a coordinate system which varies with time. More specifically, for a rotating coordinate system, centrifugal and coriolis forces appear.

We will now see that the equations of motion in general also look different if we use a coordinate system which varies with space.

This will be a bit convoluted, but we will introduce three coordinate systems, all of which rotate with the Earth\footnote{We've already dealt with the fact that the coordinate system is rotating in the previous section!}. For now we introduce the first two.

First is the \textbf{global cartesian coordinate system}, with basis vectors pointing in the \(x',y',z'\) directions as shown in Figure \ref{LocCartes}. The origin is located at the centre of the Earth, and the basis vectors rotate with the Earth (i.e., they rotate with angular velocity \(\vec{\Omega}\)). The basis vectors do vary with time (as they're rotating with the Earth), but \textit{do not} vary with space. This is your classic 3D cartesian coordinate system, and the equations of motion in this frame of reference are straightforwardly the \(x,y,\) and \(z\) components of Equation \ref{Navier Stokes Rotating}.

Second, we introduce the \textbf{spherical coordinate system}. Again, the origin is located at the centre of the Earth, and the basis vectors rotate with the Earth (i.e., they rotate with angular velocity \(\vec{\Omega}\)). However, this time, the basis vectors also \textit{vary with space}. The basis vectors would be aligned with magenta arrows in Figure \ref{LocCartes} at that point, but they would not look like that at another point on the sphere! This is your classic 3D curvilinear spherical coordinate system.

We identify the basis vectors \(\hat{r}\), \(\hat{\phi}\), \(\hat{\theta}\) as pointing in the radial (upward away from the centre of the Earth), northward, and eastward directions. Explicitly, they are given as follows (in matrix form for brevity):
\begin{align*}
    \left( \begin{array}{c}
        \hat{r}
        \\
        \hat{\phi}
        \\
        \hat{\theta}
    \end{array} \right)
    =
    \left( \begin{array}{ccc}
        \sin\phi\cos\theta & \sin\phi\sin\theta & \cos\phi
        \\
        \cos\phi\cos\theta & \cos\phi\sin\theta & -\sin\phi
        \\
        -\sin\theta & -\cos\theta & 0
    \end{array} \right)
    \left( \begin{array}{c}
        \hat{x}
        \\
        \hat{y}
        \\
        \hat{z}
    \end{array} \right)
\end{align*}

[UNDER CONSTRUCTION]

In this coordinate system, we define the position and velocity coordiates \((x,y,z)\) and \((u,v,w)\) as indicating distance and velocity in the east, north, and upwards directions, respectively. We also refer to the east-west direction as the \textbf{zonal} direction and the north-south direction as the \textbf{meridional} direction. We further identify the coordinates we will be using. \(r=\) the radial coordinate, identifying the distance from the centre of the Earth, \(\) 

We further define the latitude \(\phi\in[-\frac{\pi}{2},\frac{\pi}{2}]\) (\(\phi=0\) indicates the equator, \(\phi=\pm\frac{\pi}{2}\) is the north/south pole) and the radial distance \(r\) where \(r=a+z\) where \(a=\) the radius of the Earth (see Figure \ref{LocCartes}).
\begin{figure}[H]
    \centering
    \scalebox{1.4}{
    \begin{tikzpicture},
        \begin{scope}[3d view={125}{25.26}]
            \draw[->,opacity=0.7] (0,0,0) -- (1.5,0,0) node[anchor=north east] {\(x'\)};
            \draw[->,opacity=0.7] (0,0,0) -- (0,1.5,0) node[anchor=north] {\(y'\)};
            \draw[->,opacity=0.7] (0,0,0) -- (0,0,1.5) node[anchor=north west] {\(z'\)};
            \draw[-,dashed] plot[domain=0:400,samples=41,smooth]({1.5*sin(\x)},{1.5*cos(\x)},{0});
            \draw[-,dashed] plot[domain=0:400,samples=41,smooth]({1.5*cos(0)*sin(\x)},{1.5*sin(0)*sin(\x)},{1.5*cos(\x)});
            \draw[-,dashed] plot[domain=0:360,samples=41,smooth]({1.0607*sin(\x)},{1.0607*cos(\x)},{1.0607});
            \coordinate (A) at (1.0607,0,1.0607);
            \draw[-] (0,0,0) -- (A);
            \draw[->,thick,mymagenta] (A) -- (0.7071,0,1.414);
            \draw[->,thick,mymagenta] (A) -- (1.0607,0.5,1.0607);
            \draw[->,thick,mymagenta] (A) -- (1.414,0,1.414);
            %\filldraw[fill=myorange,opacity=0.5] (1,0,0) .. controls +(0,0,0.8) and +(0.5,0.2,0) .. (0.7071,0,0.7071) -- (0,0,0);
            \filldraw[fill=myorange,opacity=0.5] (1,0,0) .. controls +(0,0,0.5) and +(0.1,0,-0.1) .. (0.7071,0,0.7071) -- (0,0,0);
        \end{scope}
        \begin{scope}
            \draw[-,dashed] plot[domain=0:400,samples=41,smooth]({1.5*sin(\x)},{1.5*cos(\x)});
            \node at (-0.5,1.2) {\(y\)};
            \node at (-0.2,0.8) {\(x\)};
            \node at (-0.8,0.95) {\(z\)};
            \node at (-0.35,0.04) {\(\phi\)};
        \end{scope}
    \end{tikzpicture}}
    \hspace{2cm}
    \scalebox{1.4}{
    \begin{tikzpicture},
        \begin{scope}[3d view={125}{25.26}]
            \draw[->,opacity=0.7] (0,0,0) -- (1.5,0,0) node[anchor=north east] {\(x'\)};
            \draw[->,opacity=0.7] (0,0,0) -- (0,1.5,0) node[anchor=north] {\(y'\)};
            \draw[->,opacity=0.7] (0,0,0) -- (0,0,1.5) node[anchor=north west] {\(z'\)};
            \draw[-,dashed] plot[domain=0:400,samples=41,smooth]({1.5*sin(\x)},{1.5*cos(\x)},{0});
            \draw[-,dashed] plot[domain=0:400,samples=41,smooth]({1.5*cos(0)*sin(\x)},{1.5*sin(0)*sin(\x)},{1.5*cos(\x)});
            \draw[-,dashed] plot[domain=0:360,samples=41,smooth]({1.0607*sin(\x)},{1.0607*cos(\x)},{1.0607});
            \coordinate (A) at (1.0607,0,1.0607);
            \draw[-] (0,0,0) -- (A);
            \draw[->,thick,mymagenta] (A) -- (0.7071,0,1.414);
            \draw[->,thick,mymagenta] (A) -- (1.0607,0.5,1.0607);
            \draw[->,thick,mymagenta] (A) -- (1.414,0,1.414);
            %\filldraw[fill=myorange,opacity=0.5] (1,0,0) .. controls +(0,0,0.8) and +(0.5,0.2,0) .. (0.7071,0,0.7071) -- (0,0,0);
            \filldraw[fill=myorange,opacity=0.5] (1,0,0) .. controls +(0,0,0.5) and +(0.1,0,-0.1) .. (0.7071,0,0.7071) -- (0,0,0);
        \end{scope}
        \begin{scope}
            \draw[-,dashed] plot[domain=0:400,samples=41,smooth]({1.5*sin(\x)},{1.5*cos(\x)});
            \node at (-0.5,1.2) {\(y\)};
            \node at (-0.2,0.8) {\(x\)};
            \node at (-0.8,0.95) {\(z\)};
            \node at (-0.35,0.04) {\(\phi\)};
        \end{scope}
    \end{tikzpicture}}
    \caption{Local Cartesian Coordinates. \((x',y',z')\) indicate our global cartesian coordinate system, while \((x,y,z)\) indicate our local cartesian coordinate system in magenta arrows.}
    \label{LocCartes}
\end{figure}

Explicitly, \(\vec{r}=(x,y,z)=x\,\hat{x}+y\,\hat{y}+z\,\hat{z}\) are given by (where \(\theta=\) the longitude):

\vspace{-4mm}
\begin{minipage}{.31\linewidth}
\begin{align*}
    x = r\cos\phi\sin\theta
\end{align*}
\end{minipage}
\begin{minipage}{.31\linewidth}
\begin{align*}
    y = r\sin\phi
\end{align*}
\end{minipage}
\begin{minipage}{.31\linewidth}
\begin{align*}
    z = r-a
\end{align*}
\end{minipage}

\vspace{1mm}\noindent
Our goal now is to derive which extra terms appear in the equations of motion if we write it in terms of this coordinate system. 

The first step is to write out \(\vec{u}\) in this coordinate system:
\begin{align*}
    \vec{u}=\left( \begin{array}{c}
        u\\
        v\\
        w
    \end{array} \right)
    =u\hat{x}+v\hat{y}+w\hat{z}
\end{align*}

The second step is to consider the material derivative \(\frac{D\vec{u}}{Dt}\), taking into account that it is not necessarily the case that \(\frac{D\hat{x}}{Dt}=0\) and again use product rule:
\begin{align*}
    \frac{D\vec{u}}{Dt} = 
    \frac{Du}{Dt}\hat{x} +
    \frac{Dv}{Dt}\hat{y} +
    \frac{Dw}{Dt}\hat{z} +
    u\frac{D\hat{x}}{Dt} +
    v\frac{D\hat{y}}{Dt} +
    w\frac{D\hat{z}}{Dt}
\end{align*}
We now require knowledge about these basis vectors \(\hat{x}\), \(\hat{y}\), \(\hat{z}\) vary with the movement of the fluid parcel, i.e., the precise value of \(\frac{D\hat{x}}{Dt}\). Writing this out explicitly:
\begin{align*}
    \frac{D\hat{x}}{Dt}
    =
    \frac{\partial \hat{x}}{\partial t}
    +
    u\frac{\partial \hat{x}}{\partial x}
    +
    v\frac{\partial \hat{x}}{\partial y}
    +
    w\frac{\partial \hat{x}}{\partial z}
\end{align*}
The time derivatives are zero (\(\frac{\partial \hat{x}}{\partial t}=\frac{\partial \hat{y}}{\partial t}=\frac{\partial \hat{z}}{\partial t}=0\)) since the basis vectors do not change in time (relative to the rotating coordinates \(x',y',z'\)). The spatial derivatives can be found geometrically using some trigonometry (I, at this point in time, can't be bothered to write more than this). Therefore:

\begin{minipage}{.3\linewidth}
\begin{align*}
    &\frac{\partial \hat{x}}{\partial x}=\frac{1}{r}\tan(\phi) \, \hat{y}-\frac{1}{r}\hat{z}
    \\
    &\frac{\partial \hat{x}}{\partial y}=0
    \\
    &\frac{\partial \hat{x}}{\partial z}=0
    \\
    \therefore\,
    &
    \boxed{\frac{D\hat{x}}{Dt}=\frac{u}{r}\left( \tan\phi\,\hat{y}-\hat{z} \right)}
\end{align*}
\end{minipage}
\begin{minipage}{.3\linewidth}
\begin{align*}
    &\frac{\partial \hat{y}}{\partial x}=-\frac{1}{r}\tan(\phi)\,\hat{x}
    \\
    &\frac{\partial \hat{y}}{\partial y}=-\frac{1}{r}\hat{z}
    \\
    &\frac{\partial \hat{y}}{\partial z}=0
    \\
    \therefore\,
    &
    \boxed{\frac{D\hat{y}}{Dt}=-\frac{u}{r}\tan(\phi)\,\hat{x}-\frac{v}{r}\hat{z}}
\end{align*}
\end{minipage}
\begin{minipage}{.3\linewidth}
\begin{align*}
    &\frac{\partial \hat{z}}{\partial x}=\frac{1}{r}\hat{x}
    \\
    &\frac{\partial \hat{z}}{\partial y}=\frac{1}{r}\hat{y}
    \\
    &\frac{\partial \hat{z}}{\partial z}=0
    \\
    \therefore\,
    &
    \boxed{\frac{D\hat{z}}{Dt}=\frac{u}{r}\hat{x}+\frac{v}{r}\hat{y}}
\end{align*}
\end{minipage}

\vspace{2mm}Finally, we note that, in this coordinate system, \(\vec{\Omega}\) is given by:
\begin{align*}
    \vec{\Omega} = \Omega (\hat{y}\cos\phi+\hat{z}\sin\phi)
\end{align*}

Plugging into Equation \ref{Navier Stokes Rotating}, churning through the algebra, and equating components, we get:
\begin{align*}
    \frac{Du}{Dt}-\left( 2\Omega+\frac{u}{r\cos\phi} \right)\left( v\sin\phi-w\cos\phi \right)+\frac{1}{\rho r \cos\phi}\frac{\partial p}{\partial \theta}
    =F_x
    \\
    \frac{Dv}{Dt}+\frac{wv}{r}+\left( 2\Omega+\frac{u}{r\cos\phi} \right)u\sin\phi+\frac{1}{\rho r}\frac{\partial p}{\partial \phi}=F_y
    \\
    \frac{Dw}{Dt}-\frac{u^2+v^2}{r}-2\Omega u \cos\phi+\frac{1}{\rho}\frac{\partial p}{\partial r}+g=F_z
\end{align*}
where we have lumped together all the terms on the right-hand-side of \ref{Navier Stokes Rotating} into the \(F_x, F_y, F_z\). The terms with \(\Omega\) are what the coriolis force looks like in this coordinate system. All the extra terms \(\left( \text{e.g., the } \frac{wv}{r} \text{ term}\right)\), as well the strange form of the pressure gradient, are due to the fact that we have adopted a local cartesian system, in which the coordinate system changes as we move over the Earth.

Note that, unlike before, Equations \ref{Mass Conservation} - \ref{Energy Equation} \textit{do} look substantially different, but only for the reason that the pressure gradient term looks different. The material derivative terms (e.g., the ) doesn't look different.

Finally, we introduce the \textbf{Local Cartesian Coordinate System}. This coordinate system has the origin located not at the centre of the Earth, but about the location of interest on the sphere. The basis vectors, again, rotate with the Earth. However, the basis vectors are constant with space. The basis vectors for the \textbf{Local Cartesian Coordinate System} then, \textit{about a certain point}, are shown by the magenta arrows in Figure \ref{LocCartes}. 

We identify the basis vectors \(\hat{x}\), \(\hat{y}\), \(\hat{z}\) as pointing in the eastward, northward, and upward (away from the centre of the Earth) directions \textit{at that very origin}. The further we stray from the origin, the more those basis vectors point in different directions! In this coordinate system, we define the position and velocity coordiates \((x,y,z)\) and \((u,v,w)\) as indicating distance and velocity in the east, north, and upwards directions, respectively. We also refer to the east-west direction as the \textbf{zonal} direction and the north-south direction as the \textbf{meridional} direction.

\subsection{Scale Analysis}\label{Scale Analysis}

Finally, we make a few phenomenological simplifications. We do this here for simplicity, but our results are not general or particularily robust: many of the terms we will neglect are essential in climate/weather models. We do this here by performing a \textbf{scale analysis}: we estimate the size of quantities by their typical values (found empirically), then ignore terms that are much smaller than the other terms. We never neglect the pressure gradient term. \vspace{5mm}

\noindent
\begin{tabular}{|p{5.8cm}|p{1.4cm}|p{4cm}|p{4cm}|}
\hline
    Scale & Symbol & Terms Approximated & Typical Magnitude \\
\hline
\hline
Horizontal Scale & \(L\) & \(\frac{1}{r \cos\phi}\frac{\partial}{\partial \theta}\sim\frac{1}{L}\), \(\frac{1}{r}\frac{\partial}{\partial \phi}\sim\frac{1}{L}\)& \qty{e6}{\metre}\\
\hline
Vertical Scale & \(H\) & \(\frac{\partial}{\partial r}=\frac{\partial}{\partial z}\sim\frac{1}{H}\)& \qty{e4}{\metre}\\
\hline
Horizontal Velocity & \(U\) & \(u\sim U\), \(v\sim U\)& \qty{10}{\metre\per\second}\\
\hline
Vertical Velocity & \(W\) & \(w\sim W\)& \qty{e-2}{\metre\per\second}\\
\hline
Time Scale & \(T\) & \(\frac{\partial}{\partial t}\sim\frac{1}{T}\)& \qty{e5}{\second}\\
\hline
Density & \(\rho\) & \(\rho\sim\rho\)& \qty{1}{\kilogram\per\second}\\
\hline
Earth's Radius & \(a\) & \(r\sim a\)& \qty{6.4e6}{\metre}\\
\hline
Rotation Rate & \(\Omega\) & \(\Omega\sim\Omega\) & \qty{e-4}{\per\second}\\
\hline
Acceleration of Gravity & \(g\) & \(g\sim g\) & \qty{10}{\metre\per\second\squared}\\
\hline
\end{tabular}\newline

I do not write out all the details here, as they would easily take multiple pages. If you are curious about the details, refer to the mini-scale analysis I do in deriving \ref{Hydrostatic GFD}, which is analogous to what we do here. A more rigorous method would be non-dimensionalisation, but this is overkill for our purposes. Again, if you are curious about the details, refer to the mini-non-dimensionalisation I do in deriving the \hyperref[Rossby Number]{Rossby Number}. 

Suffice it to say we eliminate and approximate many terms through this scale analysis. Most (but not all) of the eliminations/approximations are due to the fact that the following relations obtain (most due to the fact that atmospheric and oceanic motion has an extremely small aspect ratio: it's a lot wider than it is tall):

\vspace{-4mm}
\begin{minipage}{.3\linewidth}
    \begin{align*}
    r \gg z
\end{align*}
\end{minipage}
\begin{minipage}{.3\linewidth}
    \begin{align*}
    L \gg H
\end{align*}
\end{minipage}
\begin{minipage}{.3\linewidth}
\begin{align*}
    U \gg W
\end{align*}
\end{minipage}

\vspace{2mm}

This includes any terms that feature the viscosity \(\nu\) and many terms arising from our local cartesian coordinate system. The centrifugal force is \textit{not} eliminated universally by our scale analysis, but we neglect this term for a different reason.\endnote{
    The reason why we neglect the centrifugal force is for two reasons.
    
    First, the centrifugal force is a conservative force, i.e., we can write it as the gradient of a scalar field: i.e., there exists a \(\psi\) such that \(-\vec{\Omega}\times\vec{\Omega}\times\vec{r}=-\vec{\nabla}\phi\). Therefore, we can simply define an `effective gravitational potential' \(\Phi=\phi+\psi\), where \(\phi\) is the gravitational potential energy field.

    The second reason is a bit more subtle.

    First, consider the shape of the Earth (or any planet). Any non-rotating sufficiently-large planet (which has had (sufficient) time to come into equilibrium) is a sphere. The reason why is because it is \textit{this} configuration which minimises the gravitational potential energy, and it minimises the gravitational potential energy because the surface of the planet aligns with the surfaces/contours of constant gravitational potential energy \(\phi\). In other words, the planet is spherical because surfaces of constant \(\phi\) are also spherical.

    For a rotating planet, the surfaces of constant potential energy are now deformed (the total potential \(\Phi=\phi+\psi=\) the sum of the gravitational and the centrifugal potential energies). Now, the contours of constant \(\Phi\) are \href{https://en.wikipedia.org/wiki/Spheroid}{oblate spheroids}, and so the planet's shape tends towards this.
    
    Recalling (from the \hyperref[VC Interp]{Vector Calculus Intepretation Box}) that the gradient of a scalar field \(\Phi\) is perpendicular to the contours of constant \(\Phi\), \textit{and} recalling that the force experienced by an object in this field is this gradient \(\vec{F}=-\vec{\nabla}\Phi\), it turns out that the force experienced by an object will always be perpendicular to the surface of the planet. Therefore, the combined gravitational and centrifugal forces still points `downwards' at each point on the surface, similar to a non-rotating spherical planet. 
    
    This is the second reason why we neglect the centrifugal force. Because the combined centrifugal and gravitational force always points downwards, it is phenomenologically very similar to a situation with only the gravitational force. As such, we choose to neglect the centrifugal force for simplicity.}

As a quick 
This allows us to substitute \(a\) for \(r\) in many places, neglect many terms including \(w\) since they're small compared to \(u,v\), and equate certain spatial derivatives. After eliminating the small terms, we arrive at our final set of simplified equations.

\section{The Simplified Equations of Motion}

\begin{fact}{The Simplified Equations of Motion for GFD}{Eqns for GFD Box}\label{Eqns for GFD Box}
    We define the material derivative as \(\frac{D}{Dt}=\frac{\partial}{\partial t}+u\frac{\partial}{\partial x}+v\frac{\partial}{\partial y}+w\frac{\partial}{\partial z}\), the horizontal gradient operator as \(\vec{\nabla}_h=\left( \frac{\partial}{\partial x},\frac{\partial}{\partial y},0 \right)^T\), the horizontal velocity as \(\vec{u}_h=\left( u,v,0 \right)^T\), the horizontal forces as \(\vec{F}_h\), and the \textbf{coriolis parameter} as \(f=2\Omega\sin\phi\) where \(\phi=\) the latitude.

    The simplified equations of motion we will be using are as follows: \vspace{2mm}

    \begin{minipage}{0.48\linewidth}
        \centering
        \textbf{Vertical Momentum Balance:}
        \begin{gather}
            \label{Vertical Approximate}
            \BOX{\frac{Dw}{Dt}+\frac{1}{\rho}\frac{\partial p }{\partial z}+g=F_z}
        \end{gather}
    \end{minipage}
    \hfill
    \begin{minipage}{0.48\linewidth}
        \centering
        \textbf{Mass Conservation:}
        \begin{gather}
            \label{Mass Conservation}
        \BOX{\frac{D\rho}{Dt}+\rho\vec{\nabla}\cdot\vec{u}=0}
        \end{gather}
    \end{minipage}

    \vspace{2mm}
    \centering
    \textbf{Horizontal Momentum Balance:}
    \begin{gather}
        \label{Horizontal Approximate}
        \BOX{\underbrace{\frac{D\vec{u}_h}{Dt}}_\text{acceleration and advection}+
        \overbrace{f\vec{k}\times\vec{u}_h}^\text{coriolis}+
        \underbrace{\frac{1}{\rho}\vec{\nabla}_hp}_\text{horizontal pressure gradients}=\overbrace{\vec{F}_h}^\text{other forces}}
    \end{gather}
\end{fact}

Physically, the \textbf{coriolis parameter} \(f=2\Omega \sin \phi\) is the planetary vorticity: it is the vorticity that a fluid parcel at rest (relative to the surface of the Earth) has in the \(z\)-direction. Note that we \textit{have} made approximations of the material derivatives and gradient operators, as these usually feature terms arising from the strange coordinate system (e.g., we have approximated \(\frac{1}{r}\frac{\partial}{\partial\phi}\sim\frac{\partial}{\partial y}\)).\footnote{Note that we've ignored the Energy Equation (\ref{Energy Equation}). This equation is important, and it is used to derive an approximate mass conservation equation later in section BLAH , but the details are slightly convoluted and we don't really discuss it in C5 (again, see the Appendix for details!).}

We will mostly be dealing with the horizontal momentum equation \ref{Horizontal Approximate}, so it is worth detailing the interpretation of each terms. The first term, \(\frac{D\vec{u}_h}{Dt}\) is the material derivative of \(\vec{u}_h\). It represents the acceleration and advection of \(\vec{u}_h\). The \(f\vec{k}\times\vec{u}_h\) term is the acceleration due to coriolis. The \(\frac{1}{\rho}\vec{\nabla}_h p\) is the force due to the horizontal pressure gradient. Finally, the \(\vec{F}_h\) term is external forces, e.g., friction, wind-forcing, etc.

\chapter{The Fundamental Diagnostic Relations}\label{Dia Relations}

\section{Hydrostatic Balance (Approximate Vertical Momentum Balance)}\label{App Vert Bal}

We now make further approximations to extract physical intuition. Consider \ref{Vertical Approximate}, and again perform a scale analysis and assume that \(F_z\approx 0\).
\begin{align*}
    &&\frac{Dw}{Dt} &+
    & \frac{1}{\rho}\frac{\partial p}{\partial z}+
    &g=0
    \\
    &\underbrace{\frac{\partial w}{\partial t}}_{\frac{W}{T}}+ 
    &\underbrace{u\frac{\partial w}{\partial x} 
    + v\frac{\partial w}{\partial y}}_{U\frac{W}{L}}+ 
    &\underbrace{w\frac{\partial w}{\partial z}}_{W\frac{W}{H}}+ 
    &\frac{1}{\rho}\frac{\partial p}{\partial z}+
    &g=0
    \\
    &\sim\frac{W}{T}+
    &\sim U\frac{W}{L}+
    &\sim\frac{W^2}{H}+ 
    &\frac{1}{\rho}\frac{\partial p}{\partial z}+
    &g=0
    \\
    \therefore
    &\frac{\text{\qty{e-2}{\metre\per\second}}}{\text{\qty{e5}{\second}}}+ 
    &\text{\qty{10}{\metre\per\second}}\frac{\text{\qty{e-2}{\metre\per\second}}}{\text{\qty{e6}{\metre}}}+ 
    &\frac{\left( \text{\qty{e-2}{\metre\per\second}} \right)^2}{\text{\qty{e4}{\metre}}}+ 
    &\frac{1}{\rho}\frac{\partial p}{\partial z}+
    &\text{\qty{10}{\metre\per\second\squared}}=0
    \\
    &\text{\qty{e-7}{\metre\per\second\squared}}+
    &\text{\qty{e-7}{\metre\per\second\squared}}+
    &\text{\qty{e-8}{\metre\per\second\squared}}+
    &\frac{1}{\rho}\frac{\partial p}{\partial z}+
    &\text{\qty{10}{\metre\per\second\squared}}=0
    \\
    &\bcancel{\text{\qty{e-7}{\metre\per\second\squared}}}+
    &\bcancel{\text{\qty{e-7}{\metre\per\second\squared}}}+
    &\bcancel{\text{\qty{e-8}{\metre\per\second\squared}}}+
    &\frac{1}{\rho}\frac{\partial p}{\partial z}+
    &\text{\qty{10}{\metre\per\second\squared}}=0
\end{align*}

As seen then, many of the acceleration terms (the terms in the \(\frac{Dw}{Dt}\)) are 8 orders of magnitutde smaller than gravity! As such, the only term that can balance the gravity term is the pressure gradient. We thus neglect all other terms and derive again:

\begin{fact}{Hydrostatic Balance}{Hydrostatic GFD Box}\label{Hydrostatic GFD Box}
Hydrostatic Balance governs the vertical pressure variation in a fluid if we assume that vertical acceleration (and advection) is small.
    \begin{equation}\label{Hydrostatic GFD}
    \BOX{
        \frac{\partial p}{\partial z}=-\rho g
    }
    \end{equation}
Pressure decreases with height in order to balance the force of gravity.
\end{fact}

Physically, hydrostatic balance is a force/momentum balance in the vertical direction, where the force of gravity is balanced by the vertical pressure gradient. Notice now the difference between the Hydrostatic Balance I have written here (\ref{Hydrostatic GFD}) and the Hydrostatic Balance I have written in the \hyperref[p Thermodynamics]{Thermodynamics} Part (\ref{Hydrostatic Balance}): I have written it here with a partial derivative. Strictly, it should have been a partial derivative before too, but I write it here to note that we are now considering horizontal variations as well as vertical variations.

For an ideal gas, one can substitute for \(\rho\) using \ref{eq Ideal Gas}:
\begin{align}\label{Hydrostatic Ideal Gas}
    \boxed{\frac{\partial \ln p}{\partial z}=-\frac{g}{RT}}
\end{align}

\section{Geostrophic Balance (Approximate Horizontal Momentum Balance)}\label{App Horiz Bal}

\subsection{Rossby Number and Non-Dimensionalisation}

Let us now consider the horizontal momentum equation \ref{Horizontal Approximate} and let \(\vec{F}_h\approx 0\) for now. We nondimensionalise the equations by defining dimensionless hatted variables and choosing characteristic scales such that the dimensionless hatted variables are of order 1:
\begin{align*}
    t=[t]\hat{t}\text{   ;   }
    \vec{r}=L\vec{\hat{r}}\text{   ;   }
    \vec{u}_h=[u_h]\vec{\hat{u}}_h\text{   ;   }
    p=[p]\hat{p}
\end{align*}

So, for example, \([t]= \) the timescale with dimensions of time and \(L= \) the lengthscale with dimesions of length, while \(\hat{t}\) and \(\vec{hat{r}}\)is the dimensionless time/position variables. We \textit{must} pick these scales \([t]\), \(L\), \([u_h]\), \([p]\) \textit{such that} the hatted variables (\(\hat{t}\),\(\vec{\hat{r}}\), \(\vec{\hat{u}}_h\), \(\hat{p}\)) are of order one, so we're constrained by the system under consideration.\footnote{
    In fact we've already made an implicit assumption that the system is roughly isotropic, which means that we can choose \([v]=[u]=[u_h]\) and \([x]=[y]=L\).  
} We now substitute these variables into \ref{Horizontal Approximate}:
\begin{align*}
    \frac{[u_h]}{[t]}\frac{\partial\vec{\hat{u}}_h}{\partial t}+\frac{[u_h]^2}{L}\left( \vec{\hat{u}}_h\cdot\vec{\hat{\nabla}} \right)\vec{\hat{u}}_h+[u_h]f\vec{k}\times\vec{\hat{u}}_h+[p]\frac{1}{\rho}\vec{\nabla}_h\hat{p}=0
\end{align*}
where \(\vec{\hat{\nabla}}=(\partial/\partial \hat{x},\partial/\partial \hat{y})^T\) is the non-dimesional nabla operator. Dividing by \(f[u_h]\), we get:
\begin{align*}
    \underbrace{\boxed{\frac{1}{f[t]}}}_{\equiv St}\frac{\partial\vec{\hat{u}}_h}{\partial t}+\underbrace{\boxed{\frac{[u_h]}{fL}}}_{\equiv Ro}\left( \vec{\hat{u}}_h\cdot\vec{\hat{\nabla}} \right)\vec{\hat{u}}_h+\vec{k}\times\vec{\hat{u}}_h+\underbrace{\boxed{\frac{[p]}{\rho f [u_h]}}}_{\equiv P}\vec{\nabla}_h\hat{p}=0
\end{align*}

We thus see three non-dimesional coefficients appear in front of each of the terms in each equation: \(St\), \(Ro\), and \(P\).\footnote{
    While \(St\) and \(Ro\) are standard nomenclature for these non-dimesional quantities, \(P\) is not.
} These non-dimesional coefficients compare the relative size and therefore importance each term in the Horizontal Momentum equation. You might expect there to be four non-dimesional coefficients because there were four scales we could choose, but there are only three because this fourth non-dimensional coefficient is set by the Horizontal Momentum equation itself: all the terms on the left hand side \textit{must} sum to \(0\).

Now, written just in terms of the non-dimensional coefficients, we write the (isotropic) non-dimensional horizontal momentum equation:
\begin{align}
    \label{Horizontal Approximate nondim}
    \underbrace{St\,\frac{\partial\vec{\hat{u}}_h}{\partial t}}_{\mathcal{O}(St)}+
    \underbrace{Ro\,\left( \vec{\hat{u}}_h\cdot\vec{\hat{\nabla}} \right)\vec{\hat{u}}_h}_{\mathcal{O}(Ro)}+
    \underbrace{\vec{k}\times\vec{\hat{u}}_h}_{\mathcal{O}(1)}+
    \underbrace{P\,\vec{\nabla}_h\hat{p}}_{\mathcal{O}(P)}=0
\end{align}

Note that because we have nondimensionalised such that each variable is of order one, the \(\vec{k}\times\vec{\hat{u}}_h\) is always of order one, while the other terms are of order \(St\), \(Ro\), and \(P\), respectively.

The physical interpretation of each coefficient is as follows: \(St\) represents the ratio of the intrinsic timescale of the system \([t]\) (set by dynamics of the particular problem under consideration) and the timescale of the rotation of the planet \(1/f\). This intrinsic timescale could be set, for example, by the stratification (for example the Brunt Vasalla frequency you encountered in Clouds PUT REFERENCE HERE \([t]=1/N\)). Other times, if there is no intrinsic timescale, the timescale is often set by the advection \([t]=L/[u_h]\). If this timescale is much shorter than the rotation timescale (i.e., if \([t]\ll 1/f\)) then \(St\gg 1\), so the left-hand most term is much larger than the rotation \(\vec{k}\times\vec{\hat{u}}_h\) term. Physically, this means that the local rate of change `doesn't see' the fact that the planet is rotating. This is because everything happens so quickly that the planet hasn't rotated much to affect events. This is what happens on human scales: if I throw a ball at you then this takes much less time than \(1/f\sim\) 1 day, so we don't notice the Earth rotating.

For simplicity, we simply assume at this point that the following obtains: that the timescale is set by advection or something slower than advection such that \([t]\geq L/[u_h]\) (i.e., we are never interested in stuff happening on very time-scales shorter than the advective timescale). As such, we can approximate \(St\leq Ro\) so that we get:
\begin{align*}
    Ro\,\left( \frac{\partial\vec{\hat{u}}_h}{\partial t}+\left( \vec{\hat{u}}_h\cdot\vec{\hat{\nabla}} \right)\vec{\hat{u}}_h\right)+\vec{k}\times\vec{\hat{u}}_h +P\,\vec{\nabla}_h\hat{p}=0
\end{align*}

We can now explain the \textbf{Rossby Number} \(Ro\) very easily. \(Ro\) compares the effect of advection/acceleration to rotation: if \(Ro \ll 1\) (the \textbf{Rossby Number} is small), then rotation is important and dominates dynamics. If \(Ro \gg 1\) (the \textbf{Rossby Number} is large), then the flow evolves in such a way where coriolis is negligible.

\begin{fact}{Rossby Number}{Rossby box}\label{Rossby Box}
    We define the dimensionless \textbf{Rossby Number} \(Ro\), which encodes the relative importance of (planetary) rotation and advection/acceleration terms, as follows:
    \begin{gather}
        \label{Rossby Number}
        \BOX{
            Ro=\frac{U}{fL}
        }
    \end{gather}
    where \(U=\) the horizontal velocity scale, \(f=\) the coriolis parameter, and \(L=\) the horizontal length scale.
    
    If \(Ro\ll 1\), then the rotation of the planet is important, and the flow should be approximately \textbf{Geostrophic}. If \(Ro\gg 1\), then acceleration/advection is important.
\end{fact}

Note that I have not specified \(P\). This is because we expect the pressure scale \(P\) to be set by the dynamics governed by the \hyperref[Horizontal Approximate]{Horizontal Momentum Equation}. If \(Ro\ll 1\), then we expect \(P\) to be of order \(1\) in order to balance the coriolis \(\vec{k}\times\vec{\hat{u}}_h\) term. If \(Ro\gg 1\), then we expect \(P\) to be of order \(Ro\) in order to balance the advection/acceleration \(D\vec{\hat{u}}_h/Dt\) term. 

We can also write the Rossby Number in terms of a ratio between the planetary vorticity and relative vorticity. The planetary vorticity \(\xi_{planetary}\) is the angular velocity of a fluid parcel due to the rotation of the Earth, and scales as \(f\). The relative vorticity is the vorticity of our fluid parcel in our coordinate system which is rotating with the Earth, and scales as \(\xi_{relative}=[\vec{\omega}]_z=[\vec{\nabla}\times\vec{u}_h]_z\sim U/L\). Therefore:
\begin{align}
    Ro &= \frac{\xi_{relative}}{\xi_{planetary}}\\
    &\sim\frac{U/L}{f}
\end{align}

The actual size of \(Ro\) depends on the kind of system we are considering: i.e., what are the length-scales and velocity-scales of the system. But it also, crucially, depends on the coriolis parameter \(f=2\Omega\sin\phi\). \(f=0\) at or near the equator, and so it is unlikely that \(Ro\) will ever be small near the equator. However, let us be clear. This \textit{does not} imply that rotation in general is unimportant near the equator. However, this does \textit{suggest} that the flow is probably not geostrophic near the equator.

Much of what we will discuss here in GFD will require \(Ro\) to be small and for the system to be geostrophic, or approximately geostrophic. This means that what we discuss is really only guaranteed to be accurate in the mid-/high-latitudes (coincidentally where we are!). It is worth bearing this in mind. However, note that \(Ro\) being small is a \textit{sufficient} condition (provided that our other assumptions are sound) – it is not a \textit{necessary} condition. \(Ro\) being large does not imply that our theories must fail, or that the flow cannot be geostrophic or approximately so.

\subsection{Geostrophic Balance}

If \(Ro\ll 1\) and all other forces are negligible, then rotation dominates dynamics. We can therefore neglect external forces (set \(\vec{F}_h\approx0\)) and acceleration and advection (set \(D\vec{u}_h/Dt\approx0\)) in Equation \ref{Horizontal Approximate nondim} (the horizontal momentum equation). Because the equation must equal \(0\), we are forced to conclude that \(P\) is of order one, so Equation \ref{Horizontal Approximate nondim} and therefore Equation \ref{Horizontal Approximate} must be a balance between the horizontal pressure gradient force and the coriolis force.\footnote{
    You might be suspicious from what I've said. After all, \(Ro\) depends on velocity-scale \(U\) and length-scale \(L\), which we expect should be set by the dynamics and governed by the underlying equations of motion!

    In other words, \textit{if} \(Ro\ll 1\), then we expect the system to be in geostrophic balance, but why is \(Ro\ll 1\) in the first place, and why would our atmosphere/ocean system tend towards a state such that \(Ro\ll 1\) holds? If we set \(Ro\ll 1\) \textit{a priori}, doesn't this mean we're putting in the answer by hand? Conversely, if we set \(Ro\ll 1\) \textit{a posteriori} (based on observations), then this seems like putting the cart before the horse: again, \(Ro\ll 1\) \textit{because} of the underlying equations of motion, not the other way around!

    % The answer lies in the phenomenon of \hyperref[Geostrophic Adjustment]{Geostrophic Adjustment}.
} 

\begin{fact}{Geostrophic Balance}{Geostrophic Box}\label{Geostrophic Box}
    A flow is geostrophic if the dominant terms in the horizontal momentum balance equation (Equation \ref{Horizontal Approximate}) are the coriolis force and the pressure gradient force. As such, these terms must balance as follows:
    \begin{align}
        \label{Geo Bal}
        \BOX{f\vec{k}\times\vec{u}_h=-\frac{1}{\rho}\vec{\nabla}_hp}
    \end{align}
    This results in a velocity field determined by the pressure gradient as follows (Exercise: Show that Equation \ref{Geostrophic Balance} satisfies Equation \ref{Geo Bal} for any arbitrary pressure field \(p\) if we assume \(\vec{\nabla}_hf=0\)):
    \begin{align}\label{Geostrophic Balance}
        \boxed{\vec{u}_h=\frac{1}{\rho f}\vec{k}\times\vec{\nabla}_hp}
    \end{align}
\end{fact}

Written out, each component of \(\vec{u}_h=(u,v)^T\) is as follows:

\begin{minipage}{0.45\linewidth}
    \begin{align*}
        \BOX{u = -\frac{1}{\rho f}\frac{\partial p}{\partial y}}
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{0.45\linewidth}
    \begin{align*}
        \BOX{v = \frac{1}{\rho f}\frac{\partial p}{\partial x}}
    \end{align*}
\end{minipage}

\vspace{2 mm} Recall that the horizontal gradient of pressure \(\vec{\nabla}_h p\) points in the direction of increasing \(p\). Equation \ref{Geo Bal} shows that the coriolis force, which pushes a fluid at right angles to its velocity, balances the pressure gradient force, which pushes a fluid from areas of high pressure to areas of low pressure.

We can use Equation \ref{eq Ideal Gas} to show that, for an ideal gas, geostrophic balance may be written as follows:
\begin{align}
    \label{Geostrophic Ideal Gas}
    \vec{u}_h=\frac{RT}{ f}\vec{k}\times\vec{\nabla}_h\ln p
\end{align}

\subsection{Cyclones and Anti-Cyclones}\label{Cyclones}

The horizontal velocity field is thus set by the horizontal pressure field in Equation \ref{Geostrophic Balance}. 

Recall from our \hyperref[VC Interp]{Vector Calculus Interpretation Box} that the contours of constant \(p\) are always perpendicular to the gradient \(\vec{\nabla}_h p\) of the pressure field \(p\), and point from areas of low pressure to areas of high pressure. Recall further that a cross product of two vectors \(\vec{a}\times\vec{b}\) is always perpendicular to both \(\vec{a}\) and \(\vec{b}\).\footnote{
    The way I like to remember how this works is the right-hand rule. Make a cartesian coordinate system with your right hand: first make a thumbs up with your right hand, then point your index finger away from you, then point your middle fingle to your left.

    Now consider \(\vec{a}\times\vec{b}=\vec{c}\). If you align \(\vec{a}\) with your thumb, then align \(\vec{b}\) with your index finger, then \(\vec{c}\) will be pointing in the direction of your middle finger!

    Further note: (I think?) this is why we call certain cartesian coordinate systems a right handed coordinate system, because \(\hat{x}\times\hat{y}=\hat{z}\), where \(\hat{x}\), \(\hat{y}\), \(\hat{z}\) are the unit vectors pointing in the \(x\), \(y\), and \(z\) directions.
}

Therefore, if the flow is geostrophic, then \(\vec{u}_h\) flows parallel \textbf{isobars} (an isobar is defined as a contour of constant \(p\)). It is not difficult to verify this by showing that \(\vec{u}_h\cdot\vec{\nabla}_h p=0\).

If you consider blobs of higher or lower pressure (which I will draw with circles for simplicity), you will see that the horizontal velocity flows either clockwise or anticlockwise around the areas of high or low pressure. Whether it is clockwise or anticlockwise will depend if we are in the northern hemisphere (so that \(f=2\Omega\sin\phi>0\) obtains) or in the southern hemisphere (so that \(f=2\Omega\sin\phi<0\) obtains).

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[fill=none](0,0) circle (1.5);
            \draw[fill=none](0,0) circle (3);
            \draw[->,thick,mydarkblue] (2.121,2.121) arc[start angle=45, end angle=225, radius=3cm];
            \draw[->,ultra thick,mymagenta,dotted] (2.121,2.121)--(1.131,1.131);
            \node[] at (0.831,1.831) {\(-\frac{1}{\rho}\vec{\nabla}_h p\)};
            \draw[->,ultra thick,myorange,densely dashed] (2.121,2.121)--(3.111,3.111);
            \node[] at (3.111,3.411) {\(-f\vec{k}\times\vec{u}_h\)};
            \draw[->,ultra thick,mydarkblue] (2.121,2.121)--(1.131,3.111);
            \node[] at (1.131,3.411) {\(\vec{u}_h\)};
            \node[] at (0,0) {Low Pressure};
            \node[] at (0,-2.1) {Medium Pressure};
            \node[] at (0,-3.5) {High Pressure};
        \end{tikzpicture}
        \caption{Cyclone: a \textbf{Low} Pressure System. The fluid flows anti-clockwise around a cyclone in the northern hemisphere.}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[fill=none](0,0) circle (1.5);
            \draw[fill=none](0,0) circle (3);
            \draw[->,thick,mydarkblue] (2.121,2.121) arc[start angle=45, end angle=-135, radius=3cm];
            \draw[->,ultra thick,myorange,densely dashed] (2.121,2.121)--(1.131,1.131);
            \node[] at (0.831,1.831) {\(-f\vec{k}\times\vec{u}_h\)};
            \draw[->,ultra thick,mymagenta,dotted] (2.121,2.121)--(3.111,3.111);
            \node[] at (3.111,3.411) {\(-\frac{1}{\rho}\vec{\nabla}_h p\)};
            \draw[->,ultra thick,mydarkblue] (2.121,2.121)--(3.111,1.131);
            \node[] at (3.111,1.631) {\(\vec{u}_h\)};
            \node[] at (0,0) {High Pressure};
            \node[] at (0,-2.1) {Medium Pressure};
            \node[] at (0,-3.5) {Low Pressure};
        \end{tikzpicture}
        \caption{Anti-Cyclone: a \textbf{High} Pressure System. The fluid flows clockwise around an anti-cyclone in the northern hemisphere.}
    \end{subfigure}
    \caption{Cyclones and Anticyclones in the northern hemisphere (\(f>0\)). Isobars are drawn as solid black lines \textcolor{black}{\rule{0.25cm}{0.25cm}}., the pressure gradient force \(\left( -\frac{1}{\rho}\vec{\nabla}_h p \right)\) as \textcolor{mymagenta}{thick dotted magenta arrows \rule{0.25cm}{0.25cm}}, the coriolis force \(\left( -f\vec{k}\times\vec{u}_h \right)\) as \textcolor{myorange}{thick dashed orange arrows \rule{0.25cm}{0.25cm}}, and the velocity \(\left( \vec{u}_h \right)\) as \textcolor{mydarkblue}{thick filled dark blue arrows \rule{0.25cm}{0.25cm}}.}
\end{figure}

More generally, areas of high or low pressure might not be perfect circular blobs. Consider the `observations'\footnote{
    Technically, these are not really observations, but `reanalysis'. Essentially what that means is that observations and models are combined to produce and temporally and spatially observationally (but model-biased) estimate of the atmospheric state.
} shown in Figure \ref{f ERA40 geostrophic}.

Now, of course, cyclones and anti-cyclones as I have described them here are theoretical approximations to \textit{actual} cyclones and anti-cyclones. We do not yet have the full vocabulary needed to fully describe such systems, but I couldn't think of anywhere else to put this information, so you can refer to the next subsections as brief detours that might require revisiting once you are familiar with the concept of \hyperref[PV]{Potential Voriticity}.

We will have to postpone discussion regarding this for now.

One way in which actual cyclones/anti-cyclones differ is that they are subject to other forces, like friction with the ground or centrifugal forces. Another way in which actual cyclones/anti-cyclones differ is that they are fully three-dimensional, and we have not considered the vertical velocity in cyclones or anti-cyclones, and that they 

Suffice it to say that cyclones and anti-cyclones are weather systems that propogate across the mid-/high-latitudes. They can be generated if there is energy to cause an area of high or low pressure, and they dissipate due to the effects of surface friction and potential vorticity (a concept we will cover later). Because of how cyclones and anti-cyclones interact with the ground and friction, cyclones result in areas of rising air, while anti-cyclones result in areas of sinking air. Thinking back to convection, this brings unsettled, cloudy, and rainy conditions in the former case.

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\linewidth}
        \includegraphics[width=\linewidth]{Figures/GFD/ERA40 MSLP.png}
        \caption{Mean sea level pressure.}
        \label{sf ERA40 MSLP}
    \end{subfigure}
    \begin{subfigure}{0.45\linewidth}
        \includegraphics[width=\linewidth]{Figures/GFD/ERA40 Isotach 850 hPa.png}
        \caption{Windspeed/isotach\footnotemark at \qty{850}{\hecto\pascal}.}
        \label{sf ERA40 u_h}
    \end{subfigure}
    \begin{subfigure}{0.6\linewidth}
        \includegraphics[width=\linewidth]{Figures/GFD/ERA40 geopotential isotach 250hPa.png}
        \caption{Geopotential height (for now think of this as a proxy for pressure) and windspeed at \qty{250}{\hecto\pascal}.}
        \label{sf ERA40 phi u_h}
    \end{subfigure}
    \caption{Annual Mean Renalysis Data from ERA40 \cite{ERA40} comparing pressure $p_s$ (or geopotential height $\Phi$) and horizontal wind speed $\vec{u}_h$. Geostrophic balance predicts that the direction of $\vec{u}_h$ should be along isobars, and the magnitude of $\vec{u}_h$ should scale with pressure gradients.The former is shown by figures \ref{sf ERA40 MSLP} and \ref{sf ERA40 u_h}. Note that the colours should be slightly out of phase (as predicted by geostrophic balance) -- focus instead on the arrows in figure \ref{sf ERA40 u_h}, which should blow along the blobs in figure \ref{sf ERA40 MSLP}. The latter is shown by figure \ref{sf ERA40 phi u_h}, where the colours and contours should roughly line up. As you can see, though, there are clear deviations not only at the equator but at high latitudes too! We're clearly missing something here.}
    \label{f ERA40 geostrophic}
\end{figure}

\footnotetext{Meaning contours of constant speed.}

\subsection{Gradient-Wind Balance}

We will now make a brief detour to analyse how the centrifugal force affects cyclones and anti-cyclones. 

I should be clear \textit{which} centrifugal force we are considering in this subsection. In this case, we are considering the the centrifugal force on the air parcel arising from the fact that the air parcel is moving in a circle \textit{around the centre of the cyclone or anti-cyclone}, and is therefore accelerating inwards towards the cyclone (which is associated with the $\frac{D\vec{u}}{Dt}$ term which we previously neglected). This gives rise to a centrifugal force that pushes the air parcel away from the centre of the cyclone (in the frame of reference rotating with the cyclone/anti-cyclone).

We are \textit{not} considering the centrifugal force on the air parcel arising from the fact that air parcel is moving in a circle \textit{around the centre of the Earth} (due to the fact that the Earth is spinning), and is therefore accelerating inwards towards the centre of the Earth. This gives rise to a centrifugal force that pushes the air parcel away from the centre of the Earth (in the frame of reference rotating with the Earth but not the cyclone/anti-cyclone). 

Now that we've gotten this potential confusion out the way, consider an air parcel moving in circular motion around a centre of high or low pressure. We adopt a local polar coordinate system, with the coordinates \((r,\theta)\) where \(x=r\cos\theta\) and \(y=r\sin\theta\). We assume there are no forces in the \(\theta\)-direction and only consider forces in the \(r\)-direction.

In this direction, there are three forces on the air parcel. We already considered the first two: the pressure gradient force \(\left( -\frac{1}{\rho}\vec{\nabla}_h p = -\frac{1}{\rho}\frac{\partial p}{\partial r} \hat{r} \right)\) and the coriolis force \(-\left( f\vec{k}\times \vec{u}_h = fu_h\hat{r}  \right)\) where \(u_h=|\vec{u}_h|\) and \(\hat{r}\) is the unit vector pointing in the \(r\)-direction. Since the air parcel is moving in circular motion, we know that it is subject to a centrifugal force away from the vortex with magnitude \(\frac{u_h^2}{r}\hat{r}\).\footnote{Equivalently, we can say that the parcel must be accelerating inwards with an acceleration of \(-\frac{u_h^2}{r}\hat{r}\)}. For an cyclone and an anti-cyclone in the northern hemisphere, it will look as follows:

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[fill=none](0,0) circle (1.5);
            \draw[fill=none](0,0) circle (3);
            \draw[->,thick,mydarkblue] (2.121,2.121) arc[start angle=45, end angle=225, radius=3cm];
            \draw[->,ultra thick,mymagenta,dotted] (2.121,2.121)--(1.131,1.131);
            \node[] at (0.831,1.831) {\(-\vec{\nabla}_h p\)};
            \draw[->,ultra thick,myorange,densely dashed] (2.121,2.121)--(3.111,3.111);
            \node[] at (3.111,3.511) {\(-f\vec{k}\times\vec{u}_h+\frac{u_h^2}{r}\hat{r}\)};
            \draw[->,ultra thick,mydarkblue] (2.121,2.121)--(1.555,2.687);
            \node[] at (1.555,2.987) {\(\vec{u}_h\)};
            \node[] at (0,0) {Low Pressure};
            \node[] at (0,-2.1) {Medium Pressure};
            \node[] at (0,-3.5) {High Pressure};
        \end{tikzpicture}
        \caption{Cyclone: a \textbf{Low} Pressure System. The fluid flows anti-clockwise around a cyclone in the northern hemisphere.}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[fill=none](0,0) circle (1.5);
            \draw[fill=none](0,0) circle (3);
            \draw[->,thick,mydarkblue] (2.121,2.121) arc[start angle=45, end angle=-135, radius=3cm];
            \draw[->,ultra thick,myorange,densely dashed] (2.121,2.121)--(1.131,1.131);
            \node[] at (0.831,1.831) {\(-f\vec{k}\times\vec{u}_h\)};
            \draw[->,ultra thick,mymagenta,dotted] (2.121,2.121)--(3.111,3.111);
            \node[] at (3.111,3.511) {\(-\vec{\nabla}_h p+\frac{u_h^2}{r}\hat{r}\)};
            \draw[->,ultra thick,mydarkblue] (2.121,2.121)--(3.111,1.131);
            \node[] at (3.111,1.631) {\(\vec{u}_h\)};
            \node[] at (0,0) {High Pressure};
            \node[] at (0,-2.1) {Medium Pressure};
            \node[] at (0,-3.5) {Low Pressure};
        \end{tikzpicture}
        \caption{Anti-Cyclone: a \textbf{High} Pressure System. The fluid flows clockwise around an anti-cyclone in the northern hemisphere.}
    \end{subfigure}
    \caption{Cyclones and Anti-cyclones near the surface (in the northern hemisphere (\(f>0\))), accounting for the effects of friction. Gradient Wind Balance with cyclones and anticyclones in the northern hemisphere (\(f>0\)). Isobars are drawn as solid black lines \textcolor{black}{\rule{0.25cm}{0.25cm}}., the pressure gradient force \(\left( -\frac{1}{\rho}\vec{\nabla}_h p \right)\) as \textcolor{mymagenta}{thick dotted magenta arrows \rule{0.25cm}{0.25cm}}, the coriolis force \(\left( -f\vec{k}\times\vec{u}_h \right)\) as \textcolor{myorange}{thick dashed orange arrows \rule{0.25cm}{0.25cm}}, and the velocity \(\left( \vec{u}_h \right)\) as \textcolor{mydarkblue}{thick filled dark blue arrows \rule{0.25cm}{0.25cm}}.}
\end{figure}

Notice how, for a cyclone, the centrifugal force points in the same direction as the coriolis force. For an anti-cyclone, the centrifugal force points in the opposite driection as the coriolis force (i.e., in the direction of the pressure gradient force).

Therefore, if the pressure gradient force is of a similar size (and this is a big if) for both a cyclone and anti-cyclone, we should expect the coriolis force to be \textit{smaller} in a cyclone than in an anticyclone. Since the corilis force scales as the wind speed \(u_h\), we therefore expect a cyclone to produce \textit{weaker} winds than an anti-cyclone for the same pressure gradients. Turning this on its head, if a cyclone and an anti-cyclone have similar wind-speeds, we expect the cyclone to have \textit{stronger} pressure gradients.

But will cyclones and anti-cyclones have similar size pressure gradient forces? Let us try to understand this algebraically. The force balance in the \(r\)-direction is as follows:
\begin{align}
    \label{GW Quadratic}
    \boxed{
        \frac{u_h^2}{r}+fu_h-\frac{1}{\rho}\frac{\partial p}{\partial r}=0
    }
\end{align}
which is a quadratic equation for the velocity \(u_h\), where \(u_h>0\) if \(u_h\) is spiraling in the anti-clockwise direction (in the northern hemisphere). \vspace{2mm}

\begin{minipage}{.48\linewidth}
    \centering
    For a cyclone, \(u_h>0\)
    \begin{align*}
        \frac{u_h^2}{r}+fu_h = \frac{1}{\rho}\frac{\partial p}{\partial r}
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{.48\linewidth}
    \centering
    For an anti-cyclone, \(u_h<0\)
    \begin{align*}
        \frac{u_h^2}{r} - \frac{1}{\rho}\frac{\partial p}{\partial r} = -fu_h
    \end{align*}
\end{minipage}

\vspace{2mm}
If we solve Equation \ref{GW Quadratic} directly, we find that \(u_h\) is given by the following:
\begin{align*}
    u_h = \frac{r}{2} \left( 
        -f \pm \sqrt{f^2 + \frac{4}{\rho r}\frac{\partial p}{\partial r}}
     \right)
\end{align*}
So it turns out that, generally, anticyclones (where \(\frac{\partial p}{\partial r}<0\)) really can't form in this simple model if \(\left|\frac{1}{\rho}\frac{\partial p}{\partial r}\right|>\frac{rf^2}{4}\), i.e., if the pressure gradient is too large, whereas there is no pressure gradient cap for cyclones.

A final note to say that if the \(fu_h\) term is small compared to the other terms then we have the centrifugal force balancing the pressure gradient force (or the pressure gradient sustaining the centripetal acceleration of the air parcel), and this is called \textbf{cyclostrophic balance}.

\subsection{The Effects of Friction}

Our second detour is in the effects of friction. To make things simpler, we once again ignore the centrifugal force. We focus on the bit of the cyclone/anti-cyclone closest to the ground, where friction is no longer negligible.

Representing the effects of friction is incredibly complicated, especially since at this scale turbulence is typically non-negligible. For now, let us just suppose that this can be somewhat represented by a simple linear drag $-\alpha \vec{u}_h$ term such that the approximate horizontal momentum balance equation now becomes:
\begin{align*}
    f\vec{k}\times\vec{u}_h = -\frac{1}{\rho}\vec{\nabla}p - \underbrace{\alpha\vec{u}_h}_{\text{friction}}
\end{align*}
We solve this by decomposing \(\vec{u}_h\) into a geostrophic and ageostrophic component (we also have to assume that \(\alpha \ll 1\)):
\begin{align*}
    &\vec{u}_h = \vec{u}_g + \vec{u}_a
    \\
    \text{where}\hspace{1cm}&f\vec{k}\times\vec{u}_a = -\frac{1}{\rho}\vec{\nabla}p
    \\
    \text{and}\hspace{1cm}&\vec{u}_a\ll \vec{u}_g
\end{align*}

This allows us to identify the ageostrophic component as being equal to the friciton term. Component wise, this shows that:
\begin{align*}
    f\vec{k}\times\vec{u}_a = \left( \begin{array}{c}
        -v_a
        \\
        u_a
    \end{array} \right)
    =
    \left( \begin{array}{c}
        -u_g
        \\
        -v_g
    \end{array} \right)
\end{align*}

So the ageostrophic component points inwards! Sketching out \(\vec{u}_h\) is shown in Figure \ref{f friction cyclone}.

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[fill=none](0,0) circle (1.5);
            \draw[fill=none](0,0) circle (3);
            \draw[->,thick,mydarkblue] (2.121,2.121) arc[start angle=45, end angle=225, radius=3cm];
            %PRESSURE
            \draw[->,ultra thick,mymagenta,dotted] (2.121,2.121)--(1.131,1.131);
            \node[] at (0.831,1.831) {\(-\frac{1}{\rho}\vec{\nabla}_h p\)};
            %CORIOLIS
            \draw[->,ultra thick,myorange,densely dashed] (2.121,2.121)--(2.83030943,3.34447053);
            \node[] at (2.83030943,3.64447053) {\(-f\vec{k}\times\vec{u}_h\)};
            %FRICTION
            \draw[->,dash dot,ultra thick,myyellow] (2.121,2.121)--(2.50789535,1.89669666);
            \node[] at (2.70789535,2.19669666) {\(-\alpha\vec{u}_h\)};
            %VELOCITY
            \draw[->,ultra thick,mydarkblue] (2.121,2.121)--(0.89752947,2.83030943);
            \node[] at (0.89752947,3.13030943) {\(\vec{u}_h\)};
            \node[] at (0,0) {Low Pressure};
            \node[] at (0,-2.1) {Medium Pressure};
            \node[] at (0,-3.5) {High Pressure};
        \end{tikzpicture}
        \caption{Cyclone: a \textbf{Low} Pressure System. The fluid flows anti-clockwise around a cyclone in the northern hemisphere.}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\linewidth}
        \centering
        \begin{tikzpicture}
            \draw[fill=none](0,0) circle (1.5);
            \draw[fill=none](0,0) circle (3);
            \draw[->,thick,mydarkblue] (2.121,2.121) arc[start angle=45, end angle=-135, radius=3cm];
            %CORIOLIS
            \draw[->,ultra thick,myorange,densely dashed] (2.121,2.121)--(1.41169057, 0.89752947);
            \node[] at (0.881,1.831) {\(-f\vec{k}\times\vec{u}_h\)};
            %PRESSURE
            \draw[->,ultra thick,mymagenta,dotted] (2.121,2.121)--(3.111,3.111);
            \node[] at (3.111,3.411) {\(-\frac{1}{\rho}\vec{\nabla}_h p\)};
            %FRICTION
            \draw[->,dash dot,ultra thick,myyellow] (2.121,2.121)--(1.73410465, 2.34530334);
            \node[] at (1.83410465, 2.74530334) {\(-\alpha\vec{u}_h\)};
            %VELOCITY
            \draw[->,ultra thick,mydarkblue] (2.121,2.121)--(3.34447053, 1.41169057);
            \node[] at (3.344,1.711) {\(\vec{u}_h\)};
            \node[] at (0,0) {High Pressure};
            \node[] at (0,-2.1) {Medium Pressure};
            \node[] at (0,-3.5) {Low Pressure};
        \end{tikzpicture}
        \caption{Anti-Cyclone: a \textbf{High} Pressure System. The fluid flows clockwise around an anti-cyclone in the northern hemisphere.}
    \end{subfigure}
    \caption{Cyclones and Anticyclones in the northern hemisphere (\(f>0\)) near the surface accounting for the effects of friction. Isobars are drawn as solid black lines \textcolor{black}{\rule{0.25cm}{0.25cm}}, the pressure gradient force \(\left( -\frac{1}{\rho}\vec{\nabla}_h p \right)\) as \textcolor{mymagenta}{thick dotted magenta arrows \rule{0.25cm}{0.25cm}}, the coriolis force \(\left( -f\vec{k}\times\vec{u}_h \right)\) as \textcolor{myorange}{thick dashed orange arrows \rule{0.25cm}{0.25cm}}, the velocity \(\left( \vec{u}_h \right)\) as \textcolor{mydarkblue}{thick filled dark blue arrows \rule{0.25cm}{0.25cm}}, and the friction \(\left( -\alpha\vec{u}_h \right)\) as \textcolor{myyellow}{dash dotted yellow arrows \rule{0.25cm}{0.25cm}}.}
    \label{f friction cyclone}
\end{figure}

As we can see then, the effects of friction imply that the surface of cyclones are horizontally convergent, while anticyclones are horizontally divergent. Since the fluid is approximately incompressible, there must be vertical ascent of air in cyclones and horizontal descent of air in anticyclones.

In both cases, the dynamics couples strongly with vertical ascent or descent of air parcels.

In the former case, this is associated with condensation, cloud formation, and therefore precipitation. It can also provide the energy needed to overcome \hyperref[Convection Box]{CIN} so that the parcels can access the \hyperref[Convection Box]{CAPE}. This is why cyclones are often associated with more unsettled weather.\footnote{You should notice that I am careful not to talk about causality here, and this should be a running theme throughout this chapter. We are examining \textit{diagnostic} relations that feature no time-derivatives, so it is very difficult to gain insight as to the dynamics and causality under this framework. It is just as easy to (naively) say (just because of the lack of information provided by this approach) that horizontal convergence leads to vertical ascent, or, that vertical ascent leads to horizontal convergence.}

This is also an mechanism whereby cyclones and anti-cyclones are dissipated, but we're getting ahead of ourselves. If you are familiar with \hyperref[PV]{Potential Vorticity}, then vertical ascent/descent in cyclones/anti-cyclones leads to vortex squashing/stretching, which decreases/increases the relative vorticity which effectively spins down cyclones and anti-cyclones throughout the atmosphere.

\section{Thermal Wind Balance}\label{s Thermal Wind}

Now that we have covered the fundamental diagnostic relations of \hyperref[Hydrostatic GFD Box]{Hydrostatic Balance} and \hyperref[Geostrophic Box]{Geostrophic Balance}, we now aim to put these two pieces of information together to find a relation between the horizontal velocity \(\vec{u}_h\) and the temperature in an ideal gas atmosphere.\footnote{
    I should note that when oceanographers refer to the `\textbf{thermal wind relation}', they do not require the fluid to follow the ideal gas equation of state. This should be expected, as seawater has a different, horribly complicated equation of state. As such, the `\textbf{thermal wind relation}' is often written as a relation between the horizontal velocity \(\vec{u}_h\) and the density \(\rho\).
}

We begin with Equations \ref{Hydrostatic Ideal Gas} and \ref{Geostrophic Ideal Gas} expressing respectively hydrostatic and geostrophic balance for an ideal gas. We first take the partial derivative with respect to \(z\) of Equation \ref{Geostrophic Ideal Gas}:
\begin{align*}
    \frac{\partial\vec{u}_h}{\partial z}&=\frac{\partial}{\partial z} \left( \frac{R}{f}\vec{k}\times \left( T\vec{\nabla}_h \ln p \right) \right)
    &
    \text{ ; }
    &
    \frac{\partial}{\partial z}\text{ of Eqn. \ref{Geostrophic Ideal Gas}}
    \\
    &=\frac{R}{f}\vec{k}\times\left( 
        \frac{\partial T}{\partial z}\vec{\nabla}_h \ln p
        +
        T\vec{\nabla}_h \frac{\partial \ln p}{\partial z}
     \right)
    &
    \text{ ; }
    &
    \text{Assume }\frac{\partial \bar{M}}{\partial z}=0\text{ and that partial derivatives commute}
    \\
    &=\frac{R}{f}\vec{k}\times\left( 
        \frac{\partial T}{\partial z}\vec{\nabla}_h \ln p
        -
        T\vec{\nabla}_h \frac{g}{RT}
    \right)
    &
    \text{ ; }
    &
    \text{Substitute Eqn. \ref{Hydrostatic Ideal Gas} for }\frac{\partial \ln p}{\partial z}
    \\
    &=\frac{R}{f}\vec{k}\times\left( 
        \frac{\partial T}{\partial z}\vec{\nabla}_h \ln p
        +
        \frac{g}{RT}
        \vec{\nabla}_h T
    \right)
    &
    \text{ ; }
    &
    \text{Apply chain rule}
    \\
    &=\frac{R}{f}\vec{k}\times\left( 
        \frac{\partial T}{\partial z}\frac{f}{RT} \vec{k}\times\vec{u}_h
        +
        \frac{g}{RT}
        \vec{\nabla}_h T
    \right)
    &
    \text{ ; }
    &
    \text{Substitute Eqn. \ref{Geo Bal} for }\vec{\nabla}_h\ln p
\end{align*}

Now we estimate each term in the final brackets in the final equation:
\begin{align*}
    \frac{\partial \vec{u}_h}{\partial z}=\frac{1}{fT}\vec{k}\times\biggl( 
        \underbrace{\overbrace{\frac{\partial T}{\partial z}}^{\sim\qty{1e-2}{\kelvin\per\meter}}
        \overbrace{f}^{\sim\qty{1e-5}{\per\second}}
        \vec{k}\times
        \overbrace{\vec{u}_h}^{\sim\qty{10}{\meter\per\second}}}_{\sim \qty{1e-6}{\kelvin\per\square\second}}
        +
        \underbrace{\overbrace{g}^{\sim\qty{10}{\meter\per\square\second}}
        \overbrace{\vec{\nabla}_h T}^{\sim\qty{1e-5}{\kelvin\per\meter}}}_{\sim\qty{1e-4}{\kelvin\per\square\second}}
    \biggr)
\end{align*}

So we see that even though horizontal temperature gradients \(\vec{\nabla}_h T\) are typically \(1000\) times weaker than vertical temperature gradients \(\frac{\partial T}{\partial z}\) (recall that temperature temperature gradients roughly follow the Lapse Rate in Equation \ref{Dry Adiabatic Lapse Rate}), it is the term that features the horizontal temperature gradient that ends up begin much larger than the term that features the vertical temperature gradient. We would not be able to make this approximation if the planet rotated much faster (\(f\) were larger) or if typical horizontal gradients were much smaller (\(\vec{\nabla}_h T\) were smaller)\footnote{Although, while \(f\) is a parameter set by the planet and not the fluid, we expect \(\vec{\nabla}_h T\) to be set by the dynamics governing the fluid, so whether/where this obtains is a bit more compliated.}.

As such, we neglect\footnote{
    We do not actually have to neglect this term when we derive these equations in pressure coordinates!
} the term on the left in the equation, and derive the \textbf{Thermal Wind Equations}:
\begin{align}\label{Thermal Wind}
    \BOX{\frac{\partial\vec{u}_h}{\partial z}\approx\frac{g}{fT}\vec{k}\times\vec{\nabla}_hT}
\end{align}

Written out, each component of \(\vec{u}_h=(u,v)^T\) is as follows:

\begin{minipage}{0.45\linewidth}
    \begin{align}
        \label{u Thermal}
        \BOX{\frac{\partial u}{\partial z} \approx-\frac{g}{f T}\frac{\partial T}{\partial y}}
    \end{align}
\end{minipage}
\hfill
\begin{minipage}{0.45\linewidth}
    \begin{align}
        \label{v Thermal}
        \BOX{\frac{\partial v}{\partial z} \approx \frac{g}{f T}\frac{\partial T}{\partial x}}
    \end{align}
\end{minipage}

\vspace{2mm}The physical interpretation is as follows: if the system is approximately both \hyperref[Geostrophic Box]{Geostrophic} and \hyperref[Hydrostatic GFD Box]{Hydrostatic}, and obeys ideal gas law, then horizontal temperature gradients imply vertical velocity gradients (and vice versa). Another name for vertical velocity gradients is vertical wind shear.

Let us now consider the vertical component of the vorticity. Recall that the voriticity is defined as follows: \(\vec{\omega}=\vec{\nabla}\times\vec{u}\). Therefore the vertical component is given by: \([\vec{\omega}]_z=\xi=\frac{\partial v}{\partial x}-\frac{\partial u}{\partial y}\). If we differentiate Equations \ref{u Thermal} and \ref{v Thermal} with respect to \(y\) and \(x\) (respectively), then subtract them we can find an equation governing \(\xi\):
\begin{align}
    \frac{\partial}{\partial x}\left( \frac{\partial v}{\partial z} \right) - \frac{\partial}{\partial y}\left( \frac{\partial u}{\partial z} \right)
    \approx
    \frac{g}{fT}\left( 
        \frac{\partial^2 T}{\partial x^2}+\frac{\partial^2 T}{\partial y^2}
     \right)\nonumber
     \\
    \label{Thermal Wind Vorticity}
    \therefore
    \BOX{
        \frac{\partial}{\partial z}\left( \frac{\partial v}{\partial x}- \frac{\partial u}{\partial y} \right)=
        \frac{\partial \xi}{\partial z}
        \approx
        \frac{g}{fT}\vec{\nabla}_h^2 T
    }
\end{align}

Now in the \hyperref[VC Interp]{Vector Calculus Interpretation Box} we interpreted the meaning of the gradient of a scalar field, but we are yet to interpret the \textbf{divergence} of the \textbf{gradient} of a scalar field. In this case, we specifically considering \(\vec{\nabla}_h^2 T\).

This encodes the \textit{curvature} of the temperature scalar field \(T(\vec{r},t)\). You will find that, if the temperature is constant or if the temperature increases at a constant rate in some direction, that this will be \(0\). However, if the temperature increases then decreases, or increases more and more, then this will be non-zero.

Therefore, Equation \ref{Thermal Wind Vorticity} essentially says that the vertical gradient of the vorticity \(\xi\) is set by the curvature of the temperature field \(T\). 

This might make more sense with a concrete example. Suppose that we have a blob of cold air, i.e., we have a temperature field \(T(\vec{r})\) that is minimum at the centre of the blob and warmer around the blob. If we consider \(\vec{\nabla}_h T(\vec{r})\) (which I remind you is a vector field which points from low \(T\) to high \(T\)), we would expect the vector field to look like arrows pointing away from the cold centre. Therefore the divergence of this vector field \(\vec{\nabla}_h^2 T\) will be \textbf{positive} at this cold blob.

If you wan't to think of this in terms of curvature, since the temperature decreases then increases again when you pass through this cold blob, this implies that the temperature field \(T(\vec{r})\) must be curved.  

Using Equation \ref{Thermal Wind Vorticity} \(\vec{\nabla}_h^2 T>0\) therefore implies that \(\frac{\partial \xi}{\partial z}>0\) (in the northern hemisphere), therefore the vertical vorticity increases with height in this cold blob! Vice versa for a hot blob in the northern hemisphere: in a hot blob will have vorticity decreasing with height. A cyclone with a cold core (the storms we tend to get in the UK) then will have its vorticity increase with height, having stronger winds the higher you go, while a cyclone with a hot core (tropical cyclones/hurricanes that we don't tend to get in the UK) will have its vorticity decrease with height.

\section{Pressure Coordinates}\label{Pressure Coords}
\subsection{Partial Derivative Identities}

To convert to pressure coordinates we must first introduce some identities from vector calculus involving partial derivatives. We will skip the proof, so you'll just have to take the following identities on trust:
\begin{align*}
    \left(\frac{\partial a}{\partial b}\right)_{c,d}=\left(\frac{\partial b}{\partial a}\right)_{c,d}^{-1}
\end{align*}
\begin{align*}
    \left(\frac{\partial a}{\partial b}\right)_c
    \left(\frac{\partial b}{\partial c}\right)_a
    \left(\frac{\partial c}{\partial a}\right)_b
    =-1
\end{align*}
where we have explicitly written which variables are held constant in the subscripts. We apply this to \(p\) and \(z\):
\begin{align}
    \label{P inverse}
    \left(\frac{\partial p}{\partial z}\right)_{x,y}=\left(\frac{\partial z}{\partial p}\right)_{x,y}^{-1}
\end{align}
\begin{align*}
    \left(\frac{\partial p}{\partial x}\right)_z
    \left(\frac{\partial x}{\partial z}\right)_p
    \left(\frac{\partial z}{\partial p}\right)_x
    =-1
\end{align*}
\begin{align*}
    \left(\frac{\partial p}{\partial y}\right)_z
    \left(\frac{\partial y}{\partial z}\right)_p
    \left(\frac{\partial z}{\partial p}\right)_y
    =-1
\end{align*}
where the last two equations become:
\begin{align}
    \label{P -1}
    \left(\vec{\nabla}_h p\right)_z=-\left(\vec{\nabla}_h z\right)_p\left(\frac{\partial p}{\partial z}\right)_{x,y}
\end{align}

We must be careful with which variables we are actually holding constant when transforming from height coordinates to pressure coordinates. Before this section, we have implicitly held \(z\) constant when calculating horizontal derivatives like \(\frac{\partial}{\partial x}\) or \(\frac{\partial}{\partial x}\). In practice, you should memorise Equations \ref{P inverse} and \ref{P -1} if you wish to reproduce this in an exam.

We will now apply this to four equations: \hyperref[Hydrostatic GFD Box]{hydrostatic balance} (\ref{Hydrostatic GFD}), \hyperref[Geostrophic Box]{geostrophic balance} (\ref{Geostrophic Balance}), thermal wind balance (\ref{Thermal Wind}), and mass conservation (\ref{Mass Conservation}) to derive their equivalent form in pressure coordinates. 

\subsection{Hydrostatic Balance}

Starting first from the hydrostatic relation (Equation \ref{Hydrostatic GFD}), we derive the equivalent relation expressing hydrostatic balance but in pressure coordinates using Equation \ref{P inverse}:
\begin{align*}
    -\rho g &= \left( \frac{\partial p}{\partial z} \right)_{x,y}
    \\
    &=\left( \left( \frac{\partial z}{\partial p} \right)_{x,y} \right)^{-1}
\end{align*}
\begin{align}
    \label{Hydrostatic Pressure}
    \therefore \BOX{
        \left( \frac{\partial \Phi}{\partial p} \right)_{x,y}
        =-\frac{1}{\rho}
    }
\end{align}
where we have defined the \textbf{geopotential height} \(\Phi\) as follows:
\begin{align}
    \label{eq Geopotential}
    \BOX{\Phi =g\,z}
\end{align}
There is nothing special about \textbf{geopotential height}. You can literally just think of \textbf{geopotential height} \(\Phi\) as the height variable \(z\) multiplied by \(g\). 

If we assume that the atmosphere consists of an ideal gas, then the following relation is the analogue for Equation \ref{Hydrostatic Balance Ideal}:
\begin{align}
    \boxed{\frac{\partial \Phi}{\partial \ln p}=-RT}
    \label{Hydrostatic Pressure Ideal}
\end{align}

\subsection{Geostrophic Balance}

We now turn to geostrophic balance. Again, starting from Equation \ref{Geostrophic Balance} but this time applying Equaiton \ref{P -1}:
\begin{align*}
    \vec{u}_h &= \frac{1}{\rho f}\vec{k}\times\left(\vec{\nabla}p\right)_z
    \\
    &=\frac{1}{\rho f}\vec{k}\times\left( 
        -\left( \vec{\nabla}_h z \right)_p \left( \frac{\partial p}{\partial z} \right)_{x,y}
     \right)
    \\
    &=\frac{1}{\rho f}\vec{k}\times\left( 
        -\left( \vec{\nabla}_h z \right)_p (-\rho g)
    \right)
\end{align*}
\begin{align}
    \label{Geostrophic Pressure}
    \therefore \BOX{
        \vec{u}_h = \frac{1}{f}\vec{k}\times\left( \vec{\nabla}_h \Phi \right)_p
    }
\end{align}
where we have used \hyperref[Hydrostatic GFD Box]{hydrostatic balance} to substitute for \(\frac{\partial p}{\partial z}\). Each component of \(\vec{u}_h\) is as follows:

\begin{minipage}{.48\linewidth}
    \begin{align*}
        \BOX{
            u = -\frac{1}{f}\left( \frac{\partial \Phi}{\partial y} \right)_p
        }
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{.48\linewidth}
    \begin{align*}
        \BOX{
            v = \frac{1}{f}\left( \frac{\partial \Phi}{\partial x} \right)_p
        }
    \end{align*}
\end{minipage}

\subsection{Thermal Wind Balance}

Thermal Wind Balance is particularly elegant in pressure coordinates, as we do not need to make the awkward scale analysis approximation we did in deriving Equation \ref{Thermal Wind} in height coordinates. We still need to assume that the system is in hydrostatic and geostrophic balance, and that the system is an ideal gas. To derive thermal wind balance in pressure coordinates, we simply take the derivative of Equation \ref{Geostrophic Pressure} with respect to \(\ln p\) (and make use of Equation \ref{Hydrostatic Pressure Ideal}):
\begin{align*}
    \left( \frac{\partial}{\partial \ln p} \right)_{x,y}\left( \vec{u}_h \right)
    &= \left( \frac{\partial}{\partial \ln p} \right)_{x,y}
    \left( \frac{1}{f}\vec{k}\times\left( \vec{\nabla}_h \Phi \right)_p \right)
    \\
    &= \frac{1}{f}\vec{k}\times\left( \vec{\nabla}_h \left( \frac{\partial \Phi}{\partial \ln p} \right)_{x,y} \right)_{p}
    \\
    &= \frac{1}{f}\vec{k}\times\left( \vec{\nabla}_h (-RT) \right)_{p}
\end{align*}
\begin{align}
    \therefore
    \BOX{
        \left( \frac{\partial \vec{u}_h}{\partial\ln p} \right)_{x,y}
        =
        -\frac{R}{f}\vec{k}\times \left( \vec{\nabla}_h T \right)_p
    }
\end{align}
Again, each component of \(\vec{u}_h\) is as follows:

\begin{minipage}{.48\linewidth}
    \begin{align*}
        \BOX{
            \left( \frac{\partial u}{\partial \ln p} \right)_{x,y}
            =\frac{R}{f}
            \left( \frac{\partial T}{\partial y} \right)_{p}
        }
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{.48\linewidth}
    \begin{align*}
        \BOX{
            \left( \frac{\partial v}{\partial \ln p} \right)_{x,y}
            =-\frac{R}{f}
            \left( \frac{\partial T}{\partial x} \right)_{p}
        }
    \end{align*}
\end{minipage}

\subsection{Mass Conservation}

I didn't mention this (due to brevity), but mass conservation (Equation \ref{Mass Conservation}) is ultimately derived by considering a fluid element with density \(\rho\) and volume \(\Delta V\). By definition, the following obtains:
\begin{align*}
    \frac{D}{Dt}\left( \rho\, \Delta V \right)=0
\end{align*}

We now note that \(\Delta V = \delta x\,\delta y\, \delta z\) and that, by the hydrostatic relation (Equation \ref{eq Hydrostatic Differential}), \(\rho\delta z = -\frac{1}{g}\delta p\). As such, we rewrite the above equation as follows:
\begin{align*}
    \frac{D}{Dt}\left( 
        -\delta x\,\delta y\, \delta p
     \right)
\end{align*}
which we identify as an expression constituting conservation of volume in pressure space.

As such, we define the `volume' in presure coordinates \(\Delta V_p = \delta x\,\delta y\, \delta p\) and derive:
\begin{align*}
    \frac{D}{Dt}\int_{V_p}\,dV_p
    &
    =
    \int_{S_p}\vec{\nabla}\cdot\vec{u}_h + \frac{\partial }{\partial p}
    \\
    &
    =
    \int_{S_p}\vec{\nabla}\cdot\vec{u}_h + \frac{\partial }{\partial p}
    \,
\end{align*}


[DERIVATION UNDER CONSTRUCTION]

A final implication of converting to pressure coordinates is that we now have a new `vertical velocity'. The old vertical velocity was defined as follows:
\begin{align*}
    w_z = \frac{D z}{Dt}
\end{align*}
However, in pressure coordinates, we now define `vertical velocity' as follows:
\begin{align*}
    w_p = \frac{D p}{Dt}
\end{align*}

Again, assuming that the system is hydrostatic allows us to approximate \(w_p\) the following way\footnote{
    Recall that the hydrostatic relation assumes that vertical variations in \(p\) are dominant, therefore we can approximate the material derivative of \(p\) as just the vertical advection component.
}:
\begin{align*}
    w_p &= \biggl( \underbrace{\frac{\partial }{\partial t} + u\left( \frac{\partial}{\partial x} \right)_{z}+v\left( \frac{\partial}{\partial y} \right)_{z}}_{\text{small }\therefore \text{ neglect}}+\underbrace{w_z \frac{\partial}{\partial z}}_{\text{big}} \biggr)\, p
    \\
    &\approx w_z \left( \frac{\partial p}{\partial z} \right)_{x,y}
    \\
    & = -w_z\rho g
\end{align*}

Recall Equation \ref{Mass Conservation} which states the following (this applies for both incompressible and compressible fluids):
\begin{align*}
    \frac{D\rho}{Dt}+\rho\vec{\nabla}\cdot\vec{u}=0
\end{align*}

Writing this in pressure coordinates gives us:
\begin{align*}
    0&=\left( 
        \frac{\partial}{\partial t} 
        + \vec{u}_h \cdot \left( \vec{\nabla}_h \right)_z
        + w_z \frac{\partial}{\partial z}
    \right)\rho
    + \rho \left( 
        \left( \vec{\nabla}_h  \right)_z \cdot \vec{u}_h
        + \frac{\partial}{\partial z}w_z
    \right)
    \\
    &=\left( 
        \frac{\partial}{\partial t} 
        + \vec{u}_h \cdot \left( \vec{\nabla}_h \right)_z
        - \frac{w_p}{\rho g} \frac{\partial p}{\partial z}\frac{\partial}{\partial p}
    \right)\rho
    + \rho \left( 
        \left( \vec{\nabla}_h  \right)_z \cdot \vec{u}_h
        - \frac{\partial p}{\partial z} \frac{\partial}{\partial p} \frac{w_p}{\rho g}
    \right)
    \\
    &=\left( 
        \frac{\partial}{\partial t} 
        + \vec{u}_h \cdot \left( \vec{\nabla}_h \right)_z
        + w_p \frac{\partial}{\partial p}
    \right)\rho
    + \rho \left( 
        \left( \vec{\nabla}_h  \right)_z \cdot \vec{u}_h
        +\rho g \frac{\partial}{\partial p} \frac{w_p}{\rho g}
    \right)
\end{align*}


Recall Equation \ref{Mass Conservation} which states the following (for an incompressible fluid):
\begin{align*}
    \frac{D\rho}{Dt}=\left( \frac{\partial }{\partial t} + u\left( \frac{\partial}{\partial x} \right)_{z}+v\left( \frac{\partial}{\partial y} \right)_{z}+w_z \frac{\partial}{\partial z}\right)\rho = 0
\end{align*}

\begin{align}
    \BOX{
        \left( \vec{\nabla}_h \cdot\vec{u}_h \right)_p
        +
        \frac{\partial w_p}{\partial z}=0
    }
\end{align}

\subsection{Some Pressure Coordinate Intuition}

It's useful to just go over a single example to gain some intuition regarding pressure coordinates and this `geopotential height' object, and how the height \(z\) could enter dynamically into the equations of motion.

Consider a system, like the Earth for example, that has an area of high pressure at 

[UNDER CONSTRUCTION]

\chapter{The Shallow Water System: 2D System}\label{Shallow Water System}

\section{The Equations of Motion}

In the previous chapter, we considered diagnostic relations: \hyperref[Hydrostatic GFD Box]{Hydrostatic Balance} and \hyperref[Geostrophic Box]{Geostrophic Balance}. These are very useful and important relations, but notice that there are no time derivatives in \ref{Hydrostatic GFD} and \ref{Geostrophic Balance}. If there are no time-derivatives, the equations cannot reproduce non-steady state solutions and time-evolution. However, clearly, the atmosphere and ocean evolve and are not in a steady state, and we wish to understand this.

Our first tool to consider time-dependent changes is the shallow water system. We consider a system governed the following equations and looks like this:

\begin{fact}{The Shallow Water System}{shallow box}\label{shallow box}

    The Shallow Water System is a simple two-dimensional time-varying system governing the evolution of a thin layer of incompressible fluid subject only to the pressure gradient and coriolis force.

    The three state variables are the horizontal velocity \(\vec{u}_h(x,y,t)=(u,v)^T\) and the layer thickness \(h(x,y,t)\). Equivalently, we can express the state variables as the horizontal velocity \(\vec{u}_h(x,y,t)=(u,v)^T\) and the layer height \(\eta(x,y,t)\).

    \begin{minipage}{.5\linewidth}
    \begin{gather}
        \label{SW mom}
        \BOX{\frac{D_h\vec{u}_h}{Dt}+f\vec{k}\times\vec{u}_h+g\vec{\nabla}_h\eta=0}\\
        \label{SW mass}
        \BOX{\frac{\partial h}{\partial t}+\vec{\nabla}_h\cdot(h\vec{u}_h)=0}\\
        \label{SW height}
        \BOX{h=\eta-b}
    \end{gather}
    where \(\frac{D_h}{Dt}=\frac{\partial}{\partial t}+u\frac{\partial}{\partial x}+v\frac{\partial}{\partial y}=\) the horizontal material derivative, \(\eta(x,y,t)=\) the height of the surface interface, and \(b(x,y)=\) the bottom interface (which is given).
    \end{minipage}
    \hfill
    \begin{minipage}{.48\linewidth}
    \begin{figure}[H]
        \centering
        \begin{tikzpicture}
            \draw[thick] (0,0) .. controls +(0.1,0.5) and +(-0.5,-0.5) .. (2,0) .. controls +(1,1) and +(-0.8,-1.6) .. (3.5,0) .. controls +(0.5,1) and +(-1,0) .. (5,0);
            \node[] at (6,0) {\(z=b(x,y)\)};
            \draw[thick] (0,4) .. controls +(0,0.1) and +(-1,-1) .. (1.8,4) .. controls +(1,1) and +(-0.5,-0.2) .. (4,4) .. controls +(0.5,0.2) and +(-0.5,0) .. (5,4);
            \node[] at (6.2,4) {\(z=\eta(x,y,t)\)};
            \draw[thick,<->] (4,3.92) -- (4,0.5);
            \node[] at (5,2) {\(h(x,y,t)\)};
            \node[] at (1.3,1.5) {\(\rho=\rho_0=const\)};
            \node[] at (1,2.6) {\(\vec{u}_h=\left( \begin{array}{c}u\\v\end{array} \right)\)};
        \end{tikzpicture}
        \caption{The Shallow Water System}
    \end{figure}
    \end{minipage}
\end{fact}

We now aim to derive these equations from three primitive (approximate) equations: the horizontal momentum equation (\ref{Horizontal Approximate}), the vertical momentum equation (\ref{Vertical Approximate}), and mass conservation (\ref{Mass Conservation}). First, we neglect all vertical and horizontal forces \(F_z\) and \(\vec{F}_h\) (e.g. neglect friction) other than gravity and pressure gradient forces.

Second, we assume that the density is constant \(\rho=\rho_0\) for all time and at all points. This immediately implies (from Equation \ref{Mass Conservation}) that the \(\frac{D\rho}{Dt}\) term vanishes, so Equation \ref{Mass Conservation} turns into:
\begin{align}
    \label{Incompressibility}
    \vec{\nabla}\cdot\vec{u}=0
\end{align}

Third, we assume that the system is \textbf{shallow}: \(H/L\ll 1\) where \(H\) is the vertical lengthscale and \(L\) is the horizontal lengthscale. If we estimate the size of the terms in \ref{Incompressibility}, we derive that the vertical velocity scale \(W\) is much smaller than the horizontal velocity scale \(U\): \(W\ll U\):
\begin{align*}
    \vec{\nabla}\cdot\vec{u}=0\\
    \underbrace{\vec{\nabla}_h\cdot\vec{u}_h}_{U/L}+\underbrace{\frac{\partial w}{\partial z}}_{W/H}=0\\
    \therefore \frac{U}{L}\sim\frac{W}{H}\text{   }\therefore
    \frac{W}{U}\sim\frac{H}{L}\\
    \therefore \boxed{W \ll U}
\end{align*}

We take this as justification for our fourth assumption: that vertical acceleration and advection is small compared to gravity and pressure gradient forces. As such, the system is in approximately in \hyperref[Hydrostatic GFD]{Hydrostatic Balance} (we have simplified Equation \ref{Vertical Approximate} here). Importantly, though, we do \textit{not} assume that the vertical acceleration/advection is \(0\) everywhere. We simply assume that they are much smaller than vertical pressure gradients and gravity.

This allows us to integrate the hydrostatic relation from some reference height \(\eta\) (the height of the surface) and pressure \(p_s\) (the pressure at the surface) to find that the following holds (refer to Equation \ref{Const Density Hydrostatic} to see the derivation).
\begin{align*}
    p(x,y,z,t)=\rho g(\eta(x,y,t)-z)+p_s(x,y,t)
\end{align*}

Fifth, we assume that the fluid above the layer of fluid under consideration has a much lower viscocity than the current layer or that it is much less dense than the other positions. This allows us to assume that \(\vec{\nabla}_hp_s\ll \vec{\nabla}_h\eta\), and that therefore \(\vec{\nabla}_h p \approx \rho_0 g \vec{\nabla}_h \eta\). As such, Equation \ref{Horizontal Approximate} becomes the following:
\begin{align*}
    \frac{D\vec{u}_h}{Dt}+f\vec{k}\times\vec{u}_h=g\vec{\nabla}_h\eta
\end{align*}

Notice that everything on the right hand side has no dependence on \(z\). However, it must hold for each all \(z\) within the layer, therefore, we can conclude that \(\vec{u}_h\) cannot depend on \(z\) either.\footnote{
    If it did, then the \(f\vec{k}\times\vec{u}_h\) term would depend on \(z\) and so left hand side would depend on \(z\). Depending on \(z\) implies that its value would change depending on \(z\), but the right hand side cannot change its value depending on \(z\), and so the equation would not hold for some \(z\).
} Therefore, we can neglect the vertical advection term in the material derivative:
\begin{align*}
    \frac{D}{Dt}=\frac{\partial}{\partial t}+u\frac{\partial}{\partial x}
    +v\frac{\partial}{\partial y}+\bcancel{w\frac{\partial}{\partial z}}
\end{align*}

This allows us to derive Equation \ref{SW mom}, which is an approximation of the horizontal momentum equation (\ref{Horizontal Approximate}):
\begin{align*}
    \boxed{\frac{D_h\vec{u}_h}{Dt}+f\vec{k}\times\vec{u}_h=g\vec{\nabla}_h\eta}
\end{align*}
where \(\frac{D_h}{Dt}=\frac{\partial}{\partial t}+u\frac{\partial}{\partial x}+v\frac{\partial}{\partial y}\) is the horizontal material derivative.

The interpretation is as follows: this is just horizontal momentum balance, where the horizontal acceleration is set by the coriolis force and the pressure gradient force, and no other forces. The pressure gradient force only depends on the height of the surface of the fluid, and the height affects the pressure through the hydrostatic relation.

Let us now turn to Mass Conservation Equation \ref{Mass Conservation}. We already derived from the \(\rho=\rho_0=const\) assumption that the system must be incompressible, so the following holds:
\begin{align*}
    \vec{\nabla}\cdot\vec{u}=\vec{\nabla}_h\cdot\vec{u}_h+\frac{\partial w}{\partial z}=0
\end{align*}

Let us integrate this equation with respect to \(z\) from \(z=b(x,y)\) to \(z=\eta(x,y,t)\) and recall first that \(\vec{u}_h\) is not a function of \(z\) and second that we assumed that \(w\) was much smaller than \(u,v\), not that \(w=0\). This allows us to derive the following:
\begin{align*}
    \int_{b}^{\eta} 0 \,dz &= \int_{b}^{\eta} \vec{\nabla}_h\cdot\vec{u}_h+\frac{\partial w}{\partial z}\, dz\\
    0&=h(x,y,t)\vec{\nabla}_h\cdot\vec{u}_h+\left[ w \right]_b^\eta\\
    &=h\,\vec{\nabla}_h\cdot\vec{u}_h + w(z=\eta)-w(z=b)
\end{align*}
\begin{align*}
    \therefore \boxed{0 = h\,\vec{\nabla}_h\cdot\vec{u}_h + w(z=\eta)-w(z=b)}
\end{align*}

Now it turns out (and this is justified by some fluid mechanical boundary conditions) that \(w(z=\eta)=\frac{D_h \eta}{Dt}\) and \(w(z=b)=\frac{D_h b}{Dt}\). The interpretation is as follows: the vertical velocity at an interface must be exactly equal to the change in interface height/depth following a fluid parcel, because if this weren't the case, we would get a fluid parcel phasing through the ground (as is the case at the bottom where \(z=b\)) or the fluid parcel is exactly what sets the change in the interface depth (as is the case at the top where \(z=\eta\)).

As such:
\begin{align*}
    w(z=\eta)-w(z=b)&=\frac{D_h \eta}{Dt}-\frac{D_h b}{Dt}\\
    &=\frac{D_h h}{Dt}\\
    &=\frac{\partial h}{\partial t}+ \vec{u}_h\cdot\vec{\nabla}_hh
\end{align*}

Therefore, we get that:
\begin{align*}
    0&=h\,\vec{\nabla}_h\cdot\vec{u}_h + w(z=\eta)-w(z=b)\\
    &=h\,\vec{\nabla}_h\cdot\vec{u}_h+\frac{\partial h}{\partial t}+ \vec{u}_h\cdot\vec{\nabla}_hh\\
    0&=\frac{\partial h}{\partial t}+\vec{\nabla}_h\cdot(h\vec{u}_h)
\end{align*}

We have derived Equation \ref{SW mass}. The interpretation for this equation is as follows: the height of a fluid can change, but it is constrained by the velocity of the fluid becauce the fluid is incompressible. If the height increases at some point, there must be more fluid flowing into that point than out of it, but since the fluid cannot compress, the height of the layer must increase.

We have derived all the equations of motion for the Shallow Water System, but the crux of the issue is whether or not this is a faithful representation of time-dependent geophysical fluid dynamics. Sadly, the details are quite complicated, and I'm not sure if I'll even get to them. If I do, they are at the end of this chapter in Section \ref{SW Justification}.

For now, just take this as granted, and let us start analysing this system.

\section{Energetics}

\subsection{Kinetic Energy and Available Potential Energy}\label{s SW energy}

Let us first consider the energy in the shallow water system, which the sum of the kinetic energy and the (gravitational) potential energy. Again, we would prefer to work in intensive variables, so we find these per unit area.

The kinetic energy per unit area \(KE\) is as follows:
\begin{align*}
    KE = \frac{1}{2}\underbrace{\rho_0\,V}_{m}\,u_h^2/A\\
    =\frac{1}{2}\rho_0\,A\,h/A\,u_h^2\\
    \therefore\BOX{KE = \frac{1}{2}\rho_0\,h\,u_h^2}
\end{align*}
where \(u_h=|\vec{u}_h|\). The idea is simple: it's just the kinetic energy divided by the unit area.

The potential energy per unit area is a little bit more complicated. To find this, we need to consider all the fluid parcels from \(z=b\) to \(z=\eta\) and sum the potential energy of all the fluid parcels.

Let us first consider a fluid parcel at height \(z\) with some height \(dz\) and width \(A\) (therefore, it has a volume equal to \(A\,dz\) and mass equal to \(\rho_0\,A\,dz\)). The potential energy of \textit{this} parcel (\(dPE\)) is as follows:
\begin{align*}
    dPE=\underbrace{\rho_0\,a\,dz}_{m}g\,z
\end{align*}
We have to sum this over all the fluid parcels from \(z=b\) to \(z=\eta\) so our total potential energy per unit area \(PE\) is as follows:
\begin{align*}
    PE &= \int_{z=b}^{z=\eta}dPE/A\\
    &= \int_{z=b}^{z=\eta}\underbrace{\rho_0\,A\,dz}_{m}g\,z/A\\
    &= \rho_0\,g\left[ \frac{1}{2}z^2 \right]_b^\eta\\
    &= \frac{1}{2}\rho_0\,g\left( \eta^2-b^2 \right)
\end{align*}

Now the final fiddly thing we have to do is to say that we don't actually care about the total potential energy – we care about the \textbf{available} potential energy. This is the potential energy available to be extracted by the system (by, e.g., conversion to kinetic energy). To find this, we must subtract the minimum potential energy from the total potential energy. The minimum potential energy state occurs if the surface is flat, i.e., if \(\eta=const\). We can simply define our coordinate system such that \(z=0\) at this flat surface so that \(\eta=0\) and that \(b<0\) in this minimum \(PE\) state. Therefore, the minimum \(PE\) density is:
\begin{align*}
    PE_{min}=-\frac{1}{2}\rho_0 \,g \,b^2
\end{align*}
Subtracting this off from our total \(PE\) per unit area gives us the total available potential energy per unit area:
\begin{align*}
    \BOX{PE = \frac{1}{2}\rho_0 \,g\,\eta^2}
\end{align*}
So the kinetic energy scales as \(h\,u_h^2\) while the available potential energy scales as \(g\,\eta^2\).

\subsection{Conservation of Energy}

We will now derive conservation of energy in a shallow water system. We first take the dot product of Equation \ref{SW mom} and \(\rho_0 \,h\,\vec{u}_h\). This gives us:
\begin{align*}
    0&=\rho_0 \,h\,\vec{u}_h\cdot\frac{\partial \vec{u}_h}{\partial t}+
    \rho_0 \,h\,\vec{u}_h\cdot \left( \vec{u}_h\cdot \vec{\nabla}_h \right)\vec{u_h}+
    f\rho_0 \,h\,\underbrace{\vec{u}_h\cdot \vec{k}\times\vec{u}_h}_{=0}+
    g\rho_0 \,h\,\vec{u}_h\cdot\vec{\nabla}_h\eta\\
    &=h\frac{\partial}{\partial t}\left( \frac{1}{2}\rho_0 u_h^2 \right)
    +h \vec{u}_h\cdot\vec{\nabla}\left( \frac{1}{2}\rho_0 u_h^2 \right)
    +h\vec{u}_h\cdot\vec{\nabla}\left( \rho_0 g \eta \right)
\end{align*}
where we have used chain rule to bring the \(u_h^2\)'s inside the derivatives. We next multiply Equation \ref{SW mass} with \(\frac{1}{2}\rho_0 u_h^2\) to get:
\begin{align*}
    \frac{1}{2}\rho_0 u_h^2\frac{\partial h}{\partial t}+\frac{1}{2}\rho_0 u_h^2 \vec{\nabla}_h\cdot\left( h\vec{u}_h \right)=0
\end{align*}
Adding these two equations together, and recalling product rule for derivatives, gives an equation governing the kinetic energy:
\begin{align*}
    \underbrace{\frac{\partial}{\partial t}\left( \frac{1}{2}\rho_0 h u_h^2 \right)}_{\text{Change in }KE}
    +\underbrace{\vec{\nabla}_\cdot\left( \vec{u}_h \frac{1}{2}\rho_0 h u_h^2 \right)}_{\text{Convergence/Divergence of }KE}
    +\underbrace{h\vec{u}_h \cdot\vec{\nabla}(\rho_0 g \eta)}_{\text{Conversion of }KE\text{ to }APE}=0
\end{align*}

Let us take some time to interpret this equation. The first term is straightforward: it is just the local change in \(KE\) per unit time. The second term is the convergence or divergence of \(KE\).

indicated by the second term, or from \(APE\) being converted into \(KE\). The second term is a flux because is the divergence of the kinetic 

We can form an equation governing potential energy directly by multiplying Equation \ref{SW mass} with \(\rho_0 g \eta\):
\begin{align*}
    \underbrace{\frac{\partial}{\partial t}\left( \frac{1}{2}\rho_0 g \eta^2\right)}_{\text{Change in }PE}
    +\underbrace{\rho_0 g \eta \vec{\nabla}\cdot \left( h\vec{u}_h \right)}_{\text{Conversion of }APE\text{ to }KE}
\end{align*}

Adding these equations together, we get an energy budget equation:
\begin{gather}
    \label{SW Energy}
    \BOX{
        \frac{\partial}{\partial t}\biggl( \underbrace{\frac{1}{2}\rho_0 h u_h^2 + \frac{1}{2}\rho_0 g \eta^2}_{E} \biggr)
        +
        \vec{\nabla}\cdot\biggl( 
            \underbrace{h\rho_0\vec{u}_h \left( \frac{1}{2}u_h^2+g\eta \right)}_{\vec{S}}
         \biggr)
        =0
    }\\
    \label{SW Energy Short}
    \frac{\partial E}{\partial t}+\vec{\nabla}\cdot\vec{S}=0
\end{gather}
where \(E\) is the total energy per unit area and \(\vec{S}\) is the energy flux vector. 

This is not just an energy conservation equation, it is a \textit{local} energy conservation equation. A local energy conservation equation imposes the constraint that change in the total energy at any point \(E\) must be exactly equal to the energy flux \(\vec{S}\) entering or leaving that area.

If we integrate equation \ref{SW Energy Short} around some closed area \(A\) with some boundary \(L\), we can apply the divergence theorem to find the following holds:
\begin{align*}
    \frac{\partial}{\partial t}\iint_A E \,dx\,dy = -\int_L \vec{S}\cdot\vec{n}\,dl
\end{align*}

Physically, \(E\) and \(\vec{S}\) are straightforward to interpret. \(E\), is the total energy, which is the sum of the kinetic and available potential energies. \(\vec{S}\) is the energy flux vector.

\section{Potential Vorticity}\label{PV}

We define the \textbf{potential vorticity} (\textbf{PV}) \(Q\) in this context as follows:
\begin{align*}
    \boxed{Q = \frac{f+\xi}{h}}
\end{align*}
\(Q\) is the absolute vorticity in the \(z\)-direction \([\vec{\omega}_a]_z\), which is the sum of the planetary vorticity in the \(z\)-direction \(f\) (the coriolis parameter!) and the relative vorticity in the \(z\) direction \(\xi=\frac{\partial v}{\partial x}-\frac{\partial u}{\partial y}\), divided by the thickness of the layer \(h\).

In a way, we can think of \textbf{PV} as encoding the two important properties of GFD: rotation and stratification. The rotation is encoded by the \(f+\xi\) term, which is the total (planetary+relative) vorticity in the \(z\)-direction. The stratification is encoded by the layer thickness \(h\). If \(h\) is small, then this implies that the layer of constant density is very thin, which implies that density in the broader fluid increases rapidly with height. Conversely, if \(h\) is large, then this implies that the layer of constant density is very thick, which implies that density in the broader fluid increases very slowly with height.

\subsection{Material Conservation of Potential Vorticity}

\subsubsection{Derivation}

We first take the \(z\) component of the curl Equation \ref{SW mom} (and recalling that \(f\neq const\)):
\begin{align*}
    \frac{D_h}{Dt}\left( \frac{\partial v}{\partial x}- \frac{\partial u}{\partial y}\right) + \left( \frac{\partial (fv)}{\partial y} + \frac{\partial (fu)}{\partial x}\right) = 0
    \\
    \therefore \frac{D_h \xi}{Dt} + \vec{\nabla}_h \cdot \left( f\vec{u}_h \right)= \frac{D_h \xi}{Dt} + f\vec{\nabla}_h \cdot\vec{u}_h + \vec{u}_h \cdot \vec{\nabla}_h f = 0
\end{align*}
Next, we rearrange Equation \ref{SW mass} as follows:
\begin{align*}
    \frac{D_h h}{Dt}+h\vec{\nabla}_h \cdot \vec{u}_h=0
\end{align*}
We now cancel out the \(\vec{\nabla}_h\cdot \vec{u}_h\) in both equations to obtain:
\begin{align*}
    \frac{D_h \xi}{Dt} - \frac{f}{h}\frac{D_h h}{Dt} + \vec{u_h}\cdot\vec{\nabla}f = 0
\end{align*}
Recalling that \(\frac{\partial f}{\partial t}=0\), therefore that \(\vec{u_h}\cdot\vec{\nabla}f=\frac{D_h f}{Dt}\), we rewrite the equation just in terms of material derivatives then divide the whole equation by \(h\):
\begin{align*}
    \frac{1}{h}\frac{D_h \xi}{Dt} +\frac{1}{h}\frac{D_h f}{Dt} - \frac{f}{h^2}\frac{D_h h}{Dt}=0
\end{align*}
Using product rule, this implies the following:

\begin{fact}{Material Conservation of Potential Vorticity}{Cons PV Box}\label{Cons PV Box}
    For a shallow water system, the \textbf{Potential Vorticity} (\textbf{PV}) \(Q\) is materially conserved: 

    \begin{minipage}{.48\linewidth}
        \begin{align}
        \label{SW Cons PV}
        \BOX{
            \frac{D_h Q}{Dt}=0
        }
    \end{align}
    \end{minipage}
    \begin{minipage}{.48\linewidth}
        \begin{align}
        \BOX{
            Q = \frac{f+\xi}{h}
        }
    \end{align}
    \end{minipage}
    
    \vspace{2mm} where \(\xi=\frac{\partial v}{\partial x}-\frac{\partial u}{\partial y}\) the relative vorticity. Equivalently, following a fluid parcel, the potential vorticity remains constant.
\end{fact}

\subsubsection{Interpretation}\label{ss PV interpretation}

We can interpret material conservation of potential vorticity by considering an infinitesimally thin column of fluid.

This column of fluid lies between the bottom (\(z=b\)) and top (\(z=\eta\)) of the layer, and is infintesimally thin. We impose that the column is infinitesimally thin to ensure that \(u\), \(v\), and \(h\) do not vary appreciably over the entire column. However, we \textit{must} consider the entire column of fluid because our assumption (in the derivation) that \(u\) and \(v\) do not vary with \(z\).

As this column of fluid is advected around, it must conserve its angular momentum in the \(z\)-direction. Suppose the column is initially rotating with some (total) angular velocity. If the column is stretched (i.e., if \(h\) increases), it become thinner (because the total volume of the column remains constant), and so it must therefore rotate faster to conserve angular momentum.

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
    \begin{scope}[xshift=-3cm]
        \draw[<->] (-1.5,0) -- (-1.5,-4);
        \node[] at (-1.75,-2) {\(h\)};
        \draw (0,0) ellipse (1 and 0.5);
        \draw (-1,0) -- (-1,-4);
        \draw (-1,-4) arc (180:360:1 and 0.5);
        \draw [dashed] (-1,-4) arc (180:360:1 and -0.5);
        \draw (1,-4) -- (1,0);
        \draw[->, ultra thick, mymagenta] (-1,-2) arc (180:360:1 and 0.5);
        \draw[->, ultra thick, mymagenta] (-1,-1.5) arc (180:360:1 and 0.5);
        \draw[->, ultra thick, mymagenta] (-1,-2.5) arc (180:360:1 and 0.5);
        %\fill [gray,opacity=0.5] (-1,0) -- (-1,-3.5) arc (180:360:1 and 0.5) -- (1,0) arc (0:180:1 and -0.5);
    \end{scope}
    \begin{scope}[xshift=3cm,yshift=-1.2cm]
        \draw (0,0) ellipse (2 and 0.5);
        \draw[<->] (-2.5,0) -- (-2.5,-1.6);
        \node[] at (-2.75,-0.8) {\(h\)};
        \draw (-2,0) -- (-2,-1.6);
        \draw (-2,-1.6) arc (180:360:2 and 0.5);
        \draw [dashed] (-2,-1.6) arc (180:360:2 and -0.5);
        \draw (2,-1.6) -- (2,0);
        \draw[->, ultra thick, mymagenta] (-2,-0.8) arc (180:360:2 and 0.5);
        %\fill [gray,opacity=0.5] (-1,0) -- (-1,-3.5) arc (180:360:1 and 0.5) -- (1,0) arc (0:180:1 and -0.5);
    \end{scope}
    \end{tikzpicture}
    \caption{Intuition behind the Conservation of Potential Vorticity. When the fluid column gets stretched vertically (i.e., \(h\) increases), the fluid must rotate (\textcolor{mymagenta}{magenta arrows \rule{0.2cm}{0.2cm}}) faster, and vice versa.}
\end{figure}

\section{A Brief Primer on Waves}\label{s Primer Waves}

In the previous section, we derived geostrophic balance and  hydrostatic balance.

However, the Earth is never in perfect balance, and perturbations and anomalies will occur, either because we have built a wind farm, or the sun is radiating differently, or because freshwater is being injected into certain areas in the oceans.

In this course, we analyse how systems respond to these anomalies by looking only for wave-like solutions: we plug in a solution that is proportional to \(\exp(i(\vec{k}\cdot\vec{x}-\omega t))\), where \(\vec{k}=(k_x,k_y,k_z)^T\in\mathbb{R}^3\) is the angular wavevector (the vector analogue of the wavenumber – refer to Section \ref{F, W, W} if you've forgotton what a wavenumber is) and \(\omega\) is the angular frequency.

The justification for plugging in this somewhat convoluted function is as follows. Practically, we want a function that is simple enough such that the solution is easy to interpret. However, we also want a function complicated enough such that it can encode certain spatial and time dependencies. This is why we pick the exponential function: it is simple but also encodes some spatial and temporal dependence. More fundamentally, any function\footnote{I think, please correct my maths if it's bad.} can be approximated by an infinite sum of periodic complex functions like \(\exp(i(\vec{k}\cdot\vec{x}-\omega t))\) -- we assume that these can be accurately approximated by a large enough sum.

In practice, though, you can just keep this in the back of your mind, and you'll mostly just be plugging in \(\exp(i(\vec{k}\cdot\vec{x}-\omega t))\) into the equations of motion. After plugging these in, we will find that \(\vec{k}\) and \(\omega\) are constrained by these equations, and solving for this constraint gives us a \textbf{Dispersion Relation}:
\begin{align*}
    \omega=\omega(\vec{k})
\end{align*} 

In other words, the frequency with which the perturbation oscillates is set by the spatial scale (or vice versa). This will give us valuable information regarding how these waves propogate. Furthermore, we expect the anomalies that generate/excite these waves to have a similar timescale/lengthscale based on general principles of how waves resonate. However, again, this is just a very cursory approximation. We know (e.g., from turbulence for example – think Kolmogorov's \(k^{-\frac{5}{3}}\) kinetic energy spectrum\footnote{As always, the atmosphere/oceans are far more complicated than this due at least in part to the presence of rotation. See Vallis \cite{Vallis} Ch. 12.}) that energy can propogate from one lengthscale to another. We also won't be studying wave-mean flow interaction here.

\subsection{The wave-vector and the angular frequency}

Physically, the wave-vector encodes the direction the wavefronts face. To see this, consider some field \(p\) which is proportional to \(\exp(i(\vec{k}\cdot\vec{x}-\omega t))\), i.e., let \(p = p_0 \exp(i(\vec{k}\cdot\vec{x}-\omega t))\). Let us draw contours of constant \(p\) at some time \(t\). To draw these contours, we solve for the values of \(\vec{x}\) that solve the following equation:
\begin{align*}
    p(\vec{x},t)=const
\end{align*}
where \(const\) is just any value (picking a different \(const\) will give you a different contour).

Since \(p\sim\exp(i(\vec{k}\cdot\vec{x}-\omega t))\), this implies that \(p\) is constant only for the values where \(\vec{k}\cdot\vec{x}\) is constant. These are picked out by the spatial points \(\vec{x}\) that can be written as follows:
\begin{align*}
    &\vec{x} = \vec{x}_0+\delta\vec{x}
    \\
    &\text{where }\delta\vec{x}\perp \vec{k}\text{ and }\vec{x}_0=another\,\, const
\end{align*}
Therefore the contours of constant \(p\), or the wavefronts, are perpendicular to \(\vec{k}\):

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \draw[very thin,color=gray, dashed] (-0.1,-0.1) grid (3.9,3.9);
        \draw[->] (-0.2,0) -- (4.2,0) node[right] {\(x\)};
        \draw[->] (0,-0.2) -- (0,4.2) node[above] {\(y\)};
        \draw[-,myorange] (0,1) -- (1,0); 
        \draw[-,myorange] (0,2) -- (2,0); 
        \draw[-,myorange] (0,3) -- (3,0); 
        \draw[-,myorange] (0,4) -- (4,0); 
        \draw[-,myorange] (1,4) -- (4,1);
        \draw[-,myorange] (2,4) -- (4,2);
        \draw[-,myorange] (3,4) -- (4,3);
        \draw[->,ultra thick, mydarkblue] (0.5,0.5) -- (2.5,2.5) node[above] {\(\vec{k}= \left( \begin{array}{c} k_x \\ k_y \end{array} \right) \)};
    \end{tikzpicture}
    \caption{A wave vector \(\vec{k}\) in the \((x,y)\) plane drawn with a \textcolor{mydarkblue}{thick blue arrow \rule{0.25cm}{0.25cm}}. Wavefronts lie perpendicular to the wavevector, drawn with \textcolor{myorange}{thin solid lines \rule{0.25cm}{0.25cm}}. Note, crucially, that it need not be the case that the energy or the wavefronts propagate in the direction of \(\vec{k}\).}
    \label{Wavefronts Fig}
\end{figure}

However, \(\vec{k}\) only really tells you about the wavelengths in each dimension and the orientation of the wavefronts. It \textbf{does not} tell you which direction the energy or the wavefronts propagate in. These propagate at the \textbf{phase} and \textbf{group} velocities, which we will talk about now.

\subsection{The Phase and Group Velocities}

The peaks and troughs in the wave (i.e., the wavefronts) will propogate with a \textbf{phase velocity} denoted by \(\vec{c}_p\), where the \(i\)th component \([\vec{c}_p]_i\) is found as follows:
\begin{align}
    \label{Phase Velocity}
    \BOX{[\vec{c}_p]_i=\frac{\omega}{[\vec{k}]_i}}
\end{align}

Meanwhile, the wave-packet and the energy will propogate with a \textbf{group velocity} denoted by \(\vec{c}_g\), where the \(i\)th component \([\vec{c}_g]_i\) is found as follows:
\begin{align}
    \label{Group Velocity}
    \BOX{[\vec{c}_g]_i=\frac{\partial\omega}{\partial [\vec{k}]_i}}
\end{align}
For example, in the \(x\) direction, the \textbf{group} and \textbf{phase velocities} are found as follows:
\begin{align*}
    [\vec{c}_p]_x=\frac{\omega}{k_x}\\
    [\vec{c}_g]_x=\frac{\partial\omega}{\partial k_x}
\end{align*}

This is a slightly confusing distinction, as you've most likely only encountered non-dispersive waves in the past, and non-dispersive waves are waves such that the phase velocity is equal to the group velocity (\(\vec{c}_g=\vec{c}_p\)). Since I can't insert any animations into these pdf notes, I'd highly recommend clicking on \href{https://resource.isvr.soton.ac.uk/spcg/tutorial/tutorial/Tutorial_files/Web-further-dispersive.htm}{this} website on dispersive waves. I'd especially pay attention to the little animations.

Now that you've thoroughly read that resource, we can interpret what this means in our context. Suppose that the pressure perturbation is proportional to \(\exp(i(\vec{k}\cdot\vec{x}-\omega t))\) where \(\omega=\omega(\vec{k})\) such that \(\vec{c}_p=\vec{c}_p(\vec{k})\) and \(\vec{c}_g=\vec{c}_g(\vec{k})\). Peaks and troughs propagate with a velocity set by the \textbf{phase velocity} \(\vec{c}_p=\vec{c}_p(\vec{k})\), so areas of low or high pressure (i.e., cyclones and anti-cyclones in mid-/high-latitudes) propogate at the velocity \(\vec{c}_p\). Meanwhile, the amplitude of this low or high pressure perturbation propagates with a velocity set by the \textbf{group velocity} \(\vec{c}_g=\vec{c}_g(\vec{k})\). You saw that, in general, this means that the energy propagates with the \textbf{group velocity}, \textit{not} the \textbf{phase velocity}.

\section{Inertia-Gravity/Poincaré Waves}\label{2D Poincare}

\subsection{Derivation}

We first linearise the Shallow Water Equations about a state of rest \(\vec{U}=0\) and layer thickness \(H\). For simplicity we assume a flat bed \(b=-H=const\). This is the first time we linearise in this course, so I will go through this a bit more carefully.

First, we write our variables as a sum of the unvarying quantity and the small perturbation:
\begin{align*}
    \vec{u}_h=\vec{U}+\vec{u}'\\
    h = H + h'\\
    \eta = N + \eta'
\end{align*}
where \(H\gg h'\) and \(N\gg \eta'\).\footnote{
    You might notice that we haven't required \(|\vec{U}|\gg \vec{u}'\). This is because, strictly speaking, \(\vec{U}=0\), so there is no way for \(\vec{U}\) to be much larger than \(\vec{u}'\). We need some other criterion on what we require for \(\vec{u}'\) to be `small'.
}

Second, we substitute these equations into the shallow water equations, then eliminate terms that are not zeroth or first order in the primed quantites. For example, for Equation \ref{SW height}:
\begin{align*}
    \frac{\partial}{\partial t}\left( H+h' \right)+\vec{\nabla}_h\cdot \left( (H+h')(\vec{U}+\vec{u}') \right)=0\\
    \frac{\partial}{\partial t}\left( H+h' \right)+\vec{\nabla}_h\cdot \left( H\vec{U}+H\vec{u}'+h'\vec{U}+\bcancel{h'\vec{u}'} \right)=0
\end{align*}

Third, we use the fact that \(H\), \(N\), and \(\vec{U}\) are constant (and that \(\vec{U}=0\)).
\begin{align*}
    \bcancel{\frac{\partial H}{\partial t}}+ \frac{\partial h'}{\partial t}+\bcancel{\vec{\nabla}_h\cdot \left( H\vec{U} \right)}+\vec{\nabla}_h\cdot \left(H\vec{u}'\right)+\vec{\nabla}_h\cdot \left(h'\bcancel{\vec{U}} \right)=0\\
    \frac{\partial h'}{\partial t}+H\vec{\nabla}_h\cdot\vec{u}'=0
\end{align*}

Doing the same for equation \ref{SW mom} allows us to derive the \textbf{Linearised Shallow Water Equations}.

\begin{fact}{The Linearised Shallow Water Equations}{L SW Eqn}\label{L SW Eqn}
    Linearising the \hyperref[Shallow Water System]{Shallow Water System} with a flat bottom (\(b=-H\)) about a state of rest where \(u=v=\eta=0\) and \(h=H\) by keeping only terms first order in small primed variables gives rise to the following equations: 
    \begin{gather}
        \label{SW Lin mass}
        \BOX{\frac{\partial \eta'}{\partial t}+H\vec{\nabla}_h\cdot \vec{u}'=0}\\
        \label{SW Lin mom}
        \BOX{
            \frac{\partial \vec{u}'}{\partial t}+f\vec{k}\times\vec{u}'
            +
            g\vec{\nabla}_h \eta'=0
        }
    \end{gather}
    Note that it is also possible to linearise the shallow water system about other background states. E.g., we could have lineraised about a state of \(v=\eta=0\), \(h=H\), and \(u=U\). This would analyse perturbations about a mean zonal flow.

    While we use these equations to analyse the time-dependent response of anomalies, note that actual phenomena are not always sufficiently represented by a linearised system – sometimes the anomalies are not small relative to the background state!
\end{fact}

I will now derive it slightly different to how Tim does it in his lecture series. In his lecture series, he does some cross differentiating and adding to eliminate \(\vec{u}'\) for an equation only in \(\eta'\). While this is more general than what I'm about to do, it is also (in my humble opinion) a bit less straightforward and hard to remember than what i'm about to do. Plus, both methods generate the same answer anyways.

We now let the following obtain for \(\eta'\) and \(\vec{u}'\):\footnote{
    You might be suspicious about what we've done here. After all, how can the height of a fluid be a complex number? You're right in that, strictly speaking, we should require that \(\eta'\in\mathbb{R}\). We can remedy this by simply stipulating that \(\eta'=\text{Re }\left( \eta' \right)\) (to abuse notation).
}
\begin{align*}
    &\eta' = \eta_0 \exp\left( ikx+ily-i\omega t \right)\\
    &\vec{u}' = \vec{u}_0' \exp\left( ikx+ily-i\omega t \right)=\left( \begin{array}{c}
        u_0\\v_0
    \end{array} \right)\exp\left( ikx+ily-i\omega t \right)
\end{align*}

Substituting this into the linearised shallow water equations gives us the following three equations:
\begin{align*}
    \left( -i\omega\eta_0 + H (iku_0+ilv_0) \right)\exp\left( ikx+ily-i\omega t \right)=0\\
    \left( -i\omega u_0-fv_0+gik\eta_0 \right)\exp\left( ikx+ily-i\omega t \right)=0\\
    \left( -i\omega v_0+fu_0+gil\eta_0 \right)\exp\left( ikx+ily-i\omega t \right)=0
\end{align*}

Because these equations must apply for all \(x,y,t\), we must impose that the coefficient in front of the exponential must be \(0\). We therefore get the following equations:
\begin{align}
    -i\omega\,\eta_0 + iHk\,u_0+iHl\,v_0 =0
    \nonumber
    \\
    igk\,\eta_0-i\omega\, u_0-f\,v_0+ =0
    \nonumber
    \\
    igl\,\eta_0+f\,u_0-i\omega \,v_0=0
    \nonumber
    \\
    \therefore
    \left( \begin{array}{ccc}
        -\omega & Hk & Hl \\
        igk & -i\omega & -f\\
        igl & f & -i\omega
    \end{array} \right)
    \left( \begin{array}{c}
        \eta_0\\
        u_0\\
        v_0
    \end{array} \right)
    =\vec{0}
    \label{Matrix Poincare}
\end{align}

Our goal is to find the dispersion relation governing \(\omega=\omega(k,l)\), but we want this dispersion relation to be arbitrary regardless of \(\eta_0\), \(u_0\), and \(v_0\) (and we expect these to be set by the nature of the initial perturbation that generates the waves). We also require that these \(\eta_0\), \(u_0\), \(v_0\neq 0\) so that we have non-trivial solutions (the trivial solution, is, of course, \(\eta'=0\), \(\vec{u}_h'=\vec{0}\)).

We can go about this two ways. First, we can just eliminate \(\eta_0\), \(u_0\), \(v_0\) via some algebra and this is fairly straightforward. Second, we write this in matrix form, as I have above, and recall(?) that if a matrix times a non-zero vector is equal to 0, then the determinant of the matrix must be zero. Using this second time-saving method we get:
\begin{align*}
   0 &=\det\left( \begin{array}{ccc}
        -\omega & Hk & Hl \\
        igk & -i\omega & -f\\
        igl & f & -i\omega
    \end{array} \right)
   \\
   &=-\omega \left|\begin{array}{cc}
        -i\omega & -f\\
        f & -i\omega
    \end{array} \right|
    -Hk \left|\begin{array}{cc}
        igk & -f\\
        igl & -i\omega
    \end{array} \right|
    +Hl \left|\begin{array}{cc}
        igk & -i\omega\\
        igl & f
    \end{array} \right|
    \\
    &=-\omega\left( -\omega^2+f^2 \right)
    -Hk \left( gk\omega +\bcancel{igfl} \right)
    +Hl \left( \bcancel{igfk} -gl\omega \right)
    \\
    0&=\omega\left( \omega^2 - f^2 - gH \left( k^2+l^2 \right) \right)
\end{align*}

We therefore obtain the following dispersion relation for \textbf{Poincaré/Inertia-Gravity Waves}:
\begin{align}
    \BOX{\omega=0}\,\text{ or }\,\BOX{\omega^2 = f^2 + gH \left( k^2 + l^2 \right)}
\end{align}

The first \(\omega=0\) solution implies that the wave is in a steady state, and does not propogate (since \(\vec{c}_p=\vec{c}_g=0\)). Plugging this into Equation \ref{SW Lin mom} (exercise!) shows that \(\vec{u}_h'\) is geostrophic! Furthermore, the phase and group velocities are also \(0\), thus implying (as expected) that geostrophic anomalies do not propagate. 

The second \(\omega^2=f^2+gH\left( k^2+l^2 \right)\) solution is more interesting. We now make an important simplification for ease of analysis. We call this the \textbf{\(f\)-plane approximation}.

\begin{fact}{The \(f\)-Plane Approximation}{f plane box}\label{f plane box}
    The \textbf{\(f\)-plane approximation} is the approximation where the coriolis parameter \(f\) is treated as constant:
    \begin{align*}
        \BOX{f\approx2\Omega\sin\phi_0=const}
    \end{align*}
    where \(\phi_0\) is the approximate latitude.
    
    Recall that, in reality, the coriolis parameter is actually \(f=2\Omega \sin \phi\), where \(\phi=\) the latitude. Recalling that \(y\) is the north-ward pointing coordinate, we expect \(\phi=\phi(y)\) so that \(f=f(y)\). The \textbf{f-plane approximation} ignores this, and approximates \(\phi=const\).
\end{fact}

Having made this simplification, we can make two further simplifications. First, we let \(l=0\) without loss of generality\footnote{
    We can make this simplification without loss of generality because fo the following reason: the shallow water system with an \(f-\)plane approximation is isotropic in the \(x,y\), plane, so, for any wave-vector \(\vec{k}=(k,l)^T\) we can just rotate the coordinate system to align with the \(k\) vector and the dynamics remain unchanged. As such, we can set \(l=0\), because for any wave with a non-zero \(l\), we can just reorient our coordinate system such that our \(x\)-axis aligns with the wavevector \(\vec{k}\) so that \(l=0\).
}. Second, we only consider the \(\omega>0\) solution. There is a difference between the \(\omega>0\) and \(\omega<0\) solution, but this isn't too relevant to what we wish to discuss (Exercise: solve for \(u_0\), \(v_0\) in terms of \(\eta_0\) and show that the sign of \(\omega\) affects this).

\subsection{Interpretation: Dispersion Relation, Phase/Group Velocities, and Long/Short-Wave Limits}

With our simplifications, our dispersion relation looks like this:

\begin{fact}{Inertial-Gravity/Poincaré Dispersion Relation}{IG SW box}\label{IG SW Box}
    The dispersion relation for Poincaré/Inertia-Gravity Waves in a Shallow Water System is as follows:
\begin{align*}
    \BOX{\omega(k)=(f^2+\underbrace{gH}_{gH\equiv c^2}\, k^2)^{\frac{1}{2}}}
\end{align*}
where we have defined \(c\equiv \sqrt{gH}=\) the speed\footnote{The phase or the group velocity? Wait and see\dots} at which gravitational waves propagate. If we plot \(\omega(k)\), it looks like this:
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[domain=-4:4]
        \draw[very thin,color=gray] (-3.9,-0.1) grid (3.9,3.9);
        \draw[->] (-4.2,0) -- (4.2,0) node[right] {\(k\)};
        \draw[->] (0,-0.2) -- (0,4.2) node[above] {\(\omega(k)\)};
        \draw[dashed,thick,myorange] plot (\x,{abs(\x)}) node[right] {\(\omega(k)=|ck|\)};
        \draw[dotted,thick,mymagenta] plot (\x,{1}) node[right] {\(\omega(k) = f\)};
        \draw[color=mydarkblue,ultra thick] plot (\x,{{sqrt(1+(\x)^2)}}) node[above] {\(\omega(k) = \sqrt{f^2+c^2\,k^2}\)};
    \end{tikzpicture}
    \caption{The dispersion relation for Poincaré Waves, drawn in \textcolor{mydarkblue}{filled blue \rule{0.25cm}{0.25cm}}. The long- and short-wave limits, respectively, are drawn in \textcolor{mymagenta}{dotted magenta \rule{0.25cm}{0.25cm}} and \textcolor{myorange}{dashed orange \rule{0.25cm}{0.25cm}}.}
    \label{Poincaré Graph}
\end{figure}
\end{fact}

\subsubsection{The Phase and Group Velocities}

Let us now calculate the phase and group velocities \(c_p\) and \(c_g\), which, I remind you, is the speed at which peaks/troughs and wave-packets/energy (respectively) propagate.
\begin{align*}
    c_p = \frac{\omega}{k}=\frac{\sqrt{f^2+c^2k^2}}{k}\\
    c_g = \frac{\partial \omega}{\partial k}=\frac{c^2k}{\sqrt{f^2+c^2k^2}}=\frac{c^2}{c_p^2}
\end{align*}
Doing some algebraic malipulation allows us to derive the following relation:
\begin{align*}
    \frac{c_g}{c_p}=\frac{\omega^2-f^2}{\omega^2}
\end{align*}
which implies that it is always the case that \(c_p>c_g\). Therefore, peaks and troughs travel faster than a wavepacket or energy does.

Let us now interpret directly the mechanisms that control the propagation of this wave (i.e., how Poincaré waves may propagate of anomalies). To do this, let us look at what \(\omega(k)\) in the limit of very large and very small \(k\). Of course, when we say \(k\) is large or small, we must specify large or small \textit{relative to what}. To this end, we define the \textbf{Rossby Deformation Radius} \(L_d\) as follows:
\begin{fact}{The Rossby Deformation Radius for a Shallow Water System}{SW Def Radius Box}\label{SW Def Radius Box}
    We define the \textbf{Rossby Deformation Radius} \(L_d\) for a Shallow Water System as follows:
    \begin{gather}
        \BOX{L_d = \frac{\sqrt{gH}}{f}}
    \end{gather}
    The Rossby deformation radius is a lengthscale which demarcates roughly when phenomena start `feeling' the effects of planetary rotation and the coriolis force. 

    Phenomena occuring on lengthscales much shorter than \(L_d\) do not `feel' the effects of rotation. Phenomena occuring on lengthscales much larger than \(L_d\) `feel' the effects of rotation strongly.
\end{fact}

To convince you of this fact, consider the following argument. Suppose that our horizontal velocity scale \(U\) is set by the speed at which gravitational waves propagate, i.e., \(U\sim\sqrt{gH}\). We know that the \hyperref[Rossby Box]{Rossby Number} indicates whether rotation is important relative to inertia: if \(Ro\ll 1\), then rotation is important and vice versa.

\(Ro=1\) exactly when the lengthscale \(L=L_d\). Therefore if \(L\gg L_d\), then \(Ro\ll1\), therefore rotation is important, adn vice versa.

We now consider the large and small \(k\) limits. Recall that \(k\) is the wavenumber, and so the wavelength of the wave \(\lambda\sim 1/k\). Therefore the lengthscale of the wave \(L\sim\lambda\sim 1/k\). Therefore if \(k\) is very large, then the lengthscale \(L\) is very short, and vice versa. It is for this reason that we call the following limits the \textbf{short-wave} and \textbf{long-wave} limits.

\subsubsection{The Short-Wave Limit and the Gravity Wave Mechanism}

In the \textbf{short-wave limit}, the wavelength of the wave is \textbf{very small}, so we impose that \(L\ll L_d\) and therefore that \(k \gg 1/L_d\). In this limit, \(c^2k^2\gg f^2\), and so in the shortwave limit:
\begin{align*}
    \boxed{\omega(k)\approx ck = \sqrt{gH}k}
\end{align*} 

In the \textbf{short-wave} limit then, the wave is what we call a \textbf{gravity wave}\footnote{Not to be confused with \href{https://en.wikipedia.org/wiki/Gravitational_wave}{gravitational waves}!}, and feels no effects of rotation! We can also think of this in terms of the Rossby Number. If \(U\sim\sqrt{g H}\) and \(L\ll L_d\), this implies that \(Ro\gg 1\). Since there is no other intrinsic timescale here, we can conclude that the the \(f\vec{k}\times\vec{u}_h\) is much smaller than both terms in Equation \ref{SW Lin mom}.

Such a wave is \textbf{non-dispersive}, meaning that \(c_g=c_p\). Calculating \(c_g\) and \(c_p\) in this limit shows the following to obtain:
\begin{align*}
    c_p = c=\sqrt{gH}\\
    c_g = c=\sqrt{gH}
\end{align*}
So gravity waves propagate at the speed \(c\), and do not disperse: the wave-packet stays together!

Recall that energy propagates at the group velocity \(c_g\). Therefore, small length-scale anomalies can propagate across the atmosphere/ocean at the speed \(c_g\). 

Now we can explain the mechanism for wave propagation in the \textbf{short-wave} limit. Suppose some phenomena generates a \(\eta'\) anomaly (for example, a hump in \(\eta'\)). Therefore, at this point, \(\vec{\nabla}_h \eta'\neq 0\). Recalling that the gradient of \(\eta'\) is a vector field pointing from low \(\eta'\) to high \(\eta'\), \(\vec{\nabla}_h \eta'\) will look like a vector field with vectors all pointing towards the centre of the hump.

Referring to Equation \ref{SW Lin mom} and neglecting the coriolis term implies that \(\frac{\partial \vec{u}'}{\partial t}\neq 0\), and must be equal and opposite to \(\vec{\nabla}_h \eta'\). Therefore, \(\frac{\partial \vec{u}'}{\partial t}\) looks like a vector field pointing outwards, so the fluid accelerates away from this hump.

The fluid accelerating away from this hump implies further that there is no a divergence of fluid at this hump and a convergence of fluid around the hump. Therefore \(\vec{\nabla}_h\cdot\vec{u}'>0\) at the hump and \(\vec{\nabla}_h\cdot\vec{u}'<0\) around the hump. Therefore, from Equation \ref{SW Lin mass}, at the hump \(\frac{\partial \eta'}{\partial \eta'}<0\) and around the hump \(\frac{\partial \eta'}{\partial \eta'}>0\) so the hump spreads outwards and this is how the wave propagates.

Physically, what is occuring is that \(\eta'\) anomalies generate in pressure anomalies (from the hydrostatic relation), and these pressure anomalies generate \(\vec{u}'\) anomalies, which turn generate \(\eta'\) anomalies, which propagates the wave. This is why we call these \textbf{gravity waves}, because the restoring force is gravity (as gravity is what generates the pressure anomalies via the hydrostatic relation).

\subsubsection{The Long-Wave Limit and the Inertia/Coriolis Wave Mechanism}

Let us now look at the \textbf{long-wave limit}. In the \textbf{long-wave limit}, the wavelength of the wave is \textbf{very large}, so we impose that \(L\gg L_d\) and therefore that \(k \ll 1/L_d\). In this limit, \(c^2k^2\ll f^2\), and so in the long-wave limit:
\begin{align*}
    \boxed{\omega(k)\approx f}
\end{align*}

In the \textbf{long-wave} limit, then, the wave is just an inertial oscillation: the wave feels only the effects of the coriolis force, and feels no effects of gravity. Again, we can also think of this in terms of the Rossby Number.

Let us now calculate \(c_g\) and \(c_p\) in this limit:
\begin{align*}
    c_p = \frac{f}{k}\\
    c_g = 0
\end{align*}
Again, recalling that energy propagates at the group velocity, we can conclude that large length-scale anomalies are `trapped': large length-scale anomalies \textit{cannot} propagate away from the source. 

To explain this, let us consider the mechanism for how this wave sustains itself. In this limit, rotation is dominant. Suppose, again, that there is some surface height \(\eta'\) anomaly. This, again, would imply that \(\vec{\nabla}_h\eta'\neq 0\), which by Equation \ref{SW Lin mom} would implies that \(f\vec{k}\times\vec{u}'\neq0\).

Since \(c_g=0\), \textbf{long-wave} Poincaré waves cannot transport energy, so in general this will not be the mechanism for propagation of long length-scale anomalies. We must turn to other mechanisms to explain this.

\subsection{Interpretation: Explicit Trajectories and Energetics}

\subsubsection{Explicit Solutions: Fluid Parcel Trajectories}

We now wish to find explicit solutions for \(\eta=\eta'\) and \(\vec{u}_h=\vec{u}'\). To do this, we must first find \(u_0\) and \(v_0\) in terms of \(\eta_0\) (we cannot solve for all three constants, as this will depend on properties of the initial perturbation, and we wish to keep analysis here general). Refering back to Equation \ref{Matrix Poincare}, we find (after some algebra) that the following obtains:
\begin{align*}
    &u_0 = \frac{\omega}{kH}\eta_0
    \\
    &v_0 = \frac{f}{kH}e^{-\frac{i\pi}{2}}\eta_0
\end{align*}
Next, we take only the real part of our solutions for \(\eta'\) and \(\vec{u}'\) (since heights and velocities must be real) to find the following expressions:
\begin{equation}
    \label{eq IG explicit}
    \begin{aligned}
    &\eta' = \eta_0 \cos(ikx-i\omega t)
    \\
    &u' = \frac{\omega}{kH}\eta_0 \cos(ikx-i\omega t)
    \\
    &v' = \frac{f}{kH}\eta_0 \sin(ikx-i\omega t)
    \end{aligned}
\end{equation}


Let's examine some behaviour. Both \(u'\) and \(v'\) scale inversely with \(kH\), so as the vertical wavelength increases (i.e., \(k\) decreases) or the layer thickness decreases so too does \(u'\) and \(v'\) for a given surface height anomaly \(\eta_0\). 

\(u'\) scales with \(\omega\), while \(v'\) scales with \(f\). This asymmetry is because we are only considering \(\vec{k}=(k,0)^T\) (i.e., \(l=0\)), so the velocity \textit{parallel} to the direction of \(\vec{k}\) scales as \(\omega\) while the velocity \textit{perpendicular} to \(\vec{k}\) scales as \(f\). Now \(\omega\geq f\) for all \(k\) (refer back to the \hyperref[IG SW Box]{dispersion relation}), so \(u'>v'\) always. In the shortwave limit (\(k\gg 1/L_d\)) especially, where the wave is essentially just a \textbf{gravity wave} which feels little effect of rotation, \(u'\gg v'\), and so the velocity is almost completely in the direction of propagation. Convsersely, in the longwave limit, \(\omega\sim f\), and so \(u'\sim v'\), so the dynamics are roughly isotropic.  

Finally, a quick rearrangement of \(u'\) and \(v'\) shows the following:
\begin{align*}
    \frac{u'^2}{\omega^2}
    +
    \frac{v'^2}{f^2}
    =
    \left( \frac{\eta_0}{kH} \right)^2
\end{align*}

\subsubsection{Energetics}

We now wish to investigate the energy in these waves. To do this, we calculate \(\bar{KE}\) and \(\bar{APE}\), the kinetic and available potential energies (respectively) \textit{averaged} spatially over a wavelength and temporally over a period:
\begin{align*}
    \bar{KE}=\frac{1}{T}\frac{1}{L_x}\frac{1}{L_y}
    \int_{0}^{T}
    \int_{0}^{L_x}
    \int_{0}^{L_y}
    \underbrace{\left( \frac{1}{2}\rho_0
    h
    u_h^2 \right)}_{KE}
    \,dx\,dy\,dt
    \\
    \bar{PE}=\frac{1}{T}\frac{1}{L_x}\frac{1}{L_y}
    \int_{0}^{T}
    \int_{0}^{L_x}
    \int_{0}^{L_y}
    \underbrace{\left( \frac{1}{2}\rho_0
    g
    \eta^2 \right)}_{PE}
    \,dx\,dy\,dt
\end{align*}
where \(T=\frac{2\pi}{\omega}\), \(L_x=\frac{2\pi}{k}\), and \(L_y=\frac{2\pi}{k}\).

For simplicity, again, we assume that \(l=0\), such that the meridional wavelength is infinite, i.e., there is no dependence on \(y\). As such, the integral with respect to \(y\) simply cancels out with the \(1/L_y\). Furthermore, since \(\eta'\) and \(\vec{u}_h'\) are small, we linearise such that the \(h\) in the \(\bar{PE}\) expression becomes a constant \(H\):
\begin{align*}
    \bar{KE}=\frac{1}{T}\frac{1}{L_x}
    \frac{1}{2}\rho_0
    H
    \int_{0}^{T}
    \int_{0}^{L_x}
    u_h^2
    \,dx\,dt
    \\
    \bar{PE}=\frac{1}{T}\frac{1}{L_x}
    \frac{1}{2}\rho_0
    g
    \int_{0}^{T}
    \int_{0}^{L_x}
    \eta^2
    \,dx\,dt
\end{align*}

Using our explicit expressions for \(u'\), \(v'\), and \(\eta\), and recalling that the integral of \(\cos^2\) over a period/wavelength is \(\frac{1}{2}\)\footnote{
    I.e., the fact that the following obtains:
    \begin{align*}
        \frac{1}{T}\frac{1}{L_x}
        \int_{0}^{T}
        \int_{0}^{L_x}
        \cos^2\left( ikx-i\omega t \right)
        \,dx\,dt = \frac{\omega}{2\pi}\frac{k}{2\pi}
        \int_{0}^{\frac{2\pi}{\omega}}
        \int_{0}^{\frac{2\pi}{k}}
        \cos^2\left( ikx-i\omega t \right)
        \,dx\,dt = \frac{1}{2}
    \end{align*}
}, we find:
\begin{gather*}
    \bar{KE} = \frac{1}{4}\rho_0\, H\, \eta_0^2\,\frac{\omega^2+f^2}{k^2}
    =\frac{1}{4}\rho_0\, \frac{1}{H^2}\, \eta_0^2\,\frac{c^2k^2+2f^2}{k^2}
    \\
    \bar{PE}=\frac{1}{4}\rho_0 \,g\, \eta_0^2
\end{gather*}

Interestingly, \(\bar{PE}\) has no dependence on the actual spatial size of the anomaly -- it only cares about the amplitude. Conversely, \(\bar{KE}\) has a strong dependence -- as \(k\) grows arbitrarily small, \(\bar{KE}\) goes to \(\infty\). Comparing the relative sizes of \(\bar{KE}\) and \(\bar{PE}\) gives:
\begin{align*}
    \frac{\bar{KE}}{\bar{PE}}=\frac{c^2k^2+2f^2}{c^2k^2}
\end{align*}

In the shortwave (gravity wave) limit, where \(c^2k^2\gg f^2\), we find that \(\frac{\bar{KE}}{\bar{PE}}\sim 1\) -- the energy is divided roughly evenly between the potential energy and the kinetic energy. Conversely, in the longwave (inertial oscillation) limit, where \(c^2k^2\ll f^2\), we find that \(\frac{\bar{KE}}{\bar{PE}}\gg 1\).

Physically, hopefully, this makes sense. In the shortwave limit, the wave is effectively a gravity wave, and does not feel the effects of rotation at all. The energy in the perturbation is split equally between Kinetic and Potential (following Equipartition). In the longwave limit, the wave is effectively an inertial oscillation, and does not feel the effects of gravity at all. Since potential energy can really only be stored gravitationally in this model, the inertial oscillation has a much higher kinetic energy.

The energy flux vector \(\vec{S}\) (from Equation \ref{SW Energy}) is given (in linearised form we throw away the \(u_h^2\) term) by the following:
\begin{align*}
    \vec{S}=\rho_0\,g\,H\,\vec{u}_h\,\eta
\end{align*}

[UNDER CONSTRUCTION]

% \subsection{Geostrophic Adjustment}\label{Geostrophic Adjustment}

[UNDER CONSTRUCTION]

which you can read about in Vallis' textbook on GFD \cite{Vallis}. The gist is this: anomalies and instabilities on a rotating planet cannot simply propagate away (e.g., via gravity flattening the surface of a fluid, for example) from the source to make the fluid more homogenous. It cannot because the fluid is on a rotating planet, and so must preserve some form of angular momentum.

As such, after anomalies begin propagating away, there will come a point (where the anomaly reaches the \hyperref[SW Def Radius Box]{Rossby Deformation Scale}) where it is deflected by the coriolis force, and the system evolves \textit{towards} geostrophic balance.

More details, again, can be found in Vallis' book.

\section{Rossby Waves}\label{s Rossby SW}

\subsection{The \texorpdfstring{\(\beta\)}{Beta}-Plane Approximation}

Before we discuss Rossby Waves, we must first introduce the \(\beta\)-plane approximation. The \(\beta\)-plane approximation is our step-up from the \(f\)-plain approximation of the coriolis \(f\) parameter. Now, instead of crudely approximating \(f=const\), we allow \(\beta\) to vary linearly in \(y\).

The idea is as follows. We first Taylor Expand the coriolis parameter \(f\) about some latitude \(\phi_0\):
\begin{align*}
    f(\phi)&=2\Omega \sin \phi\\
    &\approx \underbrace{2\Omega \sin \phi_0}_{f(\phi_0)}+\underbrace{2\Omega \cos \phi_0}_{f'(\phi_0)} (\phi-\phi_0)
\end{align*}

Next, we approximate the north-south coordinate \(y\approx a\phi\) (this amounts to the assumption that the \(y\) is small enough such that the Earth can be treated as roughly flat at that point).
\begin{fact}{The \(\beta\)-Plane Approximation}{beta plane box}\label{beta plane box}
    The \textbf{\(\beta\)-plane approximation} is the approximation where the coriolis parameter \(f\) is treated as linear in \(y\):
    \begin{align*}
        \BOX{f\approx \underbrace{2\Omega\sin\phi_0}_{\equiv f_0}+\underbrace{\frac{2\Omega\cos\phi_0}{a}}_{\beta} (y-y_0)}
    \end{align*}
    where \(\beta=\frac{\partial f}{\partial y}\).

    We require \(y-y_0\ll a\) for this approxmation to be accurate. This approximation can also be thought of as a Taylor Expansion of \(f\) about \(y=y_0\).
\end{fact}

\subsection{Derivation}

Our derivation of Rossby Waves is a little bit different from just plugging in an exponential solution. First, for simplicity, we assume that \(b=const\) for simplicity. This implies that \(\vec{\nabla}_h h'=\vec{\nabla}_h \eta'\) for simplicity. 

Second, we rearange Equation \ref{SW Lin mom} for the \(\vec{u}_h'\) in the coriolis term to find the following:

\begin{minipage}{.48\linewidth}
    \begin{align}
        \label{u Ro}
        u'=-\frac{g}{f}\frac{\partial h'}{\partial y}-\underbrace{\frac{1}{f}\frac{\partial v'}{\partial t}}_{\text{small}}
    \end{align}
\end{minipage}
\hfill
\begin{minipage}{.48\linewidth}
    \begin{align}
        \label{v Ro}
        v'=\frac{g}{f}\frac{\partial h'}{\partial x}+\underbrace{\frac{1}{f}\frac{\partial u'}{\partial t}}_\text{small}
    \end{align}
\end{minipage}

Third, we assume that \(Ro\ll 1\), therefore, we expect the flow to be approximately in geostrophic balance. We therefore approximate the second term in both of the above equations as small (as I've written).

Fourth, we rewrite those small terms by resubstituting in \(v'\) and \(u'\) and taking the time derivative. We do this by More taking our expression for \(v'\) in Equation \ref{v Ro}, then substitute \(v'\) into the small right-hand term in Equation \ref{u Ro}:
\begin{align*}
    u'&=-\frac{g}{f}\frac{\partial h'}{\partial y}-\frac{1}{f}\frac{\partial }{\partial t}v'\\
    &=-\frac{g}{f}\frac{\partial h'}{\partial y}-
    \underbrace{\frac{1}{f}\frac{\partial }{\partial t} \biggl( \frac{g}{f}\frac{\partial h'}{\partial x}+\overbrace{\frac{1}{f}\frac{\partial u'}{\partial t}}^\text{small} \biggr)}_\text{small}
    \\
    &=-\frac{g}{f}\frac{\partial h'}{\partial y}
    -\underbrace{\frac{g}{f^2}\frac{\partial^2 h' }{\partial t \partial x}}_\text{small}
    -\underbrace{\frac{1}{f^2}\frac{\partial^2 u'}{\partial t^2}}_\text{doubly small}
\end{align*}

Fifth, we neglect the doubly small term (the third term) by approximating it as \(0\).

Sixth, we use the \(\beta\)-plane approximation with the \(f\) in the first term and the \(f\)-plane approximation with the \(f^2\) in the second term. The justification for not using the \(\beta\)-plane approximation on both terms is as follows: the \(\beta\)-plane approximation is only valid if \(y-y_0\ll a\), therefore the \(\beta (y-y_0)\) term is much smaller than the \(f_0\) term. We therefore neglect this term for the same reason why we neglected the \(\frac{1}{f^2}\frac{\partial^2 u}{\partial t^2}\) term: it is doubly small. 

Repeating this for \(v'\) allows us to derive the following relations for \(u'\) and \(v'\):

\begin{minipage}{.48\linewidth}
    \begin{align*}
        u'=-\frac{g}{f}\frac{\partial h'}{\partial y}-\frac{g}{f_0^2}\frac{\partial^2 h'}{\partial t \partial x}
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{0.48\linewidth}
    \begin{align*}
        v'=\frac{g}{f}\frac{\partial h'}{\partial x}-\frac{g}{f_0^2}\frac{\partial^2 h'}{\partial t \partial y}
    \end{align*}
\end{minipage}

Now we plug in our expressions for \(u'\) and \(v'\) into Equation \ref{SW Lin mass} to derive the following equation governing \(h\):
\begin{align*}
    0&=\frac{\partial h'}{\partial t}+H\left( \frac{\partial u'}{\partial x}+\frac{\partial v'}{\partial y} \right)=0
    \\
    &= \frac{\partial h'}{\partial t}+H\biggl( 
        \underbrace{-\frac{g}{f}\frac{\partial^2 h'}{\partial y \partial x}-\frac{g}{f_0^2}\frac{\partial^3 h'}{\partial t \partial x^2}}_{\frac{\partial u'}{\partial x}}
        +
        \underbrace{\frac{g}{f}\frac{\partial^2 h'}{\partial x\partial y}-\frac{g}{f_0^2}\frac{\partial^3 h'}{\partial t \partial y^2}
        -\frac{g}{f^2}\beta \frac{\partial h'}{\partial y}}_{\frac{\partial v'}{\partial x}}
     \biggr)
    \\
    &=L_d^2\left( \frac{1}{L_d^2}\frac{\partial}{\partial t} + \frac{\partial}{\partial t}\vec{\nabla}_h^2 + \beta \frac{\partial}{\partial x}\right)h'
\end{align*}
where \(L_d=\) the \hyperref[SW Def Radius Box]{Rossby Deformation Scale}.

Again, we seek wave-like solutions, so we substitute in \(h'=h_0 \exp\left( ikx+ily-i\omega t \right)\) to derive the \textbf{dispersion relation} governing the propagation of Rossby Waves:

\begin{fact}{Rossby Wave Dispersion Relation}{R SW Dispersion}\label{R SW Dispersion}
\begin{gather}
    \BOX{\omega = \frac{-\beta k}{k^2 + l^2 + \frac{1}{L_d^2}}}
\end{gather}

\begin{figure}[H]
    \centering
    \begin{tikzpicture}[domain=-4:4]
        \draw[very thin,color=gray] (-3.9,-1.9) grid (3.9,1.9);
        \draw[->] (-4.2,0) -- (4.2,0) node[right] {\(k\)};
        \draw[->] (0,-2.2) -- (0,2.2) node[above] {\(\omega(k)\)};
        \draw[dashed,thick,myorange] plot (\x,{0}) node[above] {\(\omega(k)=0\)};
        \draw[domain=-2:2,dotted,thick,mymagenta] plot (\x,{-\x}) node[right] {\(\omega(k) = -L_d^2\beta k\)};
        \draw[samples=50,color=mydarkblue,ultra thick] plot (\x,{-\x/((\x)^2+1)}) node[below] {\(\omega(k) = \frac{-\beta k}{k^2+\frac{1}{L_d^2}}\)};
    \end{tikzpicture}
    \caption{The dispersion relation for Rossby Waves, drawn in \textcolor{mydarkblue}{filled blue \rule{0.25cm}{0.25cm}}. The long- and short-wave limits, respectively, are drawn in \textcolor{mymagenta}{dotted magenta \rule{0.25cm}{0.25cm}} and \textcolor{myorange}{dashed orange \rule{0.25cm}{0.25cm}}. For simplicity we have set \(l=0\).}
    \label{Rossby Graph}
\end{figure}
\end{fact}

\subsection{Interpretation}

Note that we can no longer set \(l=0\) without loss of generality, as the system is no longer isotropic. There is a difference between the \(y-\)direction and the \(x-\)direction: \(f\) increases in the \(y-\)direction, but \(f\) does not depend on the \(x-\)direction.

\subsubsection{The Phase and Group Velocities}

Again, let us calculate the phase and group velocites in the \(x\)-direction.
\begin{align*}
    [\vec{c}_p]_x = -\frac{\beta}{k^2+l^2+\frac{1}{L_d^2}}
    \\
    [\vec{c}_g]_x = \beta\left( \frac{k^2-l^2-\frac{1}{L_d^2}}{k^2+l^2+\frac{1}{L_d^2}} \right)
\end{align*}

Notice that the \(x-\)component (i.e., the zonal/east-west component) of the phase velocity \(\vec{c}_p\) is always negative (since \(\beta>0\) always). This implies that the phase velocity is always westwards, and so peaks and troughs \textit{always} travel westward. We will explain this later when we explain the mechanism for Rossby Wave propagation.

Let us now turn to the \(x-\)component of the group velcoity \(\vec{c}_g\). The group velocity can be positive or negative depending on both the zonal and meridional wavelengths and their size relative to the Rossby Deformation Radius \(L_d\). If \(k\) is large relative to both \(l\) and \(1/L_d\) (i.e., the zonal wavelength is small relative to both the meridional wavelength and the Rossby Deformation Radius) then energy can propagate eastward. Conversely, if either \(l\) or \(1/L_d\) is large relative to \(k\), then energy also propagates westward.

\subsubsection{Rossby Wave Propagation Mechanism}

Recall that \hyperref[PV]{Potential Vorticity} is \hyperref[Cons PV Box]{Materially Conserved} in the shallow water system. As such, any fluid parcel that is displaced by this anomaly/wave must have its potential vorticity remain constant.

Suppose that some phenomena generates an anomaly in \(\vec{u}_h'\) such that a fluid parcel is pushed northwards (i.e., in the positive \(y\)-direction). If the fluid parcel is advected northwards, then the planetary vorticity \(f\) increases. However, \((f+\xi)/h\) must be constant, and assuming that the change in \(h\) is small, we require \(\xi\) to decrease, which generates negative vorticity. The fluid parcels around this parcel are therefore forced accordingly: the parcels to the west are forced northward, and the parcels to the east are forced southward.

[FIGURE UNDER CONSTRUCTION]

Note that this explanation only works if the \(Ro\) is not extremely small. However, in the ocean, \(Ro\) is extremely small, and this implies that the relative vorticity is always much smaller than the planetary vorticity. Here is an alternative explanation for the ocean (courtesy of \href{https://www.physics.ox.ac.uk/our-people/marshalld}{David Marshall}). In the ocean, since \(Ro\ll 1\), the perturbations must be geostrophic. Therefore, \(u\) is always geostrophic and the following obtains:
\begin{align*}
    u = - \frac{g}{f(y)}\frac{\partial \eta}{\partial y}
\end{align*}

Suppose we have a bump in the ocean (i.e., a positive height anomaly). Since there is a height anomaly, there is also a pressure anomaly, the pressure is larger in the bump. Since the flow must be geostrophic, this implies that the fluid must be anti-cylonic and must be flowing clockwise in the northern hemisphere (recall our discussion on cyclones and anti-cyclones in Section \ref{Cyclones}).

However, recall that \(u\sim 1/f\) because it is geostrophic, therefore at the north edge of the height anomaly, the \(f\) is larger, therefore \(u\) is smaller, and at the south edge of the height anomaly \(f\) is smaller, therefore \(u\) is larger. This implies that there is more fluid flowing westward than there is fluid flowing eastward, therefore there is a convergence of fluid westward and a divergence of fluid eastwards. This means that the hump travels westwards, thus explaining the westward propagation of Rossby Waves in the ocean.

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \draw[fill=none](0,0) circle (1.5);
        \draw[fill=none](0,0) circle (3);
        \draw[fill=none,dotted](-3,0) circle (1.5);
        \draw[fill=none,dotted](-3,0) circle (3);
        \draw[->,thick,mydarkblue] (0,3) arc[start angle=90, end angle=-90, radius=3cm];
        \draw[->,ultra thick,mydarkblue] (0,3)--(1,3);
        \node[] at (2.5,3.5) {\(u_{\text{north}}=-\frac{g}{f(y+\delta y)}\frac{\partial \eta}{\partial y}<u_\text{south}\)};
        \draw[->,line width=3pt,mydarkblue] (0,-3)--(-1.5,-3);
        \node[] at (0.5,-3.5) {\(u_{\text{south}}=-\frac{g}{f(y)}\frac{\partial \eta}{\partial y}>u_\text{north}\)};
        \node[] at (0,0) {High \(\eta\)};
        \node[] at (0,-2.1) {Medium \(\eta\)};
        \node[] at (0,-4.5) {Low \(\eta\)};
        \node[] at (-5,0.25) {Convergence of fluid};
        \node[] at (-5,-0.25) {\(\therefore \frac{\partial h}{\partial t}>0\)};
        \node[] at (5,0.25) {Divergence of fluid};
        \node[] at (5,-0.25) {\(\therefore \frac{\partial h}{\partial t}<0\)};
        \node[] at (-2,4) {\textbf{Westward Phase Propagation}};
        \draw[->,ultra thick,myorange] (-0.5,3.5) -- (-3.5,3.5); 
    \end{tikzpicture}
    \caption{Alternative Explanation of the Westward Phase Propagation of Rossby Waves. Since \(\beta=\frac{df}{dy}>0\) and \(u\sim 1/f\), \(u_{\text{north}}<u_\text{south}\), therefore there is a convergence of fluid on the east and a divergence of fluid on the west. Solid black lines indicate \(\eta\) at time \(t=t\), while dotted black lines indicate \(\eta\) at time \(t=t+\delta t\).}
\end{figure}

\section{Kelvin Waves}\label{s Kelvin}

For Rossby Waves, we assumed that the anomalies were to leading order \hyperref[Geostrophic Box]{geostrophic}, which recall is a balance between the the corilis force and the pressure gradient force. There are at least two cases where the flow cannot be to leading order geostrophic. In both cases, the coriolis force is too small to support a non-zero pressure-gradient.

The first case is along a boundary or a coastline. A fluid cannot flow into a boundary or a coastline\footnote{
    This is often called the `no-penetration boundary condition'. Mathematically, it's expressed as follows: let the boundary of the fluid be specified by some function \(f(x,y,z)=0\) and let \(\vec{n}\) be the vector normal to the surface (which should be parallel to \(\vec{\nabla}f\) remember!). Then, for all \(x,y,z\) that satisfy \(f(x,y,z)=0\), the following relation must hold:
    \begin{align*}
        \vec{n}\cdot\vec{u}(x,y,z)|_{f(x,y,z)=0}=0
    \end{align*}
}, and so must flow parallel to it (if there is any flow at all). As such, there can be no coriolis forces acting parallel to the boundary (since, remember, the coriolis force \(=f\vec{k}\times\vec{u}\) and so is at right angles to the velocity) because no fluid can flow into the wall. As such, geostrophic balance cannot obtain parallel to the coast (or along the coast) because pressure gradients in this direction cannot be supported by coriolis forces.

I should note that, in this case, we ruled out the flow being geostrophic in a certain direction. This does \textit{not} prohibit the flow from being geostrophic in other directions!

The second case is along the equator, where \(\Omega=0\), therefore \(f= 0\). In this case, while \(\vec{u}\) may flow across the equator, the coriolis force still vanishes \textit{at} the equator. As such, there can also be no geostrophic balance here.

\subsection{Coastal Kelvin Waves}

\subsubsection{Derivation}

For simplicity, let us consider a flat boundary in the meridional direction. I.e., let the surface be expressed by the function \(f(x,y,z)=x=0\). As such, we require that \(u(x=0,y,z)=0\) at every point in the fluid (since the fluid cannot flow into the boundary).

To derive the dispersion relation for Coastal Kelvin we anticipate that \(u=0\) for \textbf{all} \(x\). I should emphasise how \textit{strong} this assumption is. The boundary only requires that \(u=0\) for \(x=0\) (i.e., there can be no zonal flow \textit{at} the boundary), but we are now imposing the much stronger assumption that \(u=0\) for \textbf{all} values of \(x\) (i.e., there is no zonal flow \textit{anywhere}). You should question how realistic this assumption is\dots\footnote{See this paper if you're curious for another treatment \cite{M&H13}.}

Setting \(u=0\) everywhere reduces our set of \hyperref[L SW Eqn]{linearised equations of motion} to the following three equations (being the momentum equations and the mass equation):
\begin{align}
    \label{eq Coastal Kelvin u}
    -fv+g\frac{\partial h}{\partial x}=0
    \\
    \label{eq Coastal Kelvin v}
    \frac{\partial v}{\partial t}+g\frac{\partial h}{\partial y}=0
    \\
    \label{eq Coastal Kelvin h}
    \frac{\partial h}{\partial t}+H\frac{\partial v}{\partial y}=0
\end{align}

Differentiating Equation \ref{eq Coastal Kelvin v} with respect to \(y\) and Equation \ref{eq Coastal Kelvin h} with respect to \(t\), then substituting for \(\frac{\partial^2 v}{\partial t \partial y}\) gives us the following wave equation for \(h\):
\begin{align*}
    \frac{\partial^2 h}{\partial t^2}-\underbrace{gH}_{=c^2}\frac{\partial^2 h}{\partial y^2}=0
\end{align*}
The general solution to this equation is (derived without using our \(\exp\left( ikx+ily - i\omega t \right)\) strategy):
\begin{align*}
    h(x,y,t)=A(x)f(y-ct)
\end{align*}
where \(c=\pm\sqrt{gH}=\) the gravity wave speed, again! Note that we've found that this wave is non-dispersive in the \(y\)-direction (since we can write \(f(y-ct)=f(\frac{1}{l}(ly-\omega t))\) where \(\omega = cl\)), so the phase and group velocities are identical and travel with velocity \(c=\pm\sqrt{gH}\) in the meridional direction. In other words, our solution (so far) allows the wave to travel up and down the coastline. As written above (in the \(f(y-ct)\) form), if \(c>0\) then the wave propagates northward and if \(c<0\) the wave propagates southward.\footnote{
    If we had written it as \(f(y+ct)\), \(c>0\) would correspond to the wave propagating southward and \(c<0\) would correspond to the wave propagating northward. This is convention that we must pick at the outset, and remain consistent throughout.}
However, wee have not yet derived a constraint for the sign of \(c\).\footnote{I.e., whether \(c=\sqrt{gH}\) or \(c=-\sqrt{gH}\).} 

To find the dependence on \(A(x)\), we differentiate Equation \ref{eq Coastal Kelvin u} with respect to \(t\) and substitute for \(\frac{\partial v}{\partial t}\) in Equation \ref{eq Coastal Kelvin v}:
\begin{align*}
    \frac{\partial^2 h}{\partial t \partial x}+f \frac{\partial h}{\partial y}=0
\end{align*}
and substitute in our expression for \(h\), which gives the following equation for \(A(x)\):
\begin{align*}
    -c \frac{dA}{dx}-fA(x)=0
\end{align*}
which has the solution:
\begin{align*}
    A(x)=h_0 e^{-\frac{f}{c}x}=h_0 e^{\mp \frac{x}{L_d}}
\end{align*}
where \(L_d\) is the \hyperref[SW Def Radius Box]{Rossby Deformation Radius} (it's back again!).

\textit{This} relation, combined with a suitable boundary condition, will end up constraining the sign of \(c\). Note first that \(A(x)\) (and therefore \(h(x)\)) is exponential in \(x\), and therefore will tend towards \(\infty\) when \(x\) becomes big and positive or negative, depending on the sign of \(f/c\).

The sign of \(f/c\) is therefore crucial to understanding the \(x\)-dependence. If \(f/c>0\), \(h\to\infty\) as \(x\to -\infty\). Conversely, if \(f/c<0\), \(h\to\infty\) as \(x\to\infty\). To simplify things, let us first consider just the Northern hemisphere such that \(f>0\). The sign of \(f/c\) is therefore equal to the sign of \(c\).

We first consider a western boundary such that there is fluid for \(x>0\) but no fluid for \(x<0\). If \(c=\sqrt{gH}>0\), then \(f/c>0\), therefore the perturbation 

[UNDER CONSTRUCTION]

\subsubsection{Interpretation}



\subsection{Equatorial Kelvin Waves}

[UNDER CONSTRUCTION]

\section{The Effects of Stratification: the Reduced Gravity System}\label{s Reduced Gravity}

As mentioned in Section \ref{GFD Special}, the two important properties of GFD are rotation and stratification. We already consider the effects of rotation in the Shallow Water System by introducing the coriolis force (the \(f\vec{k}\times\vec{u}_h\) term) into Equation \ref{SW mom}. However, we have not yet considered stratification.

Now we consider a twist on the shallow water system. Instead of considering one single layer of fluid, consider two layers of fluid. We will be modelling the motion of the fluid in the top layer with density \(\rho=\rho_0\). We assume that this top layer is bounded from above by a fluid of negligible density, such that it is almost always flat. We assume further that this top layer is bounded from below by a fluid of density \(\rho_1=\rho_0+\Delta \rho_0\) with no horizontal fluid motion (See Figure \ref{RG Fig}).

Analogous to how we derived the shallow water equations, we now derive the reduced gravity equations. We make the identical assumptions as before, but our treatment of the horizontal pressure gradients \(\vec{\nabla}_h p\) must differ due to the different configuration.

As before, we assume that the system is approximately in hydrostatic balance. The pressure between \(z=0\) and \(z=-h\) must be given by the following:
\begin{align*}
    p(x,y,z,t)= -\rho_0 g z + p_s(x,y,t)
\end{align*}
Taking the horizontal gradient of this gives us the following:
\begin{align*}
    \vec{\nabla}_h p = \vec{\nabla}_h p_s
\end{align*}

Note importantly that, as opposed to our derivation of the shallow water equations, we can no longer neglect the \(\vec{\nabla}_h p_s\) term, as this term is the leading order contribution to \(\vec{\nabla}_h p\) – if we neglected this term, \(\vec{\nabla}_h p=0\)!

We now consider the pressure below \(z=-h\), again found hydrostatically:
\begin{align*}
    p(x,y,z,t) = -\rho_1 g ( h(x,y,t) + z) + \rho_0 g h(x,y,t) + p_s(x,y,t)
\end{align*}
However, we have assumed that the horizontal velocity in this layer is \(0\), which implies that horizontal pressure gradients within this layer must vanish, i.e., \(\vec{\nabla}_h p(x,y,z<-h,t)=0\). This condition gives un an expression for \(\vec{\nabla}_h p_s\), which in turn gives us an expression for\( \vec{\nabla}_h p\):
\begin{align*}
    0 = -\rho_1 g \vec{\nabla}_h h + \rho_0 g \vec{\nabla}_h h + \vec{\nabla}_h p_s
    \\
    \therefore - \vec{\nabla}_h p_s = - (\rho_1 - \rho_0)\vec{\nabla}_h h
\end{align*}

The mass conservation equation is derived identically to before. We thus derive the \textbf{Reduced Gravity Equations}:

\begin{minipage}{0.48\linewidth}
    \begin{gather}
        \label{RG mom}
        \BOX{\frac{D_h\vec{u}_h}{Dt}+f\vec{k}\times\vec{u}_h+g'\vec{\nabla}_h h=0}\\
        \label{RG mass}
        \BOX{\frac{\partial h}{\partial t}+\vec{\nabla}_h\cdot(h\vec{u}_h)=0}
    \end{gather}
\end{minipage}
\hfill
\begin{minipage}{0.48\linewidth}
    \begin{figure}[H]
        \centering
        \begin{tikzpicture}
            \draw[thick] (0,0) .. controls +(0.1,0.5) and +(-0.5,-0.5) .. (2,0) .. controls +(1,1) and +(-0.8,-1.6) .. (3.5,0) .. controls +(0.5,1) and +(-1,0) .. (5,0);
            \node[] at (6.4,0) {\(z=-h(x,y,t)\)};
            \draw[thick] (0,4) -- (5,4);
            \node[] at (6,4) {\(z=0\)};
            \draw[thick,<->] (4,3.92) -- (4,0.5);
            \node[] at (5,2) {\(h(x,y,t)\)};
            \node[] at (1.3,1.5) {\(\rho=\rho_0=const\)};
            \node[] at (0.8,4.5) {\(\rho \ll \rho_0\)};
            \node[] at (1,2.6) {\(\vec{u}_h=\left( \begin{array}{c}u\\v\end{array} \right)\)};
            \node[] at (1.3,-1) {\(\rho=\rho_1=const\)};
        \end{tikzpicture}
        \caption{The Reduced Gravity System}
        \label{RG Fig}
    \end{figure}
\end{minipage}

Where \(g'\) is the reduced gravity and is defined as follows:

\begin{fact}{The Reduced Gravity}{RG Box}\label{RG Box}
    We define the reduced gravity \(g'\) as:
    \begin{align}
        \BOX{g'=\frac{\Delta \rho_0}{\rho}g}
    \end{align}
    where \(g=\) is the acceleration due to the gravity; \(\rho\) is the density of the layer; and \(\Delta \rho = \rho_1-\rho_0\), where \(\rho_0\) is the density of the layer under consideration and \(\rho_1\) is the density of the underlying layer.

    The reduced gravity equations are exactly the same as the \hyperref[shallow box]{Shallow Water Equations} but with all instances of \(g\) replaced with a \(g'\).

    It is generally the case that \(g'\ll g\). 
\end{fact}

Importantly, the reduced gravity system affects the \hyperref[SW Def Radius Box]{Rossby Deformation Radius}, now given by the following expression:
\begin{align*}
    L_d = \frac{\sqrt{g' H}}{f}
\end{align*}
Since, generally, \(g'\ll g\), and \(L_d\sim\sqrt{g'}\), \(L_d\) is much smaller than we anticipated before. 

Crucially, though, \(L_d\) now depends on the stratification of the system. Compare two systems, one with a large stratification (i.e., \(\frac{\partial\rho}{\partial z}\) is large) and one with a small stratification (i.e., \(\frac{\partial\rho}{\partial z}\) is small). The former system would be represented by a larger $\Delta \rho_0$, while the latter system would be represented by a smaller $\Delta \rho_0$.

Therefore, a system with a stronger stratification will have a larger \hyperref[SW Def Radius Box]{Rossby Deformation Radius}.

\chapter{Time-Dependent 3D Systems}\label{3D Systems}

In the previous chapter, we considered a time-dependent model of the atmosphere and oceans and analysed time-dependent responses. The key limitation of that system was that that system was \(2\)-dimensional: we only considered a shallow layer at a time. We accounted for this somewhat when we introduced the \hyperref[RG Box]{Reduced Gravity System}, which represented the effects of stratification insofar as \(g\) was replaced by \(g'\). 

Now we aim to represent time-dependent 3D responses of the atmospheres and oceans. We start with gravity waves, although I would prefer to call these 3D Poincaré waves, as I will argue that these are the 3D analogue to the \hyperref[2D Poincare]{2D Inertia Gravity/Poincaré Waves} we considered last chapter. After this, we move onto what will take up the bulk of the chapter: \hyperref[QG]{Quasi-Geostrophic Theory}

\section{Gravity Waves (3D Poincaré Waves)}

\subsection{The Boussinesq Approximation and Linearisation}

Before linearising the system, we first invoke the \textbf{Boussinesq Approximation}. The \textbf{Boussinesq Approximation} is an approximation exploiting the fact that the density field \(\rho\) is very nearly constant\footnote{
    At least in the ocean! For the atmosphere, the Anelastic Approximation is more suitable, and instead exploits the fact that the density field varies strongly only in the vertical (due to the Hydrostatic Relation).
}. We first decompose the density field into three components that obey the following relations:
\begin{align*}
    &\rho(\vec{r},t)=\rho_0 + \hat{\rho}(z) + \rho'(\vec{r},t)
    \\
    &\bar{\rho}(z)=\rho_0 + \hat{\rho}(z)
    \\
    &\rho_0,\bar{\rho} \gg \hat{\rho}(z),\rho'(\vec{r},t)
\end{align*}

If we write out Equations \ref{Vertical Approximate} (Vertical Momentum), \ref{Mass Conservation} (Mass Conservation), and \ref{Horizontal Approximate} (Horizontal Momentum), and expand every instance of \(\rho\) as above, we obtain the following equations:
\begin{align*}
    \frac{D}{Dt}\left( \hat{\rho}(z)+\rho'(\vec{r},t) \right)+(\rho_0+\hat{\rho}(z)+\rho'(\vec{r},t))\vec{\nabla}\cdot\vec{u}=0
    \\
    (\rho_0+\hat{\rho}(z)+\rho'(\vec{r},t))\frac{Dw}{Dt}
    +
    (\rho_0+\hat{\rho}(z)+\rho'(\vec{r},t))g + \frac{\partial p}{\partial z}= 0
    \\
    (\rho_0+\hat{\rho}(z)+\rho'(\vec{r},t))\frac{D\vec{u}_h}{Dt}+(\rho_0+\hat{\rho}(z)+\rho'(\vec{r},t))f\vec{k}\times\vec{u}_h + \vec{\nabla}_h p = 0
\end{align*}

Recalling that \(\rho_0 \gg \hat{\rho}, \rho'\), but also recalling from our scale analysis in Section \ref{Scale Analysis} that \(g\) is large, we neglect \textit{all} variations in \(\rho\) in these equations other than when \(\rho\) is multiplied by \(g\). This gives us the following set of Equations under the Boussinesq Approximation:
% \footnote{
%     If you look in other resources, you might see the Boussinesq Equations feature a buoyancy \(b\) term. I explain how these set of boxed equations link to the more commonly referred to Boussinesq Equations in this endnote.\endnote{
%         Consider now the full momentum equation:
%         \begin{align*}
%             \frac{D\vec{u}_h}{Dt}+f\vec{k}\times\vec{u}_h + \frac{1}{\rho_0}\vec{\nabla} p + \frac{\rho}{\rho_0}g\vec{k}= 0
%         \end{align*}
%         We now decompose the pressure field as follows:
%         \begin{align*}
%             p(\vec{r},t)=p_0(z)+\delta p(\vec{r},t)
%         \end{align*}
        
%     } 
% }
\begin{gather}
    \label{M bous}
    \boxed{
        \vec{\nabla}\cdot\vec{u}=0
    }
    \\
    \label{V bous}
    \boxed{\frac{Dw}{Dt}
    +
    \frac{\rho(\vec{r},t)}{\rho_0}g + \frac{\partial p}{\partial z}= 0}
    \\
    \label{H bous}
    \boxed{
        \frac{D\vec{u}_h}{Dt}+f\vec{k}\times\vec{u}_h + \frac{1}{\rho_0}\vec{\nabla}_h p = 0
    }
\end{gather}
The upshot of these equations is that all variation in density has disappeared except in Equation \ref{V bous} where density variations may couple with gravity. The \ref{M bous} and \ref{H bous} look very similar to a fluid with constant density, although there is a complication regarding Equation \ref{M bous} that I should mention here.\footnote{
    Note that we derived Equation \ref{M bous} from Equation \ref{Mass Conservation}. However, Equation \ref{M bous} does \textit{not} allow us to turn around and (via direct substitution into Equation \ref{Mass Conservation}) imply that \(\frac{D\rho}{Dt} = \frac{D\delta \rho}{Dt} = 0\) (but it also doesn't prohibit it). More discussion is in the Appendix in the section regarding the \hyperref[Appendix Thermodynamic Eqn]{Thermodynamic Equation}.
} Note that we did \textit{not} need to assume that \(\rho'\ll \hat{\rho}\) in deriving Equations \ref{M bous} - \ref{H bous}. However, we will now assume that \(\rho'\ll \hat{\rho}\) when we linearise the equations.

We now, in analogy to how we derived the dispersion relation before, linearise the equations of motion. We linearise about a state of rest \(\vec{u}=0\)\footnote{Note now that \(\vec{u}\) is the 3-dimensional velocity, not just the horizontal velocity.} and a continuous (given) stratification \(\rho=\bar{\rho}(z)\) and pressure field \(p=\bar{p}(z)\).

\vspace{-4mm}
\begin{minipage}{0.48\linewidth}
    \begin{align*}
        \vec{u}_h = \vec{0}+\vec{u}_h'\\
        w = 0 + w'
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{0.48\linewidth}
    \begin{align*}
        p = \bar{p}(z)+p'\\
        \rho = \bar{\rho}(z) + \rho'
    \end{align*}
\end{minipage}

\vspace{2mm} We further assume that the system is approximately hydrostatic, therefore, the following applies:
\begin{align*}
    \frac{d\bar{p}}{dz}=-\bar{\rho}g
\end{align*}

Which equations are we linearising? We linearise Equations \ref{V bous} (Horizontal Momentum), \ref{H bous} (Vertical Momentum), and a version of Equation \ref{Energy Equation} (Energy Equation). We will also use Equation \ref{M bous} (Incompressibility), but this equation is already linear. This will give us, in total, 5 equations.

Skipping over the details of linearisation, we derive the following linearised equations (Equation \ref{M bous} is \ref{Incompressible GW}, and Equation \ref{V bous} becomes \ref{V lin}, \ref{H bous} becomes \ref{H lin}, and \ref{Energy Equation} becomes \ref{MC lin}\footnote{
    The details for this are a bit complicated. I'd honestly recommend ignoring this, but if you're interested I'd refer to either the Appendix on the \hyperref[Appendix Thermodynamic Eqn]{Thermodynamic Equation}, or, for a fuller account, to Vallis' textbook \cite{Vallis}.
 }):

\vspace{-3mm}
\begin{minipage}{0.48\linewidth}
    \begin{align}
        \label{Incompressible GW}
        \boxed{\vec{\nabla}\cdot\vec{u}=0}
        \\
        \label{V lin}
        \boxed{\frac{\partial w'}{\partial t} + \frac{\rho'}{\rho_0} g +\frac{1}{\rho_0}\frac{\partial p'}{\partial z}=0}
    \end{align}
\end{minipage}
\hfill
\begin{minipage}{0.48\linewidth}
    \begin{align}
        \label{H lin}
        \boxed{\frac{\partial \vec{u}_h'}{\partial t}+f\vec{k}\times\vec{u}_h' +\frac{1}{\rho_0}\vec{\nabla}_h p' =0}
        \\
        \label{MC lin}
        \boxed{\frac{\partial \rho'}{\partial t} + w \frac{\partial \bar{\rho}}{\partial z}=0}
    \end{align}
\end{minipage}

\vspace{2mm} We thus have five linear equations governing five variables: \(u\), \(v\), \(w\), \(\rho\), and \(p\) (I'm being lazy and have dropped the primes (the \('\)'s) for brevity). Note that \(\bar{\rho}\) is a given background density field: you do not have to solve for this.

As an aside, note that we can define a spatially/temporally varying analogue of the \hyperref[RG Box]{reduced gravity} (in the shallow water system) \(g'=\frac{\rho'}{\rho_0}g\), which, by stipulation, is much smaller than \(g\).

\subsection{Aside: Buoyancy Oscillations}

Let us first consider a state such that: \(u=v=p=\frac{\partial w}{\partial z}=0\), in which case all equations other than Equations \ref{V lin} and \ref{Incompressible GW} are trivially satisfied. If we differentiate Equation \ref{V lin} with respect to \(t\), we can substitute for \(\frac{\partial \rho}{\partial t}\) using equation \ref{MC lin} to obtain the following equation:
\begin{align}
    \BOX{\frac{\partial^2 w}{\partial t^2}+N^2 w = 0}
\end{align}
where \(N = \sqrt{-\frac{g}{\rho_0}\frac{\partial \bar{\rho}}{\partial z}}=\) the Brunt-Väisälä frequency. If you recall the discussion in section INSERT REFERENCE TO CLOUDS HERE in clouds, we have rederived the buoyancy oscillations as well as the buoyancy frequency!

This solutions describes columns of air (since \(\frac{\partial w}{\partial z}=0\)) oscillating upwards and downwards with a frequency given by \(N\). The restoring force is not simply the gravitational force, but the buoyancy force, which is weaker than gravity due to the buoyancy of the air in the background state.

\subsection{Derivation}

We now derive the dispersion relation for internal gravity waves. Tim derives the dispersion relation slightly different to how I personally prefer to derive it. As before, Tim's method is more general, but my method (in my humble opinion) is a bit easier to remember and churn out in an exam. I won't go through the details because they are straightforward. I encourage the reader to derive the equations themselves. The method is analogous to our derivation of the dispersion relation for \hyperref[2D Poincare]{Poincaré Waves}: we set each variable proportional to an exponential function as follows:

\vspace{-3mm}
\begin{minipage}{0.48\linewidth}
    \begin{align*}
        \vec{u}_h = \vec{u}_0 \exp \left( ikx + ily + imz - i\omega t \right)
        \\
        w = w_0 \exp \left( ikx + ily + imz - i\omega t \right)
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}{0.48\linewidth}
    \begin{align*}
        p = p_0 \exp \left( ikx + ily + imz - i\omega t \right)
        \\
        \rho = \rho_c \exp \left( ikx + ily + imz - i\omega t \right)
    \end{align*}
\end{minipage}

\vspace{2mm} Next, we eliminate four out of the five coefficients (e.g., we eliminate the coefficients \(\vec{u}_0\), \(w_0\), and \(p_0\), leaving everything written in terms of \(\rho_c\), \(k\), \(m\), and \(\omega\)). Next, we claim that \(\rho_c\neq 0\) since we wish to find non-trivial solutions, and thus derive a relation between \(\omega\) to \(k\) and \(m\). It should be the following:
\begin{gather}
    \BOX{\omega^2 = \frac{N^2 \left( k^2 + l^2 \right) + f^2 m^2}{k^2 + l^2 + m^2}}
\end{gather}

We again assume the \hyperref[f plane box]{\(f\)-plane approximation} so that we can take the meridional wavelength \(l\) to be infinite (i.e., set \(l=0\)) without loss of generality. This gives us the following dispersion relation:
\begin{align}
    \BOX{\omega^2 = \frac{N^2  k^2   + f^2 m^2}{k^2 + m^2}}
\end{align}

Let us first consdier a few limits.

If \(N = 0\) (i.e., the density does not decrease or increase with height) or \(k=0\) (i.e., the meridional wavelength is infinite), then the following equation reduces to inertial oscillations with the following dispersion relation:
\begin{align*}
    \omega^2 = \frac{f^2 m^2}{k^2 + m^2} = f^2 \sin^2 \theta
\end{align*}
where \(\theta = \tan^{-1}\frac{m}{k}\), the angle the wave-vector makes to the horizontal.\footnote{\(\theta = 0\) corresponds to a horizontal wavevector, while \(\theta = \frac{\pi}{2}\) corresponds to a vertically upwards wavevector.} In other words, the wave does not `feel' the effect of gravity.

This is for two different physical reasons. If \(N\sim\frac{\partial \rho}{\partial z}=0\), buoyancy exactly cancels out the effect of gravity. Convsersely, if \(k=0 (=l)\), the wavefronts (recall Figure \ref{Wavefronts Fig}) form planes of constant \(z\). Using equation \ref{Incompressible GW}, we find that if \(k=l=0\) then \(\vec{\nabla}\cdot\vec{u}\sim w = 0\). Therefore fluid parcels never move vertically, and thus never change their gravitaitonal potential energy.

Conversely, if \(f=0\) or \(m=0\), the equation reduces to a pure gravity wave with the following disperison relation:
\begin{align*}
    \omega^2 = \frac{N^2 k^2}{k^2 + m^2} = N^2\cos^2 \theta 
\end{align*}
In other words, the wave does not `feel' the effect of rotation.

Again, this is for two different physical reasons. If \(f=0\), the planet is not rotating, and so there is no rotation for the wave to feel. If \(m=0\), using the same logic regarding Equation \ref{Incompressible GW}, the fluid parcels only move vertically and never horizontally. As such, the coriolis \(f\vec{k}\times\vec{u}_h=0\) always.

\subsection{Hydrostatic Short-Wave Gravity Waves}

We focus further now on a special case. Let us first take the hydrostatic limit. Note that this is a \textit{further} assumption we must make. While we have already assumed that the background state is hydrostatic, we have \textit{not} assumed that the \textit{perturbations} are hydrostatic yet. 

If we assume that the \textit{perturbations} are hydrostatic as well, this implies that the \(\frac{\partial w'}{\partial t}=0\) in Equation \ref{V lin}. If one follows through the derivation (I have not yet done this, but I trust the lecture slides), this supposedly makes the \(k^2\) term in the demoninator vanish, so that the dispersion relation is as follows:
\begin{align*}
    \omega^2=\left( \frac{N}{m} \right)^2 k^2 + f^2
\end{align*}
We can now make a direct comparison between this dispersion relation and the analogous dispersion relation for \hyperref[IG SW Box]{Shallow Water Inertia-Gravity Waves}. We can now identify the \(\frac{N}{m}\) term as analogous to the \(c=\sqrt{gH}\) term. We see now then that the speed of gravity waves is set by the background stratification (which is encoded, now, by the buoyancy frequency \(N\) but was encoded by the layer thickness \(H\) in the \hyperref[Shallow Water System]{Shallow Water System}) and now the vertical wavenumber \(m\).

This is to be expected: now that we have moved to a fully three-dimensional system, we should expect that structure in the vertical dimension plays some role in how waves propagate.

We next consider the short-wave limit, such that \(f\ll \frac{Nk}{m}\). This gives us the following dispersion relation:
\begin{align*}
    \BOX{\omega = \pm \frac{Nk}{m}}
\end{align*}

\subsubsection{Phase and Group Velocities}

Let us now calculate the phase and group velocities. The phase velocities and group velocities are (in the \(x\)-\(z\) plane):
\begin{align*}
    \vec{c}_p = \left( \begin{array}{c}
        [\vec{c}_p]_x
        \\
        [6pt]
        [\vec{c}_p]_z
    \end{array} \right)
    =
    \pm \frac{N}{m^2}\left( \begin{array}{c}
        m
        \\
        [6pt]
        k
    \end{array} \right)
    \\
    \vec{c}_g = \left( \begin{array}{c}
        [\vec{c}_g]_x
        \\
        [6pt]
        [\vec{c}_g]_z
    \end{array} \right)
    =
    \pm \frac{N}{m^2}\left( \begin{array}{c}
        m
        \\
        [6pt]
        -k
    \end{array} \right)
\end{align*}



\subsection{Vertical Modes}

\section{Quasi-Geostrophic Theory}\label{QG}

Our goal now is to explain Quasi-Geostrophic Theory. So far, we have a few models of the atmosphere and oceans. We have the \hyperref[Eqns for GFD Box]{`primitive' equations of motion} and the \hyperref[Shallow Water System]{shallow water equations}. 

The former set of equations are much too complicated to solve exactly, so we must make numerous approximations (e.g., we assumed \(Ro\ll 1\) or the hydrostatic relation). Furthermore, the system is relatively complicated, which reduces the level to which we can understand solutions or behaviour. Conversely, the second set of equations is much simpler and more interpretable, but it has the limitation of being \(2D\) only.

Our goal now is to formulate a theory that strikes a balance between the accuracy of the first set of the equations and the simplicity of the second set of equations.

Our general strategy is to start from the \hyperref[Eqns for GFD Box]{`primitive' equations of motion} and let \(Ro\ll 1\), but instead of keeping only \(\mathcal{O}(Ro^0)\), we keep \(\mathcal{O}(Ro)\)

\subsection{Derivation}

\subsubsection{Assumptions}

We first assume that \(Ro<1\), i.e., \(Ro\) is small but not extremely small. Second, we assume density variations are small so we can use the Boussinesq approximation. Third, we assume that the background pressure and density fields are hydrostatic. Fourth, we use the \hyperref[beta plane box]{\(\beta\)-plane approximation}. (Fifth) We further assume that \(\frac{\beta y}{f_0}\sim \mathcal{O}(Ro)\).

Our strategy is to now decompose each field into a geostrophic and ageostrophic component:
\begin{align*}
    \vec{u} = \vec{u}_g + \vec{u}_{ag}
    \\
    p = \bar{p}(z) p_g + p_{ag}
    \\
    \rho = \bar{\rho}(z) \rho_g + \rho_{ag}
\end{align*}
such that
\begin{align*}
    \frac{\partial \bar{p}}{\partial z} = -\bar{\rho}g
\end{align*}

We further assume that the ratio of the magnitude of the ageostrophic comoponents to the geostrophic components are of order \(Ro\). For example:
\begin{align*}
    \frac{\left|\vec{u}_{ag}\right|}{\left|\vec{u}_g\right|}\sim O (Ro)
\end{align*}

We aim to derive a simplified set of equations from Equations \ref{Horizontal Approximate}, \ref{Vertical Approximate}, \ref{Incompressibility}, and 

\begin{fact}{The Quasi-Geostrophic Equations}{QG Box}\label{QG Box}
    The Quasi-Geostrophic Equations, which govern a Boussinesq, hydrostatic fluid on the \(\beta\)-plane, evolves according to the Quasi-Geostrophic Potential Vorticity Equation if \(Ro^2\ll Ro \ll 1\).
    \begin{gather}
        \label{QGPV Cons}
        \BOX{
            \frac{D_g q}{Dt} = 0
        }
    \end{gather}
    where \(\frac{D_g}{Dt}=\) the geostrophic material derivative, \(q=\) the quasi-geostrophic potential vorticity, \(\psi=\) the streamfunction, \(\vec{u}_g=\) the horizontal geostrophic velocity, \(p_g=\) the geostrophic pressure field, \(\rho_g=\) the geostrophic density field, and \(w_{ag}=\) the ageostrophic vertical velocity. These obey the following relations:

    \begin{minipage}{0.42\linewidth}
        \begin{gather}
            \label{Geostrophic MD}
            \BOX{
                \frac{D_g}{Dt}=\frac{\partial }{\partial t}+ \vec{u}_g\cdot\vec{\nabla}
            }
            \\
            \label{Streamfct}
            \boxed{\vec{u}_g = \vec{k}\times\vec{\nabla}_h\psi}
            \\
            \label{wag}
            \boxed{w_{ag}=-\frac{D_g}{Dt}\left( \frac{f_0}{N^2} \frac{\partial \psi}{\partial z}\right)}
        \end{gather}
    \end{minipage}
    \hfill
    \begin{minipage}{0.56\linewidth}
        \begin{gather}
            \label{QGPV}
            \BOX{
                q=f_0+\beta y + \vec{\nabla}_h^2 \psi + \frac{\partial }{\partial z}\left( \frac{f_0^2}{N^2} \frac{\partial \psi}{\partial z} \right)
            }
            \\
            \label{p QGPV}
            \boxed{p_g = \rho_0 f \psi}
            \\
            \label{rho QGPV}
            \boxed{\rho_g = \frac{\rho_0 f_0}{g}\frac{\partial \psi}{\partial z}}
        \end{gather}
    \end{minipage}

\end{fact}

\subsection{Interpretation}

Before interpreting all the equations, it's first important to note the \textit{practical} achievement of these equations. We have drastically reduced the amount of variables we need to solve for by writing all the fields of interest (\(u_g\), \(v_g\), \(w_{ag}\), \(p_g\), and \(\rho_g\)) in terms of a single scalar field which is the streamfunction \(\psi(\vec{r},t)\). Furthermore, this streamfunction has a fully three-dimensional dependence, constituting our simple but fully 3D model of the atmosphere/ocean. 

Interpretation of Equation \ref{QGPV Cons} is straightforward and analogous to our interpretation of \hyperref[Cons PV Box]{Conservation of Potential Vorticity} for the \hyperref[Shallow Water System]{Shallow Water System}. I should note, though, that we should think of this equation as a linearised version, as we use the geostrophic material derivative, rather than the material derivative. Recall that we assume that the flow is to leading order geostrophic, so assuming that the advection is accurately characterised by just the geostrophic velocities is not a bad assumption.

Interpretation of \ref{QGPV} is also relatively straightforward. \(q\) is our quasi-geostrophic potential vorticity, an approximation of the potential vorticity. The terms are as follows:
\begin{align*}
    q = \underbrace{f_0 + \beta y}_{f=\text{Planetary Vorticity}}
    +
    \overbrace{\vec{\nabla}_h^2 \psi}^{\xi=\text{Relative Vorticity}}
    +\underbrace{\frac{\partial }{\partial z}\left( \frac{f_0^2}{N^2} \frac{\partial \psi}{\partial z} \right)}_\text{Vortex Stretching/Squishing}
\end{align*}
The first two terms are identified straightforwardly. \(f_0+\beta y\) is manifestly a first approximation of the planetary vorticty, and \(\vec{\nabla}_h^2\psi\) is equal to the relative vorticity if one considers Equation \ref{Streamfct}. 

The third term is a bit less straightforward. First consider the form of \hyperref[Cons PV Box]{Conservation of Potential Vorticity} for the \hyperref[Shallow Water System]{Shallow Water System} and expand Equation \ref{SW Cons PV} as follows (after multiplying by \(h\)):
\begin{align*}
    0&=h\frac{D}{Dt}\left( \frac{f+\xi}{h} \right)
    \\
    &=
    \frac{D}{Dt}(f+\xi) + \boxed{-\frac{f+\xi}{h}\frac{D}{Dt}(h)}
\end{align*}
Writing in it this form separates the two components of potential vorticity. The first term expresses the change in the vorticity of a fluid parcel, while the second boxed term expresses the change in the thickness of the column. In, other words, the second term captures the vortex stretching/squishing effect of conservation of potential vorticity.

If we expand Equation \ref{QGPV Cons} analogously we get the following:
\begin{align*}
    0 &= \frac{D_g}{Dt}\left( f+\xi +  \frac{\partial }{\partial z}\left( \frac{f_0^2}{N^2} \frac{\partial \psi}{\partial z} \right)\right)
    \\
    &=\frac{D_g}{Dt}(f+\xi) + \boxed{f_0 \frac{D_g}{Dt}\left( \frac{\partial }{\partial z}\left( \frac{f_0}{N^2} \frac{\partial \psi}{\partial z} \right)\right)}
\end{align*}

We identify the boxed terms as analogous to each other: they both correspond to vortex stretching/squishing. Making this analogy allows us to interpret each component the third term more readily:
\begin{align*}
    (f+\xi)\frac{1}{h}\frac{D}{Dt}(h) & \longleftrightarrow
    f_0\frac{1}{\partial z}\left( -\frac{D_g}{Dt}\left( \frac{f_0}{N^2} \frac{\partial \psi}{\partial z}\right) \right)
    \\
    f+\xi & \longleftrightarrow f_0
    \\
    \frac{1}{h} & \longleftrightarrow \frac{\partial}{\partial z}
    \\
    \frac{D}{Dt}(h) & \longleftrightarrow -\frac{D_g}{Dt}\left( \frac{f_0}{N^2} \frac{\partial \psi}{\partial z}\right)=w_{ag}
\end{align*}

Much of this can be argued from dimensional grounds, and, of course, they must match up dimensionally. The \(f_0\) corresponds to the \(f+\xi\) term, and is a good first order approximation because we assumed that \(Ro\) was small, and therefore that \(\frac{\xi}{f}\) was small. The \(\frac{1}{h}\) corresponds to the \(\frac{\partial}{\partial z}\) [UNDER CONSTRUCTION IDK WHY LOL]

Finally, the The \(\frac{D}{Dt}(h)\) corresponds to the \(w_{ag}\). Recall that the interface height in the shallow water system is [ALSO UNDER CONSTRUCTION]

Equations \ref{p QGPV} and \ref{rho QGPV} have a straightforward interpretation as well. The former is simply the constraint imposed by geostrophy, and the latter is the constraint imposed by hydrostasy.


\section{Quasi-Geostrophic Rossby Waves}

\subsection{Derivation}

As before with the \hyperref[Shallow Water System]{Shallow Water System} we linearise the \hyperref[QGPV]{Quasi-Geostrophic Potential Vorticity Equation} about a background state. However, this time we assume that the background state is a constant zonal flow, i.e., we linearise about the state \(\vec{u}_g=(0,U,0)\) with a constant background stratificaiton (\(N=const\)). In other words, we linearise about a streamfunction \(\Psi\) such that:
\begin{align*}
    \psi = \Psi + \psi'
    \\
    \psi' \ll \Psi
    \\
    \Psi = -Uy
\end{align*}
Specifying 

We also use the \hyperref[beta plane box]{\(\beta\)-plane approximation}.

linearisation\dots

\begin{align*}
    \left( \frac{\partial }{\partial t}+U\frac{\partial }{\partial x} \right)
    \left( 
        \vec{\nabla}_h^2 \psi' 
        +\frac{f_0^2}{N^2}\frac{\partial \psi'}{\partial z}
     \right)
    +
    \beta \frac{\partial \psi' }{\partial x}
    =
    0
\end{align*}

\begin{fact}{Quasi-Geostrophic Rossby Waves}{QG Rossby box}\label{QG Rossby box}

    \begin{gather}
        \BOX{
            \omega = Uk - \frac{\beta k}{k^2 + l^2 +\frac{f_0^2 m^2}{N^2}}
        }
    \end{gather}
\end{fact}

\subsection{Interpretation}



\section{Instabilities and Turbulence}

\chapter{Ocean Circulation}\label{Oceans}

Throughout GFD, we have formulated models that apply to both the oceans and the atmosphere, but mostly with a focus on the atmosphere. Geostrophic and hydrostatic balance are accurate diagnostic relations in the ocean, our analysis using the shallow water system of waves is applicable to the oceans, aas is our discussion on instability and turbulence.

Now we pay explicit attention to just the oceans, but, as before, concepts here may be applicable to the atmosphere. As already touched upon, the oceans, while similar to the atmosphere in the sense that it is a fluid on a planet and so is affected by gravity (and so stratification) and rotation (and so coriolis), differs from the atmosphere dynamically in a few key ways.

First, the oceans are externally forced differently to the atmosphere. Recall our discussion in Section \ref{Differential Heating} that differential heating from the sun drives motion in the atmosphere: the atmosphere and oceans must transport energy poleward to close the energy budget. While the oceans accomplish this as well, the oceans are also, crucially, forced externally via atmospheric winds.

Second, unlike the atmosphere, the ocean has walls. This leads to effects in which we must consider. We considered this while discussing coastal \ref{Kelvin} waves, for example, but we will consider this further when we incorporate effects like friction.

Third, the equation of state and typical sea-water conditions means that variations in density within the ocean are very small, and seawater is much denser than the atmosphere. This implies that, if we were to model the ocean using a reduced gravity model, \(g'\) would be much smaller, and therefore \(L_d\) is also shorter. If we were to model the ocean using a continuous stratification, \(N\) would be smaller, which, again, implies that \(L_d\) is shorter in the ocean.

Finally, \(Ro\) is much smaller in the ocean than in the atmosphere. \(f\) is comparable in both the atmospheres and oceans. Meanwhile, both \(L\) and \(U\) are smaller in the ocean. We can understand this somewhat as follows, but I emphasise that what I am about to say is by no means a \textit{sufficient} explanation\footnote{And to be honest I don't know a dynamically sound argument why \(Ro\) is smaller in the oceans. I think, however, an argument might go like this. First, note the energy recieved by the oceans and the atmospheres in \qty{}{\watt\per\square\meter}}. We expect \(L\) to be set by \(L_d\), which recall depends on the stratification. Since \(N\) is smaller in the ocean, \(L\) is smaller in the ocean. Meanwhile, we expect \(U\) to be set by the energy and momentum budgets. While the atmosphere is directly forced by differential heating and latent heat releases, we expect (?) this energy source to be larger than the wind-stress the atmosphere exerts on the oceans, so we expect \(U\) to be larger in the atmosphere. I have only explained why both \(L\) and \(U\) are smaller in the ocean than in the atmospheres, but note crucially that I have not explained why \(U\) is smaller by a larger amount than \(L\), and \textit{this} is what is required to explain why \(Ro\) is smaller in the ocean than in the atmosphere.

We'll be exploring some effects of external forcing \ref{Ekman Transport} and the small rossby number \ref{Sverdrup Balance}.

\section{Ekman Transport (Shallow Ocean Circulation)}\label{Ekman Transport}

We begin by considering the effect of external forcing due to friction. For the ocean, this will be due to the atmosphere blowing over the ocean, which exerts a shear stress on the surface of the ocean, forcing the ocean to move in the same direction as the air. A \textbf{stress} is a force per unit area across a boundary. In this case, this is the boundary between the atmosphere adn the ocean. A \textbf{shear} stress is 

Actually, phenomena we discuss here is applicable to the atmosphere as well: the ground exerts a shear stress on the atmosphere in the opposite direction that the atmosphere is flowing in!

Ekman transport is the transport due to the circulation of 

Assume \(Ro\ll1\) so we can neglect the acceleration/advection term in Equation \ref{Horizontal Approximate} and that \(\rho=\rho_0=const\):
\begin{align*}
    f\vec{k}\times\vec{u}_h+\frac{1}{\rho_0}\vec{\nabla}_h p = \vec{F}_b
\end{align*}

We now no longer neglect other forces, and reintroduce the horizontal stress force. We assume that the horizontal stresses vary the most vertically, which means that we can write \(F_b\) to a good approximation as follows:
\begin{gather*}
    \vec{F_b} = \frac{1}{\rho_0}\frac{\partial \vec{\tau}}{\partial z}\\
    \vec{\tau}=\underbrace{\rho_0\nu\frac{\partial \vec{u}_h}{\partial z}}_{\text{viscous stress}}-
    \underbrace{\rho_0 \overline{\vec{u}_h'w'}}_{\text{turbulent eddy stress}}
\end{gather*}
where \(\vec{\tau}\) is the horizontal stress vector\endnote{
    If you are familiar with fluid mechanics, you will notice that, in reality, the stress is usually written as rank two symmetric tensor \(\tau_{ij}\), where the force is given by \(F_i = \sum_j \frac{\partial \tau_{ij}}{x_j}\).

    However, in this case, we assume that \(\frac{\partial \tau_{iz}}{z}\gg\frac{\partial \tau_{iy}}{y},\frac{\partial \tau_{ix}}{x}\), i.e., that the vertical variation in \(\tau_{ij}\) is much larger than the horizontal variation.

    We then define the horizontal stress vector \(\vec{\tau}\) as follows:
    \begin{align*}
        [\vec{\tau}]_i = \tau_{iz}
    \end{align*}
}. The second term is a bit more complicated, but just think of it as the effect of turbulent momentum fluxes which produce an effective force on the fluid (and read this\footnote{
    The explanation of the \(\rho_0 \overline{\vec{u}_h'w'}\) is as follows. First we perform a \href{https://en.wikipedia.org/wiki/Reynolds_decomposition}{Reynolds Decomposition} by splitting the velocity into a (time, space, or other suitably defined) average indicated by a bar and a fluctuation indicated by a prime:
    \begin{align*}
        \vec{u}_h = \overline{\vec{u}}_h+\vec{u}_h'
        \\
        w = \overline{w}+w'
    \end{align*}
    where the fluctuations average out to \(0\) (e.g., \(\overline{w'}=0\)).

    While the fluctuations by themselves might average out to \(0\), there might be correlations between fluctuations that do not average out to \(0\). The turbulent momentum flux is the average correlation between the horizontal velocity and the vertical velocity: if there are correlations, then this will result in momentum being advected downwards or upwards. 
    
    For example, if \(\vec{u}_h'\) is more likely to be pointing eastward when \(w'<0\), then this will result in eastward momentum preferentially being advected downwards by vertical velocity fluctuations, which causes an effective momentum flux/stress.
} footnote if you want more). Ekman transport is therefore a three-way balance between coriolis, pressure gradient forces, and horizontal stress from friction.

We define the \textbf{Ekman Layer} as lying between \(z=0\), where the surface of the ocean is, and \(z=-H\), where \(z=-H(x,y,t)\) when \(\vec{\tau}=\vec{0}\). This specifies where \(z=-H(x,y,t)\), but note that we do not necessarily need to solve for \(H(x,y,t)\). Note also that \(H(x,y,t)\) may vary in time and space.

\subsection{Ekman Spiral}



\subsection{Ekman Flux}

We had to make the highly dubious approximation of the turbulent eddy stress term by a single (constant) turbulent eddy viscosity, we do not have to make the same assumption here. We again decompose the velocity \(\vec{u}_h\) into a geostrophic component and an ekman (ageostrophic) component:
\begin{align*}
    \vec{u}_h = \vec{u}_g + \vec{u}_{Ek}
\end{align*}
where, again, \(\vec{u}_g\) is defined as in Equation \ref{Geostrophic Balance}.

This implies that \(\vec{u}_{Ek}\) is given by the following expression:
\begin{align*}
    \vec{u}_{Ek} = - \frac{1}{\rho_0 f}\vec{k}\times\frac{\partial \vec{\tau}}{\partial z}
\end{align*}

We now integrate this expression from \(z=-H\) to \(z=0\), and note that we can remain completely ignorant of the precise expression for \(\vec{\tau}\) and make use simply of our boundary conditions. We define \(\vec{U}_{Ek}\) as follows:
\begin{align*}
    \vec{U}_{Ek}&\equiv
    \int_{z=-H}^{z=0}\vec{u}_{Ek}\, dz
    \\
    &=
    -\frac{1}{\rho_0 f}\vec{k}\times\int_{z=-H}^{z=0}\frac{\partial \vec{\tau}}{\partial z}\, dz
    \\
    &=
    -\frac{1}{\rho_0 f}\vec{k}\times\int_{\vec{\tau}=\vec{0}}^{\vec{\tau}=\vec{\tau}_s}\,d\vec{\tau}
\end{align*}
\begin{gather}
    \therefore\BOX{
        \vec{U}_{Ek}=-\frac{1}{\rho_0 f}\vec{k}\times\vec{\tau}_s
    }
\end{gather}

We therefore have an expression for the Ekman Flux \(\vec{U}_{Ek}\): the column integrated fluid flux from wind-forcing. Note a key nuance that this flux is not a volume flux: the dimensions are not a volume per second, but an area per second. To find the volume flux, we would also need to integrate this expression horizontally perpendicular to \(\vec{U}_{Ek}\). (E.g., if \(\vec{U}_{Ek}\) is pointing northward, we would need to integrate this zonally (i.e., from west to east) to find the volume flux.)

Physically, we have a very similar situation to \hyperref[Geostrophic Box]{Geostrophic Balance}, for \(\vec{U}_{Ek}\), we have a total balance between the horizontal stress \(\vec{\tau}\) and the coriolis force. To make this more clear, we can write an expression for \(\vec{U}_{Ek}\) another way:
\begin{align*}
    f\vec{k}\times \vec{U}_{Ek} = \frac{1}{\rho_0}\vec{\tau}_s
\end{align*}
which looks very analogous to Equation \ref{Geo Bal}, which expresses geostrophic balance.

Note that, in the northern hemisphere, \(\vec{U}_{Ek}\) points to the right of \(\vec{\tau}_s\), and vice versal in the southern hemisphere.

We have so far considered the horizontal Ekman flux, but we now wish to consider the vertical Ekman flux. We again decompose the vertical velocity \(w\) into a geostrophic component\footnote{Recall that \(w_g=0\) only if \(\rho\) and \(f\) do not vary, and while \(\rho=\rho_0=const\), we do not wish to make the \(f\)-plane approximation here!} and an Ekman (ageostrophic) component. 

We wish to find the Ekman vertical velocity at \(z=-H\) which we write as \(w_{Ek}\). To find \(w_{Ek}\), we apply Equation \ref{Incompressibility}, and integrate this equation again from \(z=-H\) to \(z=0\), where we assume that \(w=0\) at \(z=0\)\footnote{It suffices just to assume that \(w(z=0)\ll w(z=-H)\), which makes sense when we recall that \(w=0\) is set by the fluid interface, and the air-sea interface moves much slower than the the interface within th ocean (recall our derivation of the \hyperref[RG Box]{Reduced Gravity System})}.

We define \(w_{Ek}\) as follows:
\begin{align*}
    w_{Ek}&\equiv
    w(z=-H)
    \\
    &= w(z=-H)-w(z=0)
    \\
    &=\int_{z=-H}^{z=0}\frac{\partial w}{\partial z}\,dz
    \\
    &=\int_{z=-H}^{z=0}\vec{\nabla}\cdot\vec{u} - \vec{\nabla}_h \cdot \vec{u}_{Ek}\,dz
    \\
    &=\vec{\nabla}_h \cdot\int_{z=-H}^{z=0}\vec{u}_{Ek}\,dz
    \\
    &=\vec{\nabla}_h \cdot \vec{U}_{Ek}
\end{align*}
\begin{gather}
    \therefore \BOX{
        w_{Ek}=\vec{k}\cdot \vec{\nabla} \times \left( \frac{1}{\rho_0 f}\vec{\tau}_s \right) = \left[
            \vec{\nabla} \times \left( \frac{1}{\rho_0 f}\vec{\tau}_s \right)
        \right]_z
    }
\end{gather}

In other words, the ekman upwelling is equal to the (\(z\)-component of the) vorticity of the \(\frac{1}{\rho_0 f}\vec{\tau}_s\). This could come from \(f\), or it could come from the surface wind-stress field \(\vec{\tau}_s\).

Suppose we have a surface wind-stress field \(\vec{\tau}_s(x,y)\) given by \(-\hat{y}\tau_0\,\cos\frac{y}{L_y}\). 

[FIGURE UNDER CONSTRUCTION]

\section{Sverdrup Balance (Deep Ocean Circulation)}\label{Sverdrup Balance}

\subsection{Conservation of Potential Vorticity}

We now turn our focus to below the Ekman layer, i.e., to \(z<-H\). We crucially assume that the flow is geostrophic below the Ekman layer (owing to the small \(Ro\) in the ocean). However, we do \textit{not} make the \(f\)-plane approximation, and instead allow the coriolis parameter to vary according to the \hyperref[beta plane box]{\(\beta\)-plane approimation}. 

This implies (exercise) that geostrophic flow is no longer incompressible in the horizontal direction, and so to maintain incompressibility overall, there must be upwelling or downwelling. This, upwelling or downwelling will end up being set by the ekman upwelling or downwelling, which is why surface wind-stress can have an effect deep in the ocean. We also assume that the density \(\rho\approx\rho_0\) is constant.

We first consider Equation \ref{Incompressibility}, and allow the horizontal velocities \(u\) and \(v\) to be geostrophic (i.e., set by Equation \ref{Geo Bal}):
\begin{align*}
    0 & = \vec{\nabla}\cdot\vec{u}
    \\
    &= \vec{\nabla}_h\cdot\vec{u}_h
    +\frac{\partial w}{\partial z}
    \\
    &= 
    \frac{1}{\rho_0}\vec{\nabla}_h\cdot\left( \frac{1}{f(y)}\vec{k}\times\vec{\nabla}_h p \right)+\frac{\partial w}{\partial z}
    \\
    &=
    \frac{1}{\rho_0}
    \vec{\nabla}_h\left( \frac{1}{f} \right)
    \cdot \left( \vec{k}\times\vec{\nabla}_h p \right)
    +
    \frac{1}{\rho_0 f}
    \vec{\nabla}_h
    \cdot \vec{k}\times\vec{\nabla}_h p
    +\frac{\partial w}{\partial z}
    \\
    0&=-\frac{\beta}{f}v+\frac{\partial w}{\partial z}
\end{align*}

Integrating this now from \(z=-D\) (the depth of the ocean) to \(z=-H\) and assuming the \(w(z=-D)=0\), we find an equation for the depth-integrated meridional velocity:
\begin{align*}
    \int_{-D}^{-H}\beta v\,dz = \int_{-D}^{-H}\frac{\partial w}{\partial z}\,dz
    \\
    \beta V = f\left( w(z=-H)-w(z=-D) \right)
\end{align*}
where \(V=\int_{-D}^{-H} v\,dz\) is the vertically integrated meridional velocity.

We now assume that the vertically velocity at \(z=-H\) is set by Ekman upwelling so that \(w(z=-H)=w_{Ek}\) obtains, and that the ocean has a flat bottom (or at least a roughly such that \(w(z=-D)\ll w(z=-H)\)) so that \(w(z=-D)\approx 0\). As such, the vertically integrated meriodional velocity depends on the vertical upwelling or downwelling:
\begin{equation}
    \label{eq Sverdrup Balance}
    \begin{aligned}
        \beta V &= f w_{Ek}
        \\
        &=\left[
            \vec{\nabla} \times \left( \frac{1}{\rho_0 f}\vec{\tau}_s \right)
        \right]_z
    \end{aligned}
\end{equation}

We can think of Equation \ref{eq Sverdrup Balance} bas expressing \hyperref[Cons PV Box]{material conservation of potential vorticity} of deep seawater. If \(w_{Ek}>0\), this corresponds to a column being stretched. As such, the absolute vorticity of the fluid parcel must increase, but because \(Ro\ll 1\), the planetary voriticity is much larger than the relative vorticity (\(f\gg \xi\)). As such, the only way the parcel can effectively increase vorticity is by flowing northward and increasing its planetary vorticity. Therefore, if \(w_{Ek}>0\), so too must \(V\).

[FIGURE UNDER CONSTRUCTION]

\subsection{Western Boundary Currents: The Effects of Friction}

While we expect the deep flow to be geostrophic in the ocean basin, this cannot apply everywhere, especially near continental boundaries.

\subsubsection{Deep Western Boundary Currents}

[UNDER CONSTRUCTION]

We now know that the ocean varies on much smaller lengthscales than originally anticipated, i.e., that there is a very active and fine-grained eddy field which can transport floats on these timescales. In hindsight, then, it was just as likely for the buoy to float southward! It's interesting to think, historically, what might have happened in the field of oceanography if the buoy had drifted southward.\endnote{
    Warning: this footnote is EXTREMELY tangential, but I include it because I want an excuse to write about interesting philosophy of science regarding `falsification'.

    `Falsification' is often defined as a property a theory has if (and only if) there exist a set of observations that would rule the theory out. The essence of good scientific practice is then not only constructing falsifiable theories but also humbly abandoning a (possibly beautiful) theory if that theory is falsified. After all, evidence is the ultimate decider in science.
    
    A common objection to this (and one I agree with) is that this criterion is too simplistic to vindicate what we think of as good scientific practice. The core of the objection is the idea of \href{https://en.wikipedia.org/wiki/Confirmation_holism}{confirmation holism}. Theories can never make predictions on their own, but must be supplanted with auxilliary hypotheses. For example, such auxilliary hypotheses could be the boundary conditions of the governing equations (like the details of the orography) or even the claim that observational instruments are working as intended.

    In this case, the `theory' (that there is a deep northward flowing boundary current) generated the `prediction' that a neutrally buoyant float should drift northward, but this prediction was only generated with the auxilliary hypothesis that the eddy transport would be negiligible!

    This auxilliary hypothesis turned out to be wrong, but the observations confirmed the theory by luck! If, instead, we hadn't been so lucky and the float flowed southward, would it have been irrational or `unscientific' to not immediately abandon the theory that there should be a deep western boundary current?

    The takeaway (I claim) is that, sometimes, formulating ad hoc hypotheses (in this case, that there is \textit{yet another} unaccounted-for eddy velocity field) is sometimes scientific, but it's difficult to know without the benefit of hindsight. 
    
    This is seen in other parts of physics as well. Consider the failure of Newtonian gravity to predict Uranus' orbit (which led to the theorised existence of another planet (\href{https://en.wikipedia.org/wiki/Neptune}{Neptune})), the initial experiments (conducted by \href{https://en.wikipedia.org/wiki/Walter_Kaufmann_(physicist)}{Walter Kaufmann}) which appeared to falsify Einstein's (and Lorentz's) special relativity, or even the more recent \href{https://en.wikipedia.org/wiki/2011_OPERA_faster-than-light_neutrino_anomaly}{faster-than-light neutrino detection} (explained by an incorrectly screwed in fibre optic cable!). 

    In the first and third case, many scientists were unwilling (maybe to the extent of dogmatism) to give up the established theories of newtonian gravity or special relativity.
    
    The second case is more interesting, given that special relativity at the time had not been thoroughly experimentally confirmed yet. In fact, Einstein himself knew of Kaufmann's experiments, but, unlike Lorentz, continued to advocate for his theories, and argued that more experiments were needed. Going even further, he argued that, prior to the completion of such experiments, other theories regarding the electron `should be ascribed a rather small probability because their basic assumptions about the mass of moving electrons are not made plausible by theoretical systems that encompass a wider complex of phenomena.' \cite{Histories_of_Relativity}. I am here arguing that this `unscientific' (by the falsification criterion) decision was indeed vindicated later on, and emphasising the strong role that theoretical (rather than purely empirical) factors can play. 

    There are, of course, other objections to this form of falsificationism, but these are atmospheric/oceanic physics notes.
}

\section{The Meridional Overturning Circulation}\label{MOC}

In this section we aim to construct a simple box model of the \textbf{Atlantic Meridional Overturning Circulation} (AMOC). The AMOC is a complex overturning circulation, consisting of warm waters which flow from the Southern Ocean northward, before turning cold and salty, sinking in the North Atlantic, and flowing southward to complete the loop.



This is a somewhat oversimplified version of the \textbf{MOC}, but I sadly don't have the time nor energy to get into it at this point.

Crucially, though, the water must sink in the North Atlantic, and this (we think) requires the water to be denser or at least as dense as the water below it. We must therefore consider the \textbf{equation of state} that governs the density of sea water.

\subsection{The Equation of State of Seawater}

The equation of state for seawater, unlike the simple \hyperref[b Ideal Gas]{ideal gas law} for air, is horribly complicated, and there is (to the best of my knowledge) no theoretical way to derive it. Instead, we use an empirically found Gibbs function of seawater \(G\) to calculate the equation of state. Recalling that \(dG = -S\,dT + \rho\,dp+\dots\), you can see that \(\rho=\partial G/\partial p\).

This, still, is too complicated for our purposes, so we simply linearise the equation of state and assume that water is incompressible so that \(\frac{\partial \rho}{\partial p}=0\).\footnote{Water is actually compressible\dots but oh whale.}
\begin{gather}
    \rho=\rho_0(1-\alpha (T-T_0)+\beta(S-S_0))
\end{gather}
where \(\rho_0 = \rho(T=T_0,S=S_0)\), \(\alpha = \frac{\partial \rho}{\partial T}|_{T=T_0}\), and \(\beta = \frac{\partial \rho}{\partial S}|_{S=S_0}\) and both \(\alpha,\beta>0\).

I should really emphasise that, for almost all purposes, this equation of state is not empirically adequate to explain the behaviour of global ocean circulation. (see this paper \cite{N15}). However, we will use it for now for simplicity. Crucially, we expect a \textit{lower} salinity to \textit{decrease} the density of seawater, but a \textit{lower} temperature to \textit{increase} the density of seawater.

\subsection{The Stommel Box Model}

Now we construct a simple box model of the AMOC (See Figure \ref{fig Stommel}): a model where we partition the ocean into large boxes. These large boxes have uniform properties, the fluxes (of water, in this case) between the boxes if parameterised by certain expressions.

We let one box represent the waters in the low-latitudes (\textcolor{myorange}{\textbf{Box 1}}), and let the other box represent the waters in the sub-polar north atlantic (\textcolor{myorange}{\textbf{Box 2}}). We set the temperature and salinity of these boxes at \textcolor{myorange}{\(T_1\)}, \textcolor{myorange}{\(T_2\)}, \textcolor{myorange}{\(S_1\)}, \textcolor{myorange}{\(S_2\)}. 

Because the Earth is cooler at the poles than at the equator, we expect there to be \textcolor{mymagenta}{cooling} and \textcolor{mymagenta}{heating} at the poles and equator (respectively). We therefore set \(\textcolor{myorange}{T_2}<\textcolor{myorange}{T_1}\). Furthermore, there is net \textcolor{mydarkblue}{precipitation} and \textcolor{mydarkblue}{evaporation} at the poles and the equator (respectively), also partially because of the temperature difference.

Finally, we 

\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \draw[-] (0,0) -- (10,0) -- (10, 5) -- (0,5) -- cycle;
        \draw[-] (5,0) -- (5,5);
        \draw[ultra thick, mydarkblue,->] (4,3.55) -- (6,3.55);
        \node[mydarkblue] at (6.5,3.55) {flux};
        \node[mydarkblue] at (3.75,3.55) {\(q\)};
        \draw[ultra thick, mydarkblue,->] (6,1) -- (4,1);
        \node[mydarkblue] at (3.5,1) {flux};
        \node[mydarkblue] at (6.25,1) {\(q\)};
        \draw[ultra thick, mydarkblue,->] (3.5,4.5) -- (3.5,5.5);
        \node[mydarkblue] at (3.5,5.75) {evaporation};
        \node[mydarkblue] at (6.5,4.25) {precipitation};
        \draw[ultra thick, mydarkblue,->] (6.5,5.5) -- (6.5,4.5);
        \node[mydarkblue] at (6.5,5.75) {\(E\)};
        \node[mydarkblue] at (3.5,4.25) {\(E\)};
        \draw [->,thick,mymagenta,
            line join=round,
            decorate, decoration={
                zigzag,
                segment length=6,
                amplitude=.9,post=lineto,
                post length=2pt
            }]  (8.25,4.5) -- (8.25,5.75);
        \node[mymagenta] at (8.25,5.95) {cooling};
        \draw [->,thick,mymagenta,
            line join=round,
            decorate, decoration={
                zigzag,
                segment length=6,
                amplitude=.9,post=lineto,
                post length=2pt
            }]  (1.75,5.75) -- (1.75,4.5);
        \node[mymagenta] at (1.75,5.95) {heating};
        \node[] at (0,5.25) {Equator};
        \node[] at (10,5.25) {Pole (North)};
        \node[] at (11.3,4.8) {Top of Ocean};
        \node[] at (-1.6,0.2) {Bottom of Ocean};
        \node[myorange] at (2,2.45) {Temperature: \(T_1\)};
        \node[myorange] at (2,1.95) {Salinity: \(S_1\)};
        \node[myorange] at (8,2.45) {Temperature: \(T_2\)};
        \node[myorange] at (8,1.95) {Salinity: \(S_2\)};
        \node[myorange] at (2.5,-0.4) {\textbf{Box 1}};
        \node[myorange] at (7.5,-0.4) {\textbf{Box 2}};
    \end{tikzpicture}
    \caption{The Stommel Box Model}
    \label{fig Stommel}
\end{figure}

\subsection{The Gnanadesikan Box Model}

\printendnotes